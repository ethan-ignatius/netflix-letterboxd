{"version":3,"file":"storage-Bn6SSwi1.js","sources":["../../src/shared/constants.ts","../../src/shared/logger.ts","../../src/shared/normalize.ts","../../src/shared/storage.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const STORAGE_KEYS = {\n  OVERLAY_ENABLED: \"overlayEnabled\",\n  TMDB_API_KEY: \"tmdbApiKey\",\n  TMDB_CACHE: \"tmdbCache\",\n  TMDB_FEATURE_CACHE: \"tmdbFeatureCache\",\n  MATCH_PROFILE: \"matchProfile\",\n  LETTERBOXD_INDEX: \"lb_index_v1\",\n  LETTERBOXD_STATS: \"lb_stats_v1\",\n  LAST_IMPORT_AT: \"lastImportAt\"\n} as const;\n\nexport type StorageKey = (typeof STORAGE_KEYS)[keyof typeof STORAGE_KEYS];\n","import { DEBUG } from \"./constants\";\n\nexport { DEBUG };\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","export const normalizeTitle = (title?: string): string => {\n  if (!title) return \"\";\n  return title.toLowerCase().replace(/[^a-z0-9]+/g, \" \").trim();\n};\n\nexport const buildTmdbCacheKey = (title?: string, year?: number): string => {\n  const normalized = normalizeTitle(title);\n  return year ? `${normalized} (${year})` : normalized;\n};\n\nexport const buildLetterboxdKey = (title?: string, year?: number): string => {\n  const normalized = normalizeTitle(title);\n  return year ? `${normalized}|${year}` : normalized;\n};\n\nexport const parseLetterboxdKey = (key: string): { title: string; year?: number } => {\n  const parts = key.split(\"|\");\n  if (parts.length === 2) {\n    const year = Number(parts[1]);\n    return { title: parts[0], year: Number.isNaN(year) ? undefined : year };\n  }\n  return { title: key };\n};\n","import { log, warn } from \"./logger\";\nimport { STORAGE_KEYS } from \"./constants\";\nimport type { LetterboxdIndex, LetterboxdIndexLegacy, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  [STORAGE_KEYS.OVERLAY_ENABLED]?: boolean;\n  [STORAGE_KEYS.TMDB_API_KEY]?: string;\n  [STORAGE_KEYS.TMDB_CACHE]?: Record<string, unknown>;\n  [STORAGE_KEYS.TMDB_FEATURE_CACHE]?: Record<string, unknown>;\n  [STORAGE_KEYS.MATCH_PROFILE]?: Record<string, unknown>;\n  [STORAGE_KEYS.LETTERBOXD_INDEX]?: LetterboxdIndex | LetterboxdIndexLegacy;\n  [STORAGE_KEYS.LETTERBOXD_STATS]?: LetterboxdStats;\n  [STORAGE_KEYS.LAST_IMPORT_AT]?: string;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    STORAGE_KEYS.OVERLAY_ENABLED,\n    STORAGE_KEYS.TMDB_API_KEY,\n    STORAGE_KEYS.TMDB_CACHE,\n    STORAGE_KEYS.TMDB_FEATURE_CACHE,\n    STORAGE_KEYS.MATCH_PROFILE,\n    STORAGE_KEYS.LETTERBOXD_INDEX,\n    STORAGE_KEYS.LETTERBOXD_STATS,\n    STORAGE_KEYS.LAST_IMPORT_AT\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n\nexport const getLetterboxdIndex = async (): Promise<LetterboxdIndex | null> => {\n  const data = await chrome.storage.local.get([STORAGE_KEYS.LETTERBOXD_INDEX]);\n  const raw = data[STORAGE_KEYS.LETTERBOXD_INDEX] as\n    | LetterboxdIndex\n    | LetterboxdIndexLegacy\n    | undefined;\n  if (!raw) return null;\n\n  if (\"ratingsByKey\" in raw && \"watchlistKeys\" in raw) {\n    return raw as LetterboxdIndex;\n  }\n\n  const legacy = raw as LetterboxdIndexLegacy;\n  const ratingsByKey: Record<string, number> = {};\n  const watchlistKeys: Record<string, true> = {};\n  Object.entries(legacy).forEach(([key, entry]) => {\n    if (entry.r !== undefined) ratingsByKey[key] = entry.r;\n    if (entry.w === 1) watchlistKeys[key] = true;\n  });\n  return {\n    ratingsByKey,\n    watchlistKeys,\n    updatedAt: Date.now()\n  };\n};\n\nexport const setLetterboxdIndex = async (index: LetterboxdIndex): Promise<void> => {\n  await chrome.storage.local.set({ [STORAGE_KEYS.LETTERBOXD_INDEX]: index });\n};\n"],"names":["STORAGE_KEYS","log","args","normalizeTitle","title","buildTmdbCacheKey","year","normalized","buildLetterboxdKey","parseLetterboxdKey","key","parts","getStorage","getLetterboxdIndex","raw","legacy","ratingsByKey","watchlistKeys","entry","setLetterboxdIndex","index"],"mappings":"AAEO,MAAMA,EAAe,CAC1B,gBAAiB,iBACjB,aAAc,aACd,WAAY,YACZ,mBAAoB,mBACpB,cAAe,eACf,iBAAkB,cAClB,iBAAkB,cAClB,eAAgB,cAClB,ECPaC,EAAM,IAAIC,IAAoB,CAG3C,ECPaC,EAAkBC,GACxBA,EACEA,EAAM,cAAc,QAAQ,cAAe,GAAG,EAAE,KAAA,EADpC,GAIRC,EAAoB,CAACD,EAAgBE,IAA0B,CAC1E,MAAMC,EAAaJ,EAAeC,CAAK,EACvC,OAAOE,EAAO,GAAGC,CAAU,KAAKD,CAAI,IAAMC,CAC5C,EAEaC,EAAqB,CAACJ,EAAgBE,IAA0B,CAC3E,MAAMC,EAAaJ,EAAeC,CAAK,EACvC,OAAOE,EAAO,GAAGC,CAAU,IAAID,CAAI,GAAKC,CAC1C,EAEaE,EAAsBC,GAAkD,CACnF,MAAMC,EAAQD,EAAI,MAAM,GAAG,EAC3B,GAAIC,EAAM,SAAW,EAAG,CACtB,MAAML,EAAO,OAAOK,EAAM,CAAC,CAAC,EAC5B,MAAO,CAAE,MAAOA,EAAM,CAAC,EAAG,KAAM,OAAO,MAAML,CAAI,EAAI,OAAYA,CAAA,CACnE,CACA,MAAO,CAAE,MAAOI,CAAA,CAClB,ECPaE,EAAa,SAEjB,OAAO,QAAQ,MAAM,IAAI,CAC9BZ,EAAa,gBACbA,EAAa,aACbA,EAAa,WACbA,EAAa,mBACbA,EAAa,cACbA,EAAa,iBACbA,EAAa,iBACbA,EAAa,cAAA,CACd,EAaUa,EAAqB,SAA6C,CAE7E,MAAMC,GADO,MAAM,OAAO,QAAQ,MAAM,IAAI,CAACd,EAAa,gBAAgB,CAAC,GAC1DA,EAAa,gBAAgB,EAI9C,GAAI,CAACc,EAAK,OAAO,KAEjB,GAAI,iBAAkBA,GAAO,kBAAmBA,EAC9C,OAAOA,EAGT,MAAMC,EAASD,EACTE,EAAuC,CAAA,EACvCC,EAAsC,CAAA,EAC5C,cAAO,QAAQF,CAAM,EAAE,QAAQ,CAAC,CAACL,EAAKQ,CAAK,IAAM,CAC3CA,EAAM,IAAM,SAAWF,EAAaN,CAAG,EAAIQ,EAAM,GACjDA,EAAM,IAAM,IAAGD,EAAcP,CAAG,EAAI,GAC1C,CAAC,EACM,CACL,aAAAM,EACA,cAAAC,EACA,UAAW,KAAK,IAAA,CAAI,CAExB,EAEaE,EAAqB,MAAOC,GAA0C,CACjF,MAAM,OAAO,QAAQ,MAAM,IAAI,CAAE,CAACpB,EAAa,gBAAgB,EAAGoB,EAAO,CAC3E"}