const n={OVERLAY_ENABLED:"overlayEnabled",TMDB_API_KEY:"tmdbApiKey",TMDB_CACHE:"tmdbCache",TMDB_FEATURE_CACHE:"tmdbFeatureCache",MATCH_PROFILE:"matchProfile",LETTERBOXD_INDEX:"lb_index_v1",LETTERBOXD_STATS:"lb_stats_v1",LAST_IMPORT_AT:"lastImportAt"},b=(...e)=>{console.log("[Netflix+Letterboxd]",...e)},g=e=>e?e.toLowerCase().replace(/&/g," and ").replace(/[^a-z0-9']+/g," ").replace(/\s+/g," ").trim():"",T=(e,t)=>{const s=g(e),a=t?String(t):"";return`${s}-${a}`},L=(e,t)=>{const s=g(e);return t?`${s} (${t})`:s},m=(e,t)=>T(e,t),A=e=>{const t=e.split("-");if(t.length>=2){const s=t[t.length-1];if(s==="")return{title:t.slice(0,-1).join("-")};const a=Number(s);if(!Number.isNaN(a)&&s.length===4)return{title:t.slice(0,-1).join("-"),year:a}}return{title:e}},K=(e,t)=>{const s=g(e);return t?`${s}|${t}`:s},y=e=>{const t=e.split("|");if(t.length===2){const s=Number(t[1]);return{title:t[0],year:Number.isNaN(s)?void 0:s}}return{title:e}},D=async()=>(b("Loading storage state"),chrome.storage.local.get([n.OVERLAY_ENABLED,n.TMDB_API_KEY,n.TMDB_CACHE,n.TMDB_FEATURE_CACHE,n.MATCH_PROFILE,n.LETTERBOXD_INDEX,n.LETTERBOXD_STATS,n.LAST_IMPORT_AT])),h=async()=>{const t=(await chrome.storage.local.get([n.LETTERBOXD_INDEX]))[n.LETTERBOXD_INDEX];if(!t)return null;if("ratingsByKey"in t&&"watchlistKeys"in t){const r=t;if(!(Object.keys(r.ratingsByKey).some(o=>o.includes("|"))||Object.keys(r.watchlistKeys).some(o=>o.includes("|"))))return r;const c={},i={};return Object.entries(r.ratingsByKey).forEach(([o,E])=>{const d=y(o),_=T(d.title,d.year);c[_]=E}),Object.keys(r.watchlistKeys).forEach(o=>{const E=y(o),d=T(E.title,E.year);i[d]=!0}),{ratingsByKey:c,watchlistKeys:i,updatedAt:Date.now()}}const s=t,a={},u={};return Object.entries(s).forEach(([r,l])=>{const c=y(r),i=T(c.title,c.year);l.r!==void 0&&(a[i]=l.r),l.w===1&&(u[i]=!0)}),{ratingsByKey:a,watchlistKeys:u,updatedAt:Date.now()}},B=async e=>{await chrome.storage.local.set({[n.LETTERBOXD_INDEX]:e})};export{n as S,m as a,L as b,K as c,D as d,h as g,b as l,T as m,g as n,A as p,B as s};
//# sourceMappingURL=storage-CcVRV5ek.js.map
