const r={OVERLAY_ENABLED:"overlayEnabled",TMDB_API_KEY:"tmdbApiKey",TMDB_CACHE:"tmdbCache",TMDB_FEATURE_CACHE:"tmdbFeatureCache",MATCH_PROFILE:"matchProfile",LETTERBOXD_INDEX:"lb_index_v1",LETTERBOXD_STATS:"lb_stats_v1",LAST_IMPORT_AT:"lastImportAt"},b=(...e)=>{},u=e=>e?e.toLowerCase().replace(/&/g," and ").replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim():"",T=(e,t)=>{const s=u(e),n=t?String(t):"";return`${s}-${n}`},m=(e,t)=>{const s=u(e);return t?`${s} (${t})`:s},A=(e,t)=>T(e,t),L=e=>{const t=e.split("-");if(t.length>=2){const s=t[t.length-1];if(s==="")return{title:t.slice(0,-1).join("-")};const n=Number(s);if(!Number.isNaN(n)&&s.length===4)return{title:t.slice(0,-1).join("-"),year:n}}return{title:e}},K=(e,t)=>{const s=u(e);return t?`${s}|${t}`:s},y=e=>{const t=e.split("|");if(t.length===2){const s=Number(t[1]);return{title:t[0],year:Number.isNaN(s)?void 0:s}}return{title:e}},D=async()=>chrome.storage.local.get([r.OVERLAY_ENABLED,r.TMDB_API_KEY,r.TMDB_CACHE,r.TMDB_FEATURE_CACHE,r.MATCH_PROFILE,r.LETTERBOXD_INDEX,r.LETTERBOXD_STATS,r.LAST_IMPORT_AT]),h=async()=>{const t=(await chrome.storage.local.get([r.LETTERBOXD_INDEX]))[r.LETTERBOXD_INDEX];if(!t)return null;if("ratingsByKey"in t&&"watchlistKeys"in t){const a=t;if(!(Object.keys(a.ratingsByKey).some(o=>o.includes("|"))||Object.keys(a.watchlistKeys).some(o=>o.includes("|"))))return a;const c={},i={};return Object.entries(a.ratingsByKey).forEach(([o,E])=>{const d=y(o),_=T(d.title,d.year);c[_]=E}),Object.keys(a.watchlistKeys).forEach(o=>{const E=y(o),d=T(E.title,E.year);i[d]=!0}),{ratingsByKey:c,watchlistKeys:i,updatedAt:Date.now()}}const s=t,n={},g={};return Object.entries(s).forEach(([a,l])=>{const c=y(a),i=T(c.title,c.year);l.r!==void 0&&(n[i]=l.r),l.w===1&&(g[i]=!0)}),{ratingsByKey:n,watchlistKeys:g,updatedAt:Date.now()}},B=async e=>{await chrome.storage.local.set({[r.LETTERBOXD_INDEX]:e})};export{r as S,A as a,m as b,K as c,D as d,h as g,b as l,T as m,u as n,L as p,B as s};
//# sourceMappingURL=storage-D8BXcNmO.js.map
