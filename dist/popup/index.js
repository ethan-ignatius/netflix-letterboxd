import{l as Oe}from"../assets/log-Bck1zoEB.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const $e=async()=>chrome.storage.local.get(["letterboxdExport","lastImportAt","overlayEnabled","tmdbApiKey","tmdbCache","letterboxdIndex","letterboxdStats"]);var h=Uint8Array,N=Uint16Array,Me=Int32Array,pe=new h([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),we=new h([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Pe=new h([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xe=function(e,r){for(var t=new N(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];for(var o=new Me(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)o[a]=a-t[n]<<5|n;return{b:t,r:o}},Ce=xe(pe,2),Ee=Ce.b,Te=Ce.r;Ee[28]=258,Te[258]=28;var Ue=xe(we,0),De=Ue.b,te=new N(32768);for(var u=0;u<32768;++u){var A=(u&43690)>>1|(u&21845)<<1;A=(A&52428)>>2|(A&13107)<<2,A=(A&61680)>>4|(A&3855)<<4,te[u]=((A&65280)>>8|(A&255)<<8)>>1}var $=function(e,r,t){for(var n=e.length,o=0,a=new N(r);o<n;++o)e[o]&&++a[e[o]-1];var s=new N(r);for(o=1;o<r;++o)s[o]=s[o-1]+a[o-1]<<1;var f;if(t){f=new N(1<<r);var v=15-r;for(o=0;o<n;++o)if(e[o])for(var m=o<<4|e[o],c=r-e[o],i=s[e[o]-1]++<<c,l=i|(1<<c)-1;i<=l;++i)f[te[i]>>v]=m}else for(f=new N(n),o=0;o<n;++o)e[o]&&(f[o]=te[s[e[o]-1]++]>>15-e[o]);return f},T=new h(288);for(var u=0;u<144;++u)T[u]=8;for(var u=144;u<256;++u)T[u]=9;for(var u=256;u<280;++u)T[u]=7;for(var u=280;u<288;++u)T[u]=8;var Se=new h(32);for(var u=0;u<32;++u)Se[u]=5;var qe=$(T,9,1),Qe=$(Se,5,1),H=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},d=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(r&7)&t},J=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(r&7)},Re=function(e){return(e+7)/8|0},ae=function(e,r,t){return(r==null||r<0)&&(r=0),(t==null||t>e.length)&&(t=e.length),new h(e.subarray(r,t))},Ve=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y=function(e,r,t){var n=new Error(r||Ve[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,y),!t)throw n;return n},We=function(e,r,t,n){var o=e.length,a=n?n.length:0;if(!o||r.f&&!r.l)return t||new h(0);var s=!t,f=s||r.i!=2,v=r.i;s&&(t=new h(o*3));var m=function(he){var ge=t.length;if(he>ge){var ye=new h(Math.max(ge*2,he));ye.set(t),t=ye}},c=r.f||0,i=r.p||0,l=r.b||0,w=r.l,k=r.d,I=r.m,x=r.n,D=o*8;do{if(!w){c=d(e,i,1);var q=d(e,i+1,3);if(i+=3,q)if(q==1)w=qe,k=Qe,I=9,x=5;else if(q==2){var V=d(e,i,31)+257,ie=d(e,i+10,15)+4,se=V+d(e,i+5,31)+1;i+=14;for(var K=new h(se),W=new h(19),g=0;g<ie;++g)W[Pe[g]]=d(e,i+g*3,7);i+=ie*3;for(var fe=H(W),Le=(1<<fe)-1,Ne=$(W,fe,1),g=0;g<se;){var le=Ne[d(e,i,Le)];i+=le&15;var C=le>>4;if(C<16)K[g++]=C;else{var F=0,U=0;for(C==16?(U=3+d(e,i,3),i+=2,F=K[g-1]):C==17?(U=3+d(e,i,7),i+=3):C==18&&(U=11+d(e,i,127),i+=7);U--;)K[g++]=F}}var ce=K.subarray(0,V),b=K.subarray(V);I=H(ce),x=H(b),w=$(ce,I,1),k=$(b,x,1)}else y(1);else{var C=Re(i)+4,Q=e[C-4]|e[C-3]<<8,R=C+Q;if(R>o){v&&y(0);break}f&&m(l+Q),t.set(e.subarray(C,R),l),r.b=l+=Q,r.p=i=R*8,r.f=c;continue}if(i>D){v&&y(0);break}}f&&m(l+131072);for(var ze=(1<<I)-1,Be=(1<<x)-1,Y=i;;Y=i){var F=w[J(e,i)&ze],L=F>>4;if(i+=F&15,i>D){v&&y(0);break}if(F||y(2),L<256)t[l++]=L;else if(L==256){Y=i,w=null;break}else{var ue=L-254;if(L>264){var g=L-257,O=pe[g];ue=d(e,i,(1<<O)-1)+Ee[g],i+=O}var Z=k[J(e,i)&Be],G=Z>>4;Z||y(3),i+=Z&15;var b=De[G];if(G>3){var O=we[G];b+=J(e,i)&(1<<O)-1,i+=O}if(i>D){v&&y(0);break}f&&m(l+131072);var ve=l+ue;if(l<b){var me=a-b,Ke=Math.min(b,ve);for(me+l<0&&y(3);l<Ke;++l)t[l]=n[me+l]}for(;l<ve;++l)t[l]=t[l-b]}}r.l=w,r.p=Y,r.b=l,r.f=c,w&&(c=1,r.m=I,r.d=k,r.n=x)}while(!c);return l!=t.length&&s?ae(t,0,l):t.subarray(0,l)},Ye=new h(0),E=function(e,r){return e[r]|e[r+1]<<8},p=function(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24)>>>0},X=function(e,r){return p(e,r)+p(e,r+4)*4294967296};function Ze(e,r){return We(e,{i:2},r&&r.out,r&&r.dictionary)}var ne=typeof TextDecoder<"u"&&new TextDecoder,Ge=0;try{ne.decode(Ye,{stream:!0}),Ge=1}catch{}var He=function(e){for(var r="",t=0;;){var n=e[t++],o=(n>127)+(n>223)+(n>239);if(t+o>e.length)return{s:r,r:ae(e,t-1)};o?o==3?(n=((n&15)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,r+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?r+=String.fromCharCode((n&31)<<6|e[t++]&63):r+=String.fromCharCode((n&15)<<12|(e[t++]&63)<<6|e[t++]&63):r+=String.fromCharCode(n)}};function oe(e,r){if(r){for(var t="",n=0;n<e.length;n+=16384)t+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return t}else{if(ne)return ne.decode(e);var o=He(e),a=o.s,t=o.r;return t.length&&y(8),a}}var Je=function(e,r){return r+30+E(e,r+26)+E(e,r+28)},Xe=function(e,r,t){var n=E(e,r+28),o=oe(e.subarray(r+46,r+46+n),!(E(e,r+8)&2048)),a=r+46+n,s=p(e,r+20),f=t&&s==4294967295?je(e,a):[s,p(e,r+24),p(e,r+42)],v=f[0],m=f[1],c=f[2];return[E(e,r+10),v,m,o,a+E(e,r+30)+E(e,r+32),c]},je=function(e,r){for(;E(e,r)!=1;r+=4+E(e,r+2));return[X(e,r+12),X(e,r+4),X(e,r+20)]};function _e(e,r){for(var t={},n=e.length-22;p(e,n)!=101010256;--n)(!n||e.length-n>65558)&&y(13);var o=E(e,n+8);if(!o)return{};var a=p(e,n+16),s=a==4294967295||o==65535;if(s){var f=p(e,n-12);s=p(e,f)==101075792,s&&(o=p(e,f+32),a=p(e,f+48))}for(var v=0;v<o;++v){var m=Xe(e,a,s),c=m[0],i=m[1],l=m[2],w=m[3],k=m[4],I=m[5],x=Je(e,I);a=k,c?c==8?t[w]=Ze(e.subarray(x,x+i),{out:new h(l)}):y(14,"unknown compression type "+c):t[w]=ae(e,x,x+i)}return t}const z=document.getElementById("overlayToggle"),M=document.getElementById("tmdbKey"),j=document.getElementById("saveKey"),_=document.getElementById("clearCache"),B=document.getElementById("keyStatus"),ee=document.getElementById("zipStatus"),de=document.getElementById("zipMeta"),re=document.getElementById("uploadZip"),S=document.getElementById("zipInput"),er=e=>e.toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),be=(e,r)=>{const t=er(e);return r?`${t}|${r}`:t},Ae=e=>{const r=[];let t=[],n="",o=!1;for(let a=0;a<e.length;a+=1){const s=e[a],f=e[a+1];if(s==='"'){o&&f==='"'?(n+='"',a+=1):o=!o;continue}if(s===","&&!o){t.push(n),n="";continue}if((s===`
`||s==="\r")&&!o){s==="\r"&&f===`
`&&(a+=1),t.push(n),t.some(v=>v.trim().length>0)&&r.push(t),t=[],n="";continue}n+=s}return t.push(n),t.some(a=>a.trim().length>0)&&r.push(t),r},Ie=e=>{const r={};return e.forEach((t,n)=>{r[t.toLowerCase().trim()]=n}),r},P=(e,r)=>{var t;return r===void 0?"":((t=e[r])==null?void 0:t.trim())??""},ke=e=>{const r=Number(e);if(!Number.isNaN(r))return r},rr=(e,r)=>{const t=Ae(e);if(!t.length)return 0;const n=Ie(t[0]),o=n.name??n.title,a=n.year,s=n.rating;let f=0;return t.slice(1).forEach(v=>{const m=P(v,o);if(!m)return;const c=ke(P(v,a)),i=parseFloat(P(v,s));if(Number.isNaN(i))return;const l=be(m,c);r[l]||(r[l]={}),r[l].r=i,f+=1}),f},tr=(e,r)=>{const t=Ae(e);if(!t.length)return 0;const n=Ie(t[0]),o=n.name??n.title,a=n.year;let s=0;return t.slice(1).forEach(f=>{const v=P(f,o);if(!v)return;const m=ke(P(f,a)),c=be(v,m);r[c]||(r[c]={}),r[c].w=1,s+=1}),s},Fe=async()=>{const e=await $e();z&&(z.checked=e.overlayEnabled??!0),M&&(M.value=e.tmdbApiKey??""),B&&(B.textContent=e.tmdbApiKey?"Key saved.":"Not set."),ee&&(e.letterboxdStats?ee.textContent=`${e.letterboxdStats.ratingsCount} ratings · ${e.letterboxdStats.watchlistCount} watchlist`:ee.textContent="No export loaded."),de&&(de.textContent=e.letterboxdStats?`Last imported: ${e.letterboxdStats.importedAt}`:"Last imported: —")};z==null||z.addEventListener("change",async()=>{const e=z.checked;await chrome.storage.local.set({overlayEnabled:e})});j==null||j.addEventListener("click",async()=>{const e=M==null?void 0:M.value.trim();if(!e){await chrome.storage.local.remove("tmdbApiKey"),B&&(B.textContent="Not set.");return}await chrome.storage.local.set({tmdbApiKey:e}),B&&(B.textContent="Key saved.")});_==null||_.addEventListener("click",async()=>{await chrome.storage.local.remove("tmdbCache")});re==null||re.addEventListener("click",()=>{S==null||S.click()});S==null||S.addEventListener("change",async()=>{var r;const e=(r=S.files)==null?void 0:r[0];if(e)try{const t=await e.arrayBuffer(),n=_e(new Uint8Array(t)),o=Object.keys(n).find(c=>/ratings\\.csv$/i.test(c)),a=Object.keys(n).find(c=>/watchlist\\.csv$/i.test(c)),s={};let f=0,v=0;if(o){const c=oe(n[o]);f=rr(c,s)}if(a){const c=oe(n[a]);v=tr(c,s)}const m={importedAt:new Date().toLocaleString(),ratingsCount:f,watchlistCount:v};await chrome.storage.local.set({letterboxdIndex:s,letterboxdStats:m,lastImportAt:m.importedAt}),Oe("Letterboxd ZIP imported",{ratingsCount:f,watchlistCount:v}),await Fe()}catch{}finally{S&&(S.value="")}});Fe().catch(e=>{});
//# sourceMappingURL=index.js.map
