import{l as $}from"../assets/log-Bck1zoEB.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const Ye=async()=>chrome.storage.local.get(["letterboxdExport","lastImportAt","overlayEnabled","tmdbApiKey","tmdbCache","letterboxdIndex","letterboxdStats","lb_index_v1","lb_stats_v1"]);var m=Uint8Array,z=Uint16Array,Ge=Int32Array,Oe=new m([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_e=new m([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Je=new m([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ke=function(e,t){for(var r=new z(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var o=new Ge(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return{b:r,r:o}},$e=Ke(Oe,2),Te=$e.b,je=$e.r;Te[28]=258,je[258]=28;var et=Ke(_e,0),tt=et.b,he=new z(32768);for(var v=0;v<32768;++v){var k=(v&43690)>>1|(v&21845)<<1;k=(k&52428)>>2|(k&13107)<<2,k=(k&61680)>>4|(k&3855)<<4,he[v]=((k&65280)>>8|(k&255)<<8)>>1}var T=function(e,t,r){for(var n=e.length,o=0,i=new z(t);o<n;++o)e[o]&&++i[e[o]-1];var s=new z(t);for(o=1;o<t;++o)s[o]=s[o-1]+i[o-1]<<1;var c;if(r){c=new z(1<<t);var f=15-t;for(o=0;o<n;++o)if(e[o])for(var u=o<<4|e[o],d=t-e[o],a=s[e[o]-1]++<<d,l=a|(1<<d)-1;a<=l;++a)c[he[a]>>f]=u}else for(c=new z(n),o=0;o<n;++o)e[o]&&(c[o]=he[s[e[o]-1]++]>>15-e[o]);return c},Z=new m(288);for(var v=0;v<144;++v)Z[v]=8;for(var v=144;v<256;++v)Z[v]=9;for(var v=256;v<280;++v)Z[v]=7;for(var v=280;v<288;++v)Z[v]=8;var De=new m(32);for(var v=0;v<32;++v)De[v]=5;var rt=T(Z,9,1),nt=T(De,5,1),ee=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},y=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},te=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},ot=function(e){return(e+7)/8|0},we=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new m(e.subarray(t,r))},at=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],g=function(e,t,r){var n=new Error(t||at[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,g),!r)throw n;return n},it=function(e,t,r,n){var o=e.length,i=n?n.length:0;if(!o||t.f&&!t.l)return r||new m(0);var s=!r,c=s||t.i!=2,f=t.i;s&&(r=new m(o*3));var u=function(Ae){var Fe=r.length;if(Ae>Fe){var ze=new m(Math.max(Fe*2,Ae));ze.set(r),r=ze}},d=t.f||0,a=t.p||0,l=t.b||0,w=t.l,S=t.d,B=t.m,E=t.n,q=o*8;do{if(!w){d=y(e,a,1);var Q=y(e,a+1,3);if(a+=3,Q)if(Q==1)w=rt,S=nt,B=9,E=5;else if(Q==2){var X=y(e,a,31)+257,xe=y(e,a+10,15)+4,Ce=X+y(e,a+5,31)+1;a+=14;for(var _=new m(Ce),Y=new m(19),h=0;h<xe;++h)Y[Je[h]]=y(e,a+h*3,7);a+=xe*3;for(var be=ee(Y),qe=(1<<be)-1,Qe=T(Y,be,1),h=0;h<Ce;){var Ie=Qe[y(e,a,qe)];a+=Ie&15;var x=Ie>>4;if(x<16)_[h++]=x;else{var A=0,H=0;for(x==16?(H=3+y(e,a,3),a+=2,A=_[h-1]):x==17?(H=3+y(e,a,7),a+=3):x==18&&(H=11+y(e,a,127),a+=7);H--;)_[h++]=A}}var ke=_.subarray(0,X),I=_.subarray(X);B=ee(ke),E=ee(I),w=T(ke,B,1),S=T(I,E,1)}else g(1);else{var x=ot(a)+4,R=e[x-4]|e[x-3]<<8,V=x+R;if(V>o){f&&g(0);break}c&&u(l+R),r.set(e.subarray(x,V),l),t.b=l+=R,t.p=a=V*8,t.f=d;continue}if(a>q){f&&g(0);break}}c&&u(l+131072);for(var Re=(1<<B)-1,Ve=(1<<E)-1,G=a;;G=a){var A=w[te(e,a)&Re],F=A>>4;if(a+=A&15,a>q){f&&g(0);break}if(A||g(2),F<256)r[l++]=F;else if(F==256){G=a,w=null;break}else{var Le=F-254;if(F>264){var h=F-257,K=Oe[h];Le=y(e,a,(1<<K)-1)+Te[h],a+=K}var J=S[te(e,a)&Ve],j=J>>4;J||g(3),a+=J&15;var I=tt[j];if(j>3){var K=_e[j];I+=te(e,a)&(1<<K)-1,a+=K}if(a>q){f&&g(0);break}c&&u(l+131072);var Be=l+Le;if(l<I){var Se=i-I,Xe=Math.min(I,Be);for(Se+l<0&&g(3);l<Xe;++l)r[l]=n[Se+l]}for(;l<Be;++l)r[l]=r[l-I]}}t.l=w,t.p=G,t.b=l,t.f=d,w&&(d=1,t.m=B,t.d=S,t.n=E)}while(!d);return l!=r.length&&s?we(r,0,l):r.subarray(0,l)},st=new m(0),C=function(e,t){return e[t]|e[t+1]<<8},p=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},re=function(e,t){return p(e,t)+p(e,t+4)*4294967296};function ct(e,t){return it(e,{i:2},t&&t.out,t&&t.dictionary)}var ge=typeof TextDecoder<"u"&&new TextDecoder,lt=0;try{ge.decode(st,{stream:!0}),lt=1}catch{}var ft=function(e){for(var t="",r=0;;){var n=e[r++],o=(n>127)+(n>223)+(n>239);if(r+o>e.length)return{s:t,r:we(e,r-1)};o?o==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}};function ye(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(ge)return ge.decode(e);var o=ft(e),i=o.s,r=o.r;return r.length&&g(8),i}}var ut=function(e,t){return t+30+C(e,t+26)+C(e,t+28)},vt=function(e,t,r){var n=C(e,t+28),o=ye(e.subarray(t+46,t+46+n),!(C(e,t+8)&2048)),i=t+46+n,s=p(e,t+20),c=r&&s==4294967295?dt(e,i):[s,p(e,t+24),p(e,t+42)],f=c[0],u=c[1],d=c[2];return[C(e,t+10),f,u,o,i+C(e,t+30)+C(e,t+32),d]},dt=function(e,t){for(;C(e,t)!=1;t+=4+C(e,t+2));return[re(e,t+12),re(e,t+4),re(e,t+20)]};function mt(e,t){for(var r={},n=e.length-22;p(e,n)!=101010256;--n)(!n||e.length-n>65558)&&g(13);var o=C(e,n+8);if(!o)return{};var i=p(e,n+16),s=i==4294967295||o==65535;if(s){var c=p(e,n-12);s=p(e,c)==101075792,s&&(o=p(e,c+32),i=p(e,c+48))}for(var f=0;f<o;++f){var u=vt(e,i,s),d=u[0],a=u[1],l=u[2],w=u[3],S=u[4],B=u[5],E=ut(e,B);i=S,d?d==8?r[w]=ct(e.subarray(E,E+a),{out:new m(l)}):g(14,"unknown compression type "+d):r[w]=we(e,E,E+a)}return r}const N=document.getElementById("overlayToggle"),D=document.getElementById("tmdbKey"),ne=document.getElementById("saveKey"),oe=document.getElementById("clearCache"),P=document.getElementById("keyStatus"),ae=document.getElementById("zipStatus"),Ne=document.getElementById("zipMeta"),ie=document.getElementById("uploadZip"),b=document.getElementById("zipInput"),M=document.getElementById("zipError"),O=document.getElementById("zipSuccess"),se=document.getElementById("clearLetterboxd"),ce=document.getElementById("helpZip"),L=document.getElementById("helpModal"),le=document.getElementById("closeHelp"),fe=document.getElementById("dismissHelp"),ue=document.getElementById("copyLink"),ve=document.getElementById("exportUrl");let Pe=!1,Ee=!1;const ht=e=>e.toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Ue=(e,t)=>{const r=ht(e);return t?`${r}|${t}`:r},Ze=e=>{const t=[];let r=[],n="",o=!1;for(let i=0;i<e.length;i+=1){const s=e[i],c=e[i+1];if(s==='"'){o&&c==='"'?(n+='"',i+=1):o=!o;continue}if(s===","&&!o){r.push(n),n="";continue}if((s===`
`||s==="\r")&&!o){s==="\r"&&c===`
`&&(i+=1),r.push(n),r.some(f=>f.trim().length>0)&&t.push(r),r=[],n="";continue}n+=s}return r.push(n),r.some(i=>i.trim().length>0)&&t.push(r),t},He=e=>{const t={};return e.forEach((r,n)=>{t[r.toLowerCase().trim()]=n}),t},U=(e,t)=>{var r;return t===void 0?"":((r=e[t])==null?void 0:r.trim())??""},We=e=>{const t=Number(e);if(!Number.isNaN(t))return t},gt=(e,t)=>{const r=Ze(e);if(!r.length)return 0;const n=He(r[0]),o=n.name??n.title,i=n.year,s=n.rating;let c=0;return r.slice(1).forEach(f=>{const u=U(f,o);if(!u)return;const d=We(U(f,i)),a=parseFloat(U(f,s));if(Number.isNaN(a))return;const l=Ue(u,d);t[l]||(t[l]={}),t[l].r=a,c+=1}),c},yt=(e,t)=>{const r=Ze(e);if(!r.length)return 0;const n=He(r[0]),o=n.name??n.title,i=n.year;let s=0;return r.slice(1).forEach(c=>{const f=U(c,o);if(!f)return;const u=We(U(c,i)),d=Ue(f,u);t[d]||(t[d]={}),t[d].w=1,s+=1}),s},Me=()=>{M&&(M.hidden=!0,M.textContent=""),O&&(O.hidden=!0,O.textContent="")},de=e=>{M&&(M.textContent=e,M.hidden=!1)},me=e=>{O&&(O.textContent=e,O.hidden=!1)},pt=()=>{L&&(L.hidden=!1,Ee=!0,document.body.style.overflow="hidden")},W=()=>{L&&(L.hidden=!0,Ee=!1,document.body.style.overflow="")},pe=async()=>{const e=await Ye();N&&(N.checked=e.overlayEnabled??!0),D&&(D.value=e.tmdbApiKey??""),P&&(P.textContent=e.tmdbApiKey?"Key saved.":"Not set.");const t=e.lb_stats_v1;ae&&(t?ae.textContent=`${t.ratingsCount} ratings • ${t.watchlistCount} watchlist`:ae.textContent="No Letterboxd data imported yet."),Ne&&(Ne.textContent=t?`Last imported: ${t.importedAt}`:"Import your export ZIP to enable watchlist + rating badges and match %.")},wt=()=>{Pe||(Pe=!0,N==null||N.addEventListener("change",async()=>{const e=N.checked;await chrome.storage.local.set({overlayEnabled:e})}),ne==null||ne.addEventListener("click",async()=>{const e=D==null?void 0:D.value.trim();if(!e){await chrome.storage.local.remove("tmdbApiKey"),P&&(P.textContent="Not set.");return}await chrome.storage.local.set({tmdbApiKey:e}),P&&(P.textContent="Key saved.")}),oe==null||oe.addEventListener("click",async()=>{await chrome.storage.local.remove("tmdbCache")}),ie==null||ie.addEventListener("click",()=>{b==null||b.click()}),ce==null||ce.addEventListener("click",pt),le==null||le.addEventListener("click",W),fe==null||fe.addEventListener("click",W),L==null||L.addEventListener("click",e=>{e.target===L&&W()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&Ee&&W()}),ue==null||ue.addEventListener("click",async()=>{const e=(ve==null?void 0:ve.textContent)??"https://letterboxd.com/settings/data/";await navigator.clipboard.writeText(e),me("Copied export link to clipboard.")}),b==null||b.addEventListener("change",async()=>{var t;const e=(t=b.files)==null?void 0:t[0];if(e)try{Me();const r=await e.arrayBuffer(),n=mt(new Uint8Array(r)),o=Object.keys(n).filter(a=>!a.startsWith("__MACOSX")&&!/\/\./.test(a));$("ZIP entries",o);const i=o.find(a=>/ratings\.csv$/i.test(a)),s=o.find(a=>/watchlist\.csv$/i.test(a));$("Detected ratings.csv",i),$("Detected watchlist.csv",s);const c={};let f=0,u=0;if(i){const a=ye(n[i]);f=gt(a,c)}if(s){const a=ye(n[s]);u=yt(a,c)}if($("Parsed counts",{ratingsCount:f,watchlistCount:u}),!i||!s){de("Couldn’t find ratings.csv/watchlist.csv in this ZIP. Make sure you uploaded the official Letterboxd export ZIP (don’t unzip it).");return}if(i&&f===0||s&&u===0){de("Found the file but parsed 0 rows. Please re-export from Letterboxd and try again.");return}const d={importedAt:new Date().toLocaleString(),ratingsCount:f,watchlistCount:u};await chrome.storage.local.set({lb_index_v1:c,lb_stats_v1:d,lastImportAt:d.importedAt}),$("Letterboxd ZIP imported",{ratingsCount:f,watchlistCount:u}),me(`Imported ${f} ratings and ${u} watchlist items.`),await pe()}catch{de("Import failed. Please re-export from Letterboxd and try again.")}finally{b&&(b.value="")}}),se==null||se.addEventListener("click",async()=>{await chrome.storage.local.remove(["lb_index_v1","lb_stats_v1","lastImportAt"]),Me(),me("Cleared Letterboxd data."),await pe()}))};wt();pe().catch(e=>{});
//# sourceMappingURL=index.js.map
