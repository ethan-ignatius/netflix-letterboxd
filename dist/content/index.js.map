{"version":3,"file":"index.js","sources":["../../src/shared/log.ts","../../src/shared/storage.ts","../../src/content/netflixSelectors.ts","../../src/content/overlay/index.ts","../../src/content/index.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","import { log, warn } from \"./log\";\nimport type { LetterboxdExport, LetterboxdIndex, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  letterboxdExport?: LetterboxdExport;\n  lastImportAt?: string;\n  overlayEnabled?: boolean;\n  tmdbApiKey?: string;\n  tmdbCache?: Record<string, unknown>;\n  letterboxdIndex?: LetterboxdIndex;\n  letterboxdStats?: LetterboxdStats;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    \"letterboxdExport\",\n    \"lastImportAt\",\n    \"overlayEnabled\",\n    \"tmdbApiKey\",\n    \"tmdbCache\",\n    \"letterboxdIndex\",\n    \"letterboxdStats\"\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n","export interface ActiveTitleCandidate {\n  netflixTitleId?: string;\n  titleText?: string;\n  year?: number;\n  href?: string;\n  source: string;\n}\n\nconst TITLE_ANCHOR_SELECTOR = \"a[href^='/title/']\";\n\nconst CONTAINER_SELECTORS = [\n  \"[role='dialog']\",\n  \"[aria-modal='true']\",\n  \"[aria-expanded='true']\",\n  \"[data-uia*='preview']\",\n  \"[data-uia*='billboard']\",\n  \"[data-uia*='hero']\",\n  \"[data-uia*='details']\"\n];\n\nconst TITLE_TEXT_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='fallback']\",\n  \"[class*='preview'] [class*='header']\"\n];\n\nconst PREVIEW_SELECTORS = [\n  \"video\",\n  \"img\",\n  \"[data-uia*='preview'] video\",\n  \"[data-uia*='preview'] img\",\n  \"[class*='preview'] video\",\n  \"[class*='preview'] img\",\n  \"[data-uia*='player'] video\",\n  \"[data-uia*='hero'] img\"\n];\n\nconst EPISODE_TITLE_PATTERN = /(S\\\\d+\\\\s*:?\\\\s*E\\\\d+|Episode\\\\s*\\\\d+|\\\\bE\\\\d+\\\\b)/i;\n\nconst METADATA_SELECTORS = [\n  \"[data-uia*='maturity-rating']\",\n  \"[data-uia*='season']\",\n  \"[data-uia*='resolution']\",\n  \"[data-uia*='hd']\",\n  \"[class*='maturity']\",\n  \"[class*='season']\",\n  \"[class*='quality']\"\n];\n\nconst GENRE_SELECTORS = [\n  \"[data-uia*='genre']\",\n  \"a[href*='/genre/']\",\n  \"[class*='genre']\"\n];\n\nconst isVisible = (el: Element): boolean => {\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  const style = window.getComputedStyle(el as HTMLElement);\n  if (style.visibility === \"hidden\" || style.display === \"none\" || style.opacity === \"0\") {\n    return false;\n  }\n  const inViewport =\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= window.innerHeight &&\n    rect.left <= window.innerWidth;\n  return inViewport;\n};\n\nconst normalizeText = (value?: string | null): string | undefined => {\n  if (!value) return undefined;\n  const text = value.replace(/\\s+/g, \" \").trim();\n  return text.length ? text : undefined;\n};\n\nconst collectVisibleText = (container: Element, selectors: string[]): string[] => {\n  const values: string[] = [];\n  selectors.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      const text = normalizeText(el.textContent);\n      if (!text) return;\n      values.push(text);\n    });\n  });\n  return values;\n};\n\nconst isMetadataCandidate = (value: string) => {\n  const lower = value.toLowerCase();\n  if (lower.includes(\"episode\")) return false;\n  if (lower.includes(\"min\")) return false;\n  if (lower.includes(\"season\") || lower.includes(\"hd\") || lower.includes(\"tv-\")) return true;\n  return true;\n};\n\nconst parseTitleIdFromHref = (href?: string | null): string | undefined => {\n  if (!href) return undefined;\n  const match = href.match(/\\/title\\/(\\d+)/);\n  return match?.[1];\n};\n\nconst parseYearFromText = (text?: string): number | undefined => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  if (Number.isNaN(year)) return undefined;\n  return year;\n};\n\nconst extractFromAnchor = (anchor: HTMLAnchorElement, source: string): ActiveTitleCandidate => {\n  const href = anchor.getAttribute(\"href\") || undefined;\n  const netflixTitleId = parseTitleIdFromHref(href);\n  const titleText = normalizeText(anchor.getAttribute(\"aria-label\") || anchor.textContent);\n  return { netflixTitleId, titleText, href, source };\n};\n\nconst extractTitleTextNear = (container: Element): string | undefined => {\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const el = container.querySelector(selector);\n    if (el && isVisible(el)) {\n      const text = normalizeText(el.textContent);\n      if (text) return text;\n    }\n  }\n  return undefined;\n};\n\nconst findPrimaryTitle = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const nodes = Array.from(container.querySelectorAll(selector));\n    for (const node of nodes) {\n      if (!isVisible(node)) continue;\n      const text = normalizeText(node.textContent);\n      if (!text) continue;\n      if (EPISODE_TITLE_PATTERN.test(text)) continue;\n      return text;\n    }\n  }\n  return undefined;\n};\n\nexport const findOverlayAnchor = (container?: Element | null): Element | null => {\n  if (container) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor && isVisible(anchor)) return anchor;\n    for (const selector of TITLE_TEXT_SELECTORS) {\n      const el = container.querySelector(selector);\n      if (el && isVisible(el)) return el;\n    }\n  }\n\n  const pageAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (pageAnchor) return pageAnchor;\n\n  const pageTitle = Array.from(document.querySelectorAll(TITLE_TEXT_SELECTORS.join(\",\"))).find(\n    isVisible\n  );\n  return pageTitle ?? null;\n};\n\nexport const findPreviewElement = (container?: Element | null): Element | null => {\n  if (!container) return null;\n  const candidates: Element[] = [];\n  PREVIEW_SELECTORS.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (isVisible(el)) candidates.push(el);\n    });\n  });\n  if (!candidates.length) return null;\n  return candidates.reduce((best, current) => {\n    const bestRect = best.getBoundingClientRect();\n    const currentRect = current.getBoundingClientRect();\n    const bestArea = bestRect.width * bestRect.height;\n    const currentArea = currentRect.width * currentRect.height;\n    return currentArea > bestArea ? current : best;\n  });\n};\n\nexport const extractMetadataLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, METADATA_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter(isMetadataCandidate)\n    .filter((value) => value.length <= 24);\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const extractGenresLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, GENRE_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter((value) => value.length <= 24)\n    .filter((value) => !/episode|min/i.test(value));\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const resolveTitleText = (\n  container?: Element | null,\n  fallback?: string\n): string | undefined => {\n  const cleanFallback = fallback ? fallback.replace(EPISODE_TITLE_PATTERN, \"\").trim() : undefined;\n  if (cleanFallback && !EPISODE_TITLE_PATTERN.test(cleanFallback)) {\n    return cleanFallback;\n  }\n\n  const primary = findPrimaryTitle(container);\n  if (primary) return primary;\n\n  if (fallback) return fallback;\n  return undefined;\n};\n\nexport const findOverlayContainer = (\n  container?: Element | null,\n  preview?: Element | null\n): Element | null => {\n  const candidates = new Set<Element>();\n  const collect = (start?: Element | null) => {\n    let current: Element | null | undefined = start;\n    let depth = 0;\n    while (current && depth < 7) {\n      candidates.add(current);\n      current = current.parentElement;\n      depth += 1;\n    }\n  };\n  collect(container);\n  collect(preview);\n\n  let best: Element | null = null;\n  let bestArea = 0;\n  candidates.forEach((el) => {\n    if (!isVisible(el)) return;\n    const rect = el.getBoundingClientRect();\n    const area = rect.width * rect.height;\n    if (area > bestArea && rect.width > 240 && rect.height > 180) {\n      best = el;\n      bestArea = area;\n    }\n  });\n\n  return best ?? container ?? preview ?? null;\n};\n\nconst findBestAnchorIn = (container: Element): HTMLAnchorElement | undefined => {\n  const anchors = Array.from(container.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR));\n  const visible = anchors.filter(isVisible);\n  if (visible.length > 0) return visible[0];\n  return anchors[0];\n};\n\nconst findExpandedContainers = (): Element[] => {\n  const selectors = CONTAINER_SELECTORS.join(\",\");\n  const nodes = Array.from(document.querySelectorAll(selectors));\n  const visible = nodes.filter(isVisible);\n  return visible.length > 0 ? visible : nodes;\n};\n\nexport const detectActiveTitleContext = (): {\n  candidate: ActiveTitleCandidate | null;\n  container: Element | null;\n} => {\n  const containers = findExpandedContainers();\n\n  for (const container of containers) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor) {\n      const candidate = extractFromAnchor(anchor, \"container-anchor\");\n      if (candidate.netflixTitleId || candidate.titleText) {\n        const titleText = candidate.titleText ?? extractTitleTextNear(container);\n        const resolvedTitle = resolveTitleText(container, titleText ?? candidate.titleText);\n        return {\n          candidate: {\n            ...candidate,\n            titleText: resolvedTitle,\n            year: parseYearFromText(resolvedTitle ?? titleText)\n          },\n          container\n        };\n      }\n    }\n\n    const titleText = extractTitleTextNear(container);\n    if (titleText) {\n      const resolvedTitle = resolveTitleText(container, titleText);\n      return {\n        candidate: {\n          titleText: resolvedTitle ?? titleText,\n          year: parseYearFromText(resolvedTitle ?? titleText),\n          source: \"container-text\"\n        },\n        container\n      };\n    }\n  }\n\n  const fallbackAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (fallbackAnchor) {\n    const candidate = extractFromAnchor(fallbackAnchor, \"page-anchor\");\n    const resolvedTitle = resolveTitleText(\n      fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement,\n      candidate.titleText\n    );\n    return {\n      candidate: {\n        ...candidate,\n        titleText: resolvedTitle ?? candidate.titleText,\n        year: parseYearFromText(resolvedTitle ?? candidate.titleText)\n      },\n      container: fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement\n    };\n  }\n\n  return { candidate: null, container: null };\n};\n\nexport const detectActiveTitle = (): ActiveTitleCandidate | null => {\n  return detectActiveTitleContext().candidate;\n};\n","export interface OverlayData {\n  titleLine: string;\n  metadataLine?: string;\n  genresLine?: string;\n  communityRating?: number;\n  ratingCount?: number;\n  inWatchlist?: boolean;\n  userRating?: number;\n  matchScore?: number;\n  matchExplanation?: string;\n  debug?: {\n    titleText?: string;\n    year?: number;\n    netflixTitleId?: string;\n    href?: string;\n    tmdbId?: number;\n    tmdbVoteAverage?: number;\n    tmdbVoteCount?: number;\n    inWatchlist?: boolean;\n    userRating?: number;\n    matchScore?: number;\n    matchExplanation?: string;\n  };\n}\n\nconst OVERLAY_ID = \"nxlb-overlay-panel\";\nconst SAFE_OFFSET = { x: 16, y: 12 };\nconst positionOverrides = new WeakMap<Element, string>();\n\nconst ensureContainerPosition = (container: Element) => {\n  const computed = window.getComputedStyle(container);\n  if (computed.position !== \"static\") return;\n\n  if (!positionOverrides.has(container)) {\n    positionOverrides.set(container, container instanceof HTMLElement ? container.style.position : \"\");\n  }\n\n  if (container instanceof HTMLElement) {\n    container.style.position = \"relative\";\n    container.dataset.nxlbPositioned = \"true\";\n  }\n};\n\nconst restoreContainerPosition = (container: Element | null) => {\n  if (!container || !(container instanceof HTMLElement)) return;\n  if (!container.dataset.nxlbPositioned) return;\n\n  const previous = positionOverrides.get(container) ?? \"\";\n  container.style.position = previous;\n  delete container.dataset.nxlbPositioned;\n  positionOverrides.delete(container);\n};\n\nconst buildOverlay = (data: OverlayData): HTMLDivElement => {\n  const host = document.createElement(\"div\");\n  host.id = OVERLAY_ID;\n  host.style.position = \"absolute\";\n  host.style.inset = \"0\";\n  host.style.zIndex = \"2147483647\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n      pointer-events: none;\n      --preview-top-px: 240px;\n      --preview-bottom-px: 420px;\n      --controls-height: 64px;\n    }\n    .nxl-card {\n      position: absolute;\n      inset: 0;\n      color: #f5f5f5;\n      border-radius: 12px;\n      border: 1px solid rgba(255, 255, 255, 0.08);\n      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);\n      overflow: hidden;\n      animation: nxlFadeIn 150ms ease-out;\n    }\n    .nxl-shade {\n      position: absolute;\n      left: 0;\n      right: 0;\n      background: rgba(0, 0, 0, 0.88);\n      backdrop-filter: blur(8px);\n    }\n    .nxl-shade.top {\n      top: 0;\n      height: var(--preview-top-px);\n    }\n    .nxl-shade.bottom {\n      top: var(--preview-bottom-px);\n      bottom: 0;\n    }\n    .nxl-content {\n      position: relative;\n      z-index: 1;\n      display: grid;\n      grid-template-rows: auto auto auto auto 1fr auto;\n      gap: 12px;\n      padding: 20px;\n      height: 100%;\n      box-sizing: border-box;\n    }\n    .nxl-top {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      gap: 16px;\n    }\n    .nxl-title-section {\n      flex: 1;\n      min-width: 0;\n      max-width: 70%;\n    }\n    .nxl-title {\n      font-size: 30px;\n      font-weight: 700;\n      letter-spacing: 0.01em;\n      line-height: 1.1;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-meta {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.75);\n      margin-top: 6px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-genres {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.7);\n      margin-top: 4px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-branding {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.8);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .nxl-dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .nxl-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n    .nxl-dot.green { background: #00c46a; }\n    .nxl-dot.orange { background: #f2b34c; }\n    .nxl-dot.blue { background: #4aa8ff; }\n    .nxl-divider {\n      height: 1px;\n      width: 100%;\n      background: rgba(255, 255, 255, 0.1);\n    }\n    .nxl-metadata {\n      display: grid;\n      gap: 8px;\n      font-size: 16px;\n      color: rgba(255, 255, 255, 0.9);\n    }\n    .nxl-rating {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .nxl-star {\n      color: #e3b341;\n      font-size: 16px;\n    }\n    .nxl-match {\n      display: flex;\n      align-items: baseline;\n      gap: 8px;\n    }\n    .nxl-match-value {\n      color: #46d369;\n      font-weight: 700;\n      font-size: 20px;\n      animation: nxlPop 200ms ease-out;\n    }\n    .nxl-because {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 14px;\n    }\n    .nxl-preview {\n      min-height: 180px;\n    }\n    .nxl-controls {\n      min-height: var(--controls-height);\n    }\n    .debug {\n      margin-top: 4px;\n      padding-top: 8px;\n      border-top: 1px solid rgba(255, 255, 255, 0.08);\n      font-size: 11px;\n      opacity: 0.7;\n      display: none;\n      white-space: pre-wrap;\n    }\n    .safe .nxl-shade {\n      backdrop-filter: blur(4px);\n    }\n    @keyframes nxlFadeIn {\n      from { opacity: 0; transform: translateY(6px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n    @keyframes nxlPop {\n      0% { transform: scale(0.96); }\n      100% { transform: scale(1); }\n    }\n  `;\n\n  const panel = document.createElement(\"div\");\n  panel.className = \"nxl-card\";\n\n  const shadeTop = document.createElement(\"div\");\n  shadeTop.className = \"nxl-shade top\";\n\n  const shadeBottom = document.createElement(\"div\");\n  shadeBottom.className = \"nxl-shade bottom\";\n\n  const content = document.createElement(\"div\");\n  content.className = \"nxl-content\";\n\n  const top = document.createElement(\"div\");\n  top.className = \"nxl-top\";\n\n  const titleSection = document.createElement(\"div\");\n  titleSection.className = \"nxl-title-section\";\n\n  const title = document.createElement(\"div\");\n  title.className = \"nxl-title\";\n  title.textContent = data.titleLine;\n\n  const metaLine = document.createElement(\"div\");\n  metaLine.className = \"nxl-meta\";\n  metaLine.dataset.field = \"metadata\";\n  metaLine.textContent = data.metadataLine ?? \"TV-14 • 2 Seasons • HD\";\n\n  const genresLine = document.createElement(\"div\");\n  genresLine.className = \"nxl-genres\";\n  genresLine.dataset.field = \"genres\";\n  genresLine.textContent = data.genresLine ?? \"Genres\";\n\n  titleSection.appendChild(title);\n  titleSection.appendChild(metaLine);\n  titleSection.appendChild(genresLine);\n\n  const branding = document.createElement(\"div\");\n  branding.className = \"nxl-branding\";\n  branding.innerHTML = `\n    Powered by\n    <span class=\"nxl-dots\">\n      <span class=\"nxl-dot green\"></span>\n      <span class=\"nxl-dot orange\"></span>\n      <span class=\"nxl-dot blue\"></span>\n    </span>\n    Letterboxd\n  `;\n\n  top.appendChild(titleSection);\n  top.appendChild(branding);\n\n  const divider = document.createElement(\"div\");\n  divider.className = \"nxl-divider\";\n\n  const metadata = document.createElement(\"div\");\n  metadata.className = \"nxl-metadata\";\n\n  const communityRating = document.createElement(\"div\");\n  communityRating.className = \"nxl-rating\";\n  communityRating.dataset.field = \"communityRating\";\n  communityRating.textContent = \"Community rating: —\";\n\n  const match = document.createElement(\"div\");\n  match.className = \"nxl-match\";\n  match.dataset.field = \"match\";\n  match.textContent = \"Your match: —\";\n\n  const because = document.createElement(\"div\");\n  because.className = \"nxl-because\";\n  because.dataset.field = \"because\";\n  because.textContent = \"Because you like —\";\n\n  metadata.appendChild(communityRating);\n  metadata.appendChild(match);\n  metadata.appendChild(because);\n\n  const preview = document.createElement(\"div\");\n  preview.className = \"nxl-preview\";\n  preview.dataset.field = \"preview\";\n\n  const controls = document.createElement(\"div\");\n  controls.className = \"nxl-controls\";\n  controls.dataset.field = \"controls\";\n\n  content.appendChild(top);\n  content.appendChild(divider);\n  content.appendChild(metadata);\n  content.appendChild(preview);\n  content.appendChild(controls);\n\n  const debug = document.createElement(\"div\");\n  debug.className = \"debug\";\n  debug.dataset.field = \"debug\";\n  content.appendChild(debug);\n\n  panel.appendChild(shadeTop);\n  panel.appendChild(shadeBottom);\n  panel.appendChild(content);\n\n  shadow.appendChild(style);\n  shadow.appendChild(panel);\n\n  return host;\n};\n\nlet currentContainer: Element | null = null;\nlet currentHost: HTMLDivElement | null = null;\nlet currentAnchor: Element | null = null;\n\nconst applySafePosition = (host: HTMLDivElement, anchor: Element | null) => {\n  if (!anchor) return;\n  const rect = anchor.getBoundingClientRect();\n  host.style.position = \"fixed\";\n  host.style.top = `${Math.max(8, rect.top - SAFE_OFFSET.y)}px`;\n  host.style.left = `${Math.max(8, rect.left)}px`;\n  host.style.right = \"auto\";\n  host.style.width = `${Math.max(280, rect.width)}px`;\n  host.style.height = `${Math.max(220, rect.height)}px`;\n};\n\nconst formatRatingCount = (value?: number) => {\n  if (value === undefined) return \"\";\n  if (value >= 1_000_000) return `${(value / 1_000_000).toFixed(1)}M`;\n  if (value >= 1_000) return `${(value / 1_000).toFixed(1)}K`;\n  return `${value}`;\n};\n\nconst applyOverlayData = (data: OverlayData) => {\n  const titleEl = currentHost?.shadowRoot?.querySelector(\".nxl-title\");\n  if (titleEl) titleEl.textContent = data.titleLine;\n\n  const communityEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='communityRating']\"\n  ) as HTMLDivElement | null;\n  if (communityEl) {\n    if (data.communityRating !== undefined) {\n      const count = formatRatingCount(data.ratingCount);\n      communityEl.innerHTML = `\n        Community rating:\n        <span class=\"nxl-star\">★</span>\n        ${data.communityRating.toFixed(1)}${count ? ` <span class=\"nxl-meta\">${count} ratings</span>` : \"\"}\n      `;\n    } else {\n      communityEl.textContent = \"Community rating: —\";\n    }\n  }\n\n  const matchEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='match']\"\n  ) as HTMLDivElement | null;\n  if (matchEl) {\n    if (data.matchScore !== undefined) {\n      matchEl.innerHTML = `Your match: <span class=\"nxl-match-value\">${data.matchScore}%</span>`;\n    } else {\n      matchEl.textContent = \"Your match: —\";\n    }\n  }\n\n  const becauseEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='because']\"\n  ) as HTMLDivElement | null;\n  if (becauseEl) {\n    becauseEl.textContent = data.matchExplanation ?? \"Because you like —\";\n  }\n\n  const metaEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='metadata']\"\n  ) as HTMLDivElement | null;\n  if (metaEl) {\n    if (data.metadataLine) {\n      metaEl.style.display = \"block\";\n      metaEl.textContent = data.metadataLine;\n    } else {\n      metaEl.style.display = \"none\";\n      metaEl.textContent = \"\";\n    }\n  }\n\n  const genresEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='genres']\"\n  ) as HTMLDivElement | null;\n  if (genresEl) {\n    if (data.genresLine) {\n      genresEl.style.display = \"block\";\n      genresEl.textContent = data.genresLine;\n    } else {\n      genresEl.style.display = \"none\";\n      genresEl.textContent = \"\";\n    }\n  }\n\n  const debugEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='debug']\"\n  ) as HTMLDivElement | null;\n  if (debugEl) {\n    if (data.debug) {\n      debugEl.style.display = \"block\";\n      debugEl.textContent = JSON.stringify(data.debug, null, 2);\n    } else {\n      debugEl.style.display = \"none\";\n      debugEl.textContent = \"\";\n    }\n  }\n};\n\nexport const updateOverlay = (\n  container: Element | null,\n  data: OverlayData | null,\n  anchor: Element | null = null,\n  safeMode = false,\n  previewRegion?: {\n    top: number;\n    bottom: number;\n    containerHeight: number;\n    previewHeight: number;\n    controlsHeight: number;\n  }\n) => {\n  if (!data || (!container && !anchor)) {\n    if (currentHost) currentHost.remove();\n    restoreContainerPosition(currentContainer);\n    currentContainer = null;\n    currentHost = null;\n    currentAnchor = null;\n    return;\n  }\n\n  if (currentContainer !== container || currentAnchor !== anchor) {\n    if (currentHost) currentHost.remove();\n    restoreContainerPosition(currentContainer);\n    currentContainer = container;\n    currentAnchor = anchor;\n    currentHost = buildOverlay(data);\n\n    if (container) {\n      ensureContainerPosition(container);\n      container.appendChild(currentHost);\n      if (previewRegion) {\n        const topPx = Math.max(160, previewRegion.top - 8);\n        const bottomPx = Math.max(\n          topPx + Math.max(120, previewRegion.previewHeight),\n          previewRegion.bottom + 8\n        );\n        currentHost.style.setProperty(\"--preview-top-px\", `${topPx}px`);\n        currentHost.style.setProperty(\"--preview-bottom-px\", `${bottomPx}px`);\n        currentHost.style.setProperty(\"--controls-height\", `${previewRegion.controlsHeight}px`);\n      }\n      if (safeMode) applySafePosition(currentHost, anchor ?? container);\n    } else if (anchor) {\n      document.documentElement.appendChild(currentHost);\n      applySafePosition(currentHost, anchor);\n    }\n\n    const panel = currentHost.shadowRoot?.querySelector(\".nxl-card\");\n    if (panel) {\n      panel.classList.toggle(\"safe\", safeMode);\n    }\n\n    applyOverlayData(data);\n    return;\n  }\n\n  if (previewRegion && currentHost) {\n    const topPx = Math.max(160, previewRegion.top - 8);\n    const bottomPx = Math.max(\n      topPx + Math.max(120, previewRegion.previewHeight),\n      previewRegion.bottom + 8\n    );\n    currentHost.style.setProperty(\"--preview-top-px\", `${topPx}px`);\n    currentHost.style.setProperty(\"--preview-bottom-px\", `${bottomPx}px`);\n    currentHost.style.setProperty(\"--controls-height\", `${previewRegion.controlsHeight}px`);\n  }\n\n  const panel = currentHost?.shadowRoot?.querySelector(\".nxl-card\");\n  if (panel) {\n    panel.classList.toggle(\"safe\", safeMode);\n  }\n\n  applyOverlayData(data);\n};\n","import { log } from \"../shared/log\";\nimport { getStorage, setStorage } from \"../shared/storage\";\nimport {\n  detectActiveTitleContext,\n  extractGenresLine,\n  extractMetadataLine,\n  findOverlayContainer,\n  findOverlayAnchor,\n  findPreviewElement\n} from \"./netflixSelectors\";\nimport { updateOverlay } from \"./overlay\";\nimport type { ResolveTitleMessage, TitleResolvedMessage } from \"../shared/types\";\nimport { DEBUG } from \"../shared/log\";\n\nconst BADGE_ID = \"nxlb-debug-badge\";\nconst TOGGLE_COMBO = {\n  ctrlKey: true,\n  shiftKey: true,\n  key: \"l\"\n};\nconst OBSERVER_DEBOUNCE_MS = 250;\n\nconst ensureBadge = (enabled: boolean) => {\n  const existing = document.getElementById(BADGE_ID);\n  if (!enabled) {\n    existing?.remove();\n    return;\n  }\n\n  if (existing) return;\n\n  const host = document.createElement(\"div\");\n  host.id = BADGE_ID;\n  host.style.position = \"fixed\";\n  host.style.bottom = \"16px\";\n  host.style.right = \"16px\";\n  host.style.zIndex = \"2147483647\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Space Grotesk\", sans-serif;\n    }\n    .badge {\n      background: #111;\n      color: #f5f5f5;\n      border-radius: 999px;\n      padding: 6px 10px;\n      font-size: 11px;\n      letter-spacing: 0.08em;\n      text-transform: uppercase;\n      border: 1px solid rgba(255, 255, 255, 0.14);\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);\n    }\n  `;\n\n  const badge = document.createElement(\"div\");\n  badge.className = \"badge\";\n  badge.textContent = \"N×L active\";\n\n  shadow.appendChild(style);\n  shadow.appendChild(badge);\n  document.documentElement.appendChild(host);\n};\n\nlet overlayEnabled = true;\n\nconst applyOverlayState = async (enabled: boolean) => {\n  overlayEnabled = enabled;\n  if (!enabled) {\n    updateOverlay(null, null);\n  }\n  ensureBadge(enabled);\n};\n\nlet lastActiveKey = \"\";\nlet lastContainer: Element | null = null;\nlet debounceTimer: number | undefined;\nlet lastRequestId = \"\";\n\nconst serializeCandidate = (\n  candidate: ReturnType<typeof detectActiveTitleContext>[\"candidate\"]\n): string => {\n  if (!candidate) return \"\";\n  return [\n    candidate.netflixTitleId ?? \"\",\n    candidate.titleText ?? \"\",\n    candidate.year ?? \"\",\n    candidate.href ?? \"\"\n  ].join(\"|\");\n};\n\nconst emitActiveTitleChange = () => {\n  if (!overlayEnabled) return;\n\n  const { candidate, container } = detectActiveTitleContext();\n  const previewEl = findPreviewElement(container);\n  const overlayContainer = findOverlayContainer(container, previewEl);\n  const anchor = findOverlayAnchor(overlayContainer ?? container);\n  const metadataLine = extractMetadataLine(overlayContainer ?? container);\n  const genresLine = extractGenresLine(overlayContainer ?? container);\n  const previewRegion = (() => {\n    if (!overlayContainer || !previewEl) return undefined;\n    const containerRect = overlayContainer.getBoundingClientRect();\n    const previewRect = previewEl.getBoundingClientRect();\n    if (containerRect.height === 0) return undefined;\n    const top = Math.max(0, previewRect.top - containerRect.top);\n    const bottom = Math.max(0, previewRect.bottom - containerRect.top);\n    const controlsHeight = Math.max(0, containerRect.bottom - previewRect.bottom);\n    return {\n      top,\n      bottom,\n      containerHeight: containerRect.height,\n      previewHeight: Math.max(0, previewRect.height),\n      controlsHeight\n    };\n  })();\n  const safeMode = !overlayContainer || !previewEl;\n  const key = serializeCandidate(candidate);\n  if (!candidate) {\n    try {\n      updateOverlay(null, null);\n    } catch (error) {\n      log(\"Overlay cleanup failed\", { error });\n    }\n    lastActiveKey = \"\";\n    lastContainer = null;\n    return;\n  }\n\n  if (key === lastActiveKey && overlayContainer === lastContainer) return;\n  lastActiveKey = key;\n  lastContainer = overlayContainer;\n  log(\"Active title changed\", {\n    ...candidate,\n    at: new Date().toISOString()\n  });\n\n  const requestId = `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n  lastRequestId = requestId;\n  const message: ResolveTitleMessage = {\n    type: \"RESOLVE_TITLE\",\n    requestId,\n    payload: {\n      netflixTitleId: candidate.netflixTitleId,\n      titleText: candidate.titleText,\n      year: candidate.year,\n      href: candidate.href\n    }\n  };\n\n  chrome.runtime\n    .sendMessage(message)\n    .then((response: TitleResolvedMessage) => {\n      if (response?.type !== \"TITLE_RESOLVED\") return;\n      if (response.requestId !== lastRequestId) return;\n      log(\"Title resolved\", { requestId, response });\n\n      try {\n        updateOverlay(\n          overlayContainer,\n          {\n            titleLine,\n            metadataLine,\n            genresLine,\n            communityRating: response.payload.tmdbVoteAverage,\n            ratingCount: response.payload.tmdbVoteCount,\n            inWatchlist: response.payload.inWatchlist,\n            userRating: response.payload.userRating,\n            matchScore: response.payload.matchScore,\n            matchExplanation: response.payload.matchExplanation,\n            debug: DEBUG\n              ? {\n                ...candidate,\n                ...response.payload\n              }\n              : undefined\n          },\n          anchor,\n          safeMode,\n          previewRegion\n        );\n      } catch (error) {\n        log(\"Overlay update failed\", { error });\n      }\n    })\n    .catch((err) => {\n      log(\"Title resolve failed\", { requestId, err });\n    });\n\n  const titleLine = candidate.titleText\n    ? candidate.year\n      ? `${candidate.titleText} (${candidate.year})`\n      : candidate.titleText\n    : \"Unknown title\";\n\n  try {\n    updateOverlay(\n      overlayContainer,\n      {\n        titleLine,\n        metadataLine,\n        genresLine,\n        debug: DEBUG ? { ...candidate } : undefined\n      },\n      anchor,\n      safeMode,\n      previewRegion\n    );\n  } catch (error) {\n    log(\"Overlay update failed\", { error });\n  }\n};\n\nconst scheduleActiveTitleCheck = () => {\n  if (debounceTimer) window.clearTimeout(debounceTimer);\n  debounceTimer = window.setTimeout(() => {\n    emitActiveTitleChange();\n  }, OBSERVER_DEBOUNCE_MS);\n};\n\nconst observeTitleChanges = () => {\n  const observer = new MutationObserver(() => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Mutation observer failed\", { error });\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter: [\"class\", \"style\", \"aria-expanded\", \"aria-hidden\"]\n  });\n\n  document.addEventListener(\"pointerover\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Pointer observer failed\", { error });\n    }\n  }, true);\n  document.addEventListener(\"focusin\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Focus observer failed\", { error });\n    }\n  }, true);\n  scheduleActiveTitleCheck();\n};\n\nconst toggleOverlay = async () => {\n  const state = await getStorage();\n  const next = !(state.overlayEnabled ?? true);\n  await setStorage({ overlayEnabled: next });\n  await applyOverlayState(next);\n  if (next) scheduleActiveTitleCheck();\n  log(\"Overlay toggled\", { enabled: next });\n};\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  if (\n    event.ctrlKey === TOGGLE_COMBO.ctrlKey &&\n    event.shiftKey === TOGGLE_COMBO.shiftKey &&\n    event.key.toLowerCase() === TOGGLE_COMBO.key\n  ) {\n    event.preventDefault();\n    toggleOverlay().catch((err) => log(\"Toggle failed\", err));\n  }\n};\n\nconst init = async () => {\n  const state = await getStorage();\n  const enabled = state.overlayEnabled ?? true;\n  await applyOverlayState(enabled);\n  observeTitleChanges();\n  window.addEventListener(\"keydown\", handleKeydown);\n};\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    init().catch((err) => log(\"Init failed\", err));\n  }, { once: true });\n} else {\n  init().catch((err) => log(\"Init failed\", err));\n}\n"],"names":["log","args","getStorage","setStorage","state","TITLE_ANCHOR_SELECTOR","CONTAINER_SELECTORS","TITLE_TEXT_SELECTORS","PREVIEW_SELECTORS","EPISODE_TITLE_PATTERN","METADATA_SELECTORS","GENRE_SELECTORS","isVisible","el","rect","style","normalizeText","value","text","collectVisibleText","container","selectors","values","selector","isMetadataCandidate","lower","parseTitleIdFromHref","href","match","parseYearFromText","year","extractFromAnchor","anchor","source","netflixTitleId","titleText","extractTitleTextNear","findPrimaryTitle","nodes","node","findOverlayAnchor","findBestAnchorIn","pageAnchor","findPreviewElement","candidates","best","current","bestRect","currentRect","bestArea","extractMetadataLine","unique","extractGenresLine","resolveTitleText","fallback","cleanFallback","primary","findOverlayContainer","preview","collect","start","depth","area","anchors","visible","findExpandedContainers","detectActiveTitleContext","containers","candidate","resolvedTitle","fallbackAnchor","OVERLAY_ID","SAFE_OFFSET","positionOverrides","ensureContainerPosition","restoreContainerPosition","previous","buildOverlay","data","host","shadow","panel","shadeTop","shadeBottom","content","top","titleSection","title","metaLine","genresLine","branding","divider","metadata","communityRating","because","controls","debug","currentContainer","currentHost","currentAnchor","applySafePosition","formatRatingCount","applyOverlayData","titleEl","_a","communityEl","_b","count","matchEl","_c","becauseEl","_d","metaEl","_e","genresEl","_f","debugEl","_g","updateOverlay","safeMode","previewRegion","topPx","bottomPx","BADGE_ID","TOGGLE_COMBO","OBSERVER_DEBOUNCE_MS","ensureBadge","enabled","existing","badge","overlayEnabled","applyOverlayState","lastActiveKey","lastContainer","debounceTimer","lastRequestId","serializeCandidate","emitActiveTitleChange","previewEl","overlayContainer","metadataLine","containerRect","previewRect","bottom","controlsHeight","key","requestId","message","response","titleLine","err","scheduleActiveTitleCheck","observeTitleChanges","toggleOverlay","next","handleKeydown","event","init"],"mappings":"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"}