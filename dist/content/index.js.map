{"version":3,"file":"index.js","sources":["../../src/shared/log.ts","../../src/shared/storage.ts","../../src/content/netflixSelectors.ts","../../src/content/overlay/index.ts","../../src/content/index.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","import { log, warn } from \"./log\";\nimport type { LetterboxdExport, LetterboxdIndex, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  letterboxdExport?: LetterboxdExport;\n  lastImportAt?: string;\n  overlayEnabled?: boolean;\n  tmdbApiKey?: string;\n  tmdbCache?: Record<string, unknown>;\n  letterboxdIndex?: LetterboxdIndex;\n  letterboxdStats?: LetterboxdStats;\n  \"lb_index_v1\"?: LetterboxdIndex;\n  \"lb_stats_v1\"?: LetterboxdStats;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    \"letterboxdExport\",\n    \"lastImportAt\",\n    \"overlayEnabled\",\n    \"tmdbApiKey\",\n    \"tmdbCache\",\n    \"letterboxdIndex\",\n    \"letterboxdStats\",\n    \"lb_index_v1\",\n    \"lb_stats_v1\"\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n","export interface ActiveTitleCandidate {\n  netflixTitleId?: string;\n  titleText?: string;\n  year?: number;\n  href?: string;\n  source: string;\n}\n\nconst TITLE_ANCHOR_SELECTOR = \"a[href^='/title/']\";\n\nconst CONTAINER_SELECTORS = [\n  \"[role='dialog']\",\n  \"[aria-modal='true']\",\n  \"[aria-expanded='true']\",\n  \"[data-uia*='jawbone']\",\n  \"[class*='jawbone']\",\n  \"[data-uia*='preview']\",\n  \"[data-uia*='billboard']\",\n  \"[data-uia*='hero']\",\n  \"[data-uia*='details']\"\n];\n\nconst TITLE_TEXT_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='fallback']\",\n  \"[class*='preview'] [class*='header']\"\n];\n\nconst PREVIEW_SELECTORS = [\n  \"video\",\n  \"img\",\n  \"[data-uia*='preview'] video\",\n  \"[data-uia*='preview'] img\",\n  \"[class*='preview'] video\",\n  \"[class*='preview'] img\",\n  \"[data-uia*='player'] video\",\n  \"[data-uia*='hero'] img\"\n];\n\nconst CONTROLS_SELECTORS = [\n  \"[data-uia*='controls']\",\n  \"[class*='controls']\",\n  \"[class*='control']\",\n  \"[role='toolbar']\"\n];\n\nconst EPISODE_TITLE_PATTERN =\n  /(S\\d+\\s*:?\\s*E\\d+|Season\\s*\\d+\\s*Episode\\s*\\d+|Episode\\s*\\d+|\\bE\\d+\\b)/i;\nconst EPISODE_TIME_PATTERN = /(\\b\\d+\\s*(m|min|minutes)\\b|\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)\\b)/i;\n\nconst METADATA_SELECTORS = [\n  \"[data-uia*='maturity-rating']\",\n  \"[data-uia*='season']\",\n  \"[data-uia*='resolution']\",\n  \"[data-uia*='hd']\",\n  \"[class*='maturity']\",\n  \"[class*='season']\",\n  \"[class*='quality']\"\n];\n\nconst GENRE_SELECTORS = [\n  \"[data-uia*='genre']\",\n  \"a[href*='/genre/']\",\n  \"[class*='genre']\"\n];\n\nconst TITLE_LIKE_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='headline']\",\n  \"[class*='header']\",\n  \"[class*='name']\"\n];\n\nconst NAV_BANNED_PATTERN = /(browse|home|my list|popular)/i;\n\nconst isVisible = (el: Element): boolean => {\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  const style = window.getComputedStyle(el as HTMLElement);\n  if (style.visibility === \"hidden\" || style.display === \"none\" || style.opacity === \"0\") {\n    return false;\n  }\n  const inViewport =\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= window.innerHeight &&\n    rect.left <= window.innerWidth;\n  return inViewport;\n};\n\nconst normalizeText = (value?: string | null): string | undefined => {\n  if (!value) return undefined;\n  const text = value.replace(/\\s+/g, \" \").trim();\n  return text.length ? text : undefined;\n};\n\nconst collectVisibleText = (container: Element, selectors: string[]): string[] => {\n  const values: string[] = [];\n  selectors.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      const text = normalizeText(el.textContent);\n      if (!text) return;\n      values.push(text);\n    });\n  });\n  return values;\n};\n\nconst isMetadataCandidate = (value: string) => {\n  const lower = value.toLowerCase();\n  if (lower.includes(\"episode\")) return false;\n  if (lower.includes(\"min\")) return false;\n  if (lower.includes(\"of \")) return false;\n  if (lower.includes(\"season\") || lower.includes(\"hd\") || lower.includes(\"tv-\")) return true;\n  return true;\n};\n\nconst parseTitleIdFromHref = (href?: string | null): string | undefined => {\n  if (!href) return undefined;\n  const match = href.match(/\\/title\\/(\\d+)/);\n  return match?.[1];\n};\n\nconst parseYearFromText = (text?: string): number | undefined => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  if (Number.isNaN(year)) return undefined;\n  return year;\n};\n\nexport const normalizeNetflixTitle = (raw?: string): string | undefined => {\n  if (!raw) return undefined;\n  let value = raw;\n  value = value.replace(/^\\s*S\\d+\\s*:?\\s*E\\d+\\s*/i, \"\");\n  value = value.replace(/\"[^\"]*\"/g, (match) => {\n    const inner = match.replace(/\"/g, \"\");\n    return EPISODE_TITLE_PATTERN.test(inner) ? \"\" : match;\n  });\n  value = value.replace(/Episode\\s*\\d+/gi, \"\");\n  value = value.replace(/\\bE\\d+\\b/gi, \"\");\n  value = value.replace(EPISODE_TIME_PATTERN, \"\");\n  value = value.replace(/\\s+of\\s+\\d+\\s*(m|min|minutes)?/gi, \"\");\n  value = value.replace(/\\s+/g, \" \").trim();\n  return value.length ? value : undefined;\n};\n\nconst extractFromAnchor = (anchor: HTMLAnchorElement, source: string): ActiveTitleCandidate => {\n  const href = anchor.getAttribute(\"href\") || undefined;\n  const netflixTitleId = parseTitleIdFromHref(href);\n  const titleText = normalizeText(anchor.getAttribute(\"aria-label\") || anchor.textContent);\n  return { netflixTitleId, titleText, href, source };\n};\n\nconst extractTitleTextNear = (container: Element): string | undefined => {\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const el = container.querySelector(selector);\n    if (el && isVisible(el)) {\n      const text = normalizeText(el.textContent);\n      if (text) return text;\n    }\n  }\n  return undefined;\n};\n\nexport const getRawTitleText = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  return extractTitleTextNear(container);\n};\n\nconst findPrimaryTitle = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const nodes = Array.from(container.querySelectorAll(selector));\n    for (const node of nodes) {\n      if (!isVisible(node)) continue;\n      const text = normalizeText(node.textContent);\n      if (!text) continue;\n      if (EPISODE_TITLE_PATTERN.test(text) || EPISODE_TIME_PATTERN.test(text)) continue;\n      const normalized = normalizeNetflixTitle(text);\n      if (normalized) return normalized;\n    }\n  }\n  return undefined;\n};\n\nexport const findOverlayAnchor = (container?: Element | null): Element | null => {\n  if (container) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor && isVisible(anchor)) return anchor;\n    for (const selector of TITLE_TEXT_SELECTORS) {\n      const el = container.querySelector(selector);\n      if (el && isVisible(el)) return el;\n    }\n  }\n\n  const pageAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (pageAnchor) return pageAnchor;\n\n  const pageTitle = Array.from(document.querySelectorAll(TITLE_TEXT_SELECTORS.join(\",\"))).find(\n    isVisible\n  );\n  return pageTitle ?? null;\n};\n\nexport const findPreviewElement = (container?: Element | null): Element | null => {\n  if (!container) return null;\n  const candidates: Element[] = [];\n  PREVIEW_SELECTORS.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (isVisible(el)) candidates.push(el);\n    });\n  });\n  if (!candidates.length) return null;\n  return candidates.reduce((best, current) => {\n    const bestRect = best.getBoundingClientRect();\n    const currentRect = current.getBoundingClientRect();\n    const bestArea = bestRect.width * bestRect.height;\n    const currentArea = currentRect.width * currentRect.height;\n    return currentArea > bestArea ? current : best;\n  });\n};\n\nexport const findControlsRow = (root?: Element | null): HTMLElement | null => {\n  if (!root) return null;\n  const candidates: HTMLElement[] = [];\n  CONTROLS_SELECTORS.forEach((selector) => {\n    root.querySelectorAll<HTMLElement>(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      candidates.push(el);\n    });\n  });\n  const unique = Array.from(new Set(candidates));\n  const scored = unique\n    .map((el) => {\n      const buttons = el.querySelectorAll(\"button, [role='button']\").length;\n      const rect = el.getBoundingClientRect();\n      const score = buttons * 10 + rect.width;\n      return { el, score, top: rect.top };\n    })\n    .filter((entry) => entry.score > 0);\n  scored.sort((a, b) => b.score - a.score || b.top - a.top);\n  return scored[0]?.el ?? null;\n};\n\nexport const hasMetadataSection = (root?: Element | null): boolean => {\n  if (!root) return false;\n  const selectors = [...METADATA_SELECTORS, ...GENRE_SELECTORS].join(\",\");\n  const nodes = Array.from(root.querySelectorAll(selectors));\n  return nodes.some((node) => isVisible(node));\n};\n\nexport const findExpandedRoot = (root?: Element | null): HTMLElement | null => {\n  const candidates = findExpandedContainers();\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  for (const candidate of candidates) {\n    const rect = candidate.getBoundingClientRect();\n    if (rect.width > maxWidth || rect.height > maxHeight) continue;\n    const preview = findPreviewElement(candidate);\n    const controls = findControlsRow(candidate);\n    const metadata = hasMetadataSection(candidate);\n    if (preview && controls && metadata) {\n      return candidate as HTMLElement;\n    }\n  }\n  return null;\n};\n\nexport const extractMetadataLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, METADATA_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter(isMetadataCandidate)\n    .filter((value) => !EPISODE_TIME_PATTERN.test(value))\n    .filter((value) => value.length <= 24);\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const extractGenresLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, GENRE_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter((value) => value.length <= 24)\n    .filter((value) => !/episode|min/i.test(value));\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nconst isBannedTitleText = (text: string) => {\n  if (NAV_BANNED_PATTERN.test(text)) return true;\n  return (\n    EPISODE_TITLE_PATTERN.test(text) ||\n    EPISODE_TIME_PATTERN.test(text) ||\n    /\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)?\\b/i.test(text) ||\n    /\\b\\d+\\s*(m|min|minutes)\\b/i.test(text)\n  );\n};\n\nconst isInProgressRegion = (el: Element, controlsTop?: number) => {\n  if (el.closest('[role=\"progressbar\"], [data-uia*=\"progress\"], [class*=\"progress\"]')) {\n    return true;\n  }\n  if (controlsTop !== undefined) {\n    const rect = el.getBoundingClientRect();\n    return rect.bottom >= controlsTop - 8;\n  }\n  return false;\n};\n\nexport const extractDisplayTitle = (expandedRoot: HTMLElement): {\n  title: string | null;\n  chosen?: Element;\n  rejectedCount: number;\n} => {\n  const rootRect = expandedRoot.getBoundingClientRect();\n  const controls = findControlsRow(expandedRoot);\n  const controlsTop = controls ? controls.getBoundingClientRect().top : undefined;\n  const candidates = Array.from(expandedRoot.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n  let best: { el: Element; score: number; text: string } | null = null;\n  let rejectedCount = 0;\n  const episodeNodes: Element[] = [];\n\n  candidates.forEach((el) => {\n    if (!isVisible(el)) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isInProgressRegion(el, controlsTop)) {\n      rejectedCount += 1;\n      return;\n    }\n    const text = normalizeText(el.textContent);\n    if (!text || text.length < 2 || text.length > 80) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isBannedTitleText(text)) {\n      episodeNodes.push(el);\n      rejectedCount += 1;\n      return;\n    }\n\n    const rect = el.getBoundingClientRect();\n    const style = window.getComputedStyle(el as HTMLElement);\n    const fontSize = parseFloat(style.fontSize) || 14;\n    const fontWeightRaw = style.fontWeight === \"bold\" ? 700 : Number(style.fontWeight);\n    const fontWeight = Number.isNaN(fontWeightRaw) ? 400 : fontWeightRaw;\n    const dx = rect.left - rootRect.left;\n    const dy = rect.top - rootRect.top;\n    const dist = Math.hypot(dx, dy);\n    const score = fontSize * 10 + fontWeight / 10 + Math.max(0, 300 - dist);\n    if (!best || score > best.score) {\n      best = { el, score, text };\n    }\n  });\n\n  if (best) {\n    const normalized = normalizeNetflixTitle(best.text);\n    return { title: normalized ?? best.text, chosen: best.el, rejectedCount };\n  }\n\n  for (const episodeNode of episodeNodes) {\n    let current: Element | null = episodeNode.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const siblingCandidates = Array.from(\n        current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\"))\n      ).filter((el) => el !== episodeNode);\n      for (const sibling of siblingCandidates) {\n        if (!isVisible(sibling)) continue;\n        if (isInProgressRegion(sibling, controlsTop)) continue;\n        const text = normalizeText(sibling.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: sibling,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  const anchor = expandedRoot.querySelector(\"a[href^='/title/']\");\n  if (anchor) {\n    const heading = anchor.querySelector(TITLE_LIKE_SELECTORS.join(\",\"));\n    const directText = normalizeText(heading?.textContent || anchor.textContent);\n    if (directText && !isBannedTitleText(directText)) {\n      return {\n        title: normalizeNetflixTitle(directText) ?? directText,\n        chosen: heading ?? anchor,\n        rejectedCount\n      };\n    }\n\n    let current: Element | null = anchor.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const nearby = Array.from(current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n      for (const node of nearby) {\n        if (!isVisible(node)) continue;\n        if (isInProgressRegion(node, controlsTop)) continue;\n        const text = normalizeText(node.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: node,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  return { title: null, rejectedCount };\n};\n\nexport const resolveTitleText = (\n  container?: Element | null,\n  fallback?: string\n): string | undefined => {\n  const primary = findPrimaryTitle(container);\n  if (primary) return primary;\n\n  const normalizedFallback = normalizeNetflixTitle(fallback);\n  if (normalizedFallback && !EPISODE_TITLE_PATTERN.test(normalizedFallback)) {\n    return normalizedFallback;\n  }\n\n  if (fallback) return normalizeNetflixTitle(fallback) ?? fallback;\n  return undefined;\n};\n\nexport const findOverlayContainer = (\n  container?: Element | null,\n  preview?: Element | null\n): Element | null => {\n  const candidates = new Set<Element>();\n  const collect = (start?: Element | null) => {\n    let current: Element | null | undefined = start;\n    let depth = 0;\n    while (current && depth < 7) {\n      candidates.add(current);\n      current = current.parentElement;\n      depth += 1;\n    }\n  };\n  collect(container);\n  collect(preview);\n\n  let best: Element | null = null;\n  let bestArea = 0;\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  candidates.forEach((el) => {\n    if (!isVisible(el)) return;\n    const rect = el.getBoundingClientRect();\n    const area = rect.width * rect.height;\n    if (rect.width > maxWidth || rect.height > maxHeight) return;\n    if (area > bestArea && rect.width > 240 && rect.height > 180) {\n      best = el;\n      bestArea = area;\n    }\n  });\n\n  if (best) return best;\n  const isValid = (el?: Element | null) => {\n    if (!el) return false;\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    return rect.width <= maxWidth && rect.height <= maxHeight;\n  };\n  if (isValid(container)) return container ?? null;\n  if (isValid(preview)) return preview ?? null;\n  return null;\n};\n\nconst findBestAnchorIn = (container: Element): HTMLAnchorElement | undefined => {\n  const anchors = Array.from(container.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR));\n  const visible = anchors.filter(isVisible);\n  if (visible.length > 0) return visible[0];\n  return anchors[0];\n};\n\nconst findExpandedContainers = (): Element[] => {\n  const selectors = CONTAINER_SELECTORS.join(\",\");\n  const nodes = Array.from(document.querySelectorAll(selectors));\n  const visible = nodes.filter(isVisible);\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  const filtered = visible.filter((el) => {\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    if (rect.width < 240 || rect.height < 180) return false;\n    if (rect.width > maxWidth || rect.height > maxHeight) return false;\n    return true;\n  });\n  if (filtered.length > 0) {\n    return filtered.sort((a, b) => {\n      const ra = a.getBoundingClientRect();\n      const rb = b.getBoundingClientRect();\n      return rb.width * rb.height - ra.width * ra.height;\n    });\n  }\n  return visible.length > 0 ? visible : nodes;\n};\n\nexport const detectActiveTitleContext = (): {\n  candidate: ActiveTitleCandidate | null;\n  container: Element | null;\n} => {\n  const containers = findExpandedContainers();\n\n  for (const container of containers) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor) {\n      const candidate = extractFromAnchor(anchor, \"container-anchor\");\n      if (candidate.netflixTitleId || candidate.titleText) {\n        const titleText = candidate.titleText ?? extractTitleTextNear(container);\n        const resolvedTitle = resolveTitleText(container, titleText ?? candidate.titleText);\n        return {\n          candidate: {\n            ...candidate,\n            titleText: resolvedTitle,\n            year: parseYearFromText(resolvedTitle ?? titleText)\n          },\n          container\n        };\n      }\n    }\n\n    const titleText = extractTitleTextNear(container);\n    if (titleText) {\n      const resolvedTitle = resolveTitleText(container, titleText);\n      return {\n        candidate: {\n          titleText: resolvedTitle ?? titleText,\n          year: parseYearFromText(resolvedTitle ?? titleText),\n          source: \"container-text\"\n        },\n        container\n      };\n    }\n  }\n\n  const fallbackAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (fallbackAnchor) {\n    const candidate = extractFromAnchor(fallbackAnchor, \"page-anchor\");\n    const resolvedTitle = resolveTitleText(\n      fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement,\n      candidate.titleText\n    );\n    return {\n      candidate: {\n        ...candidate,\n        titleText: resolvedTitle ?? candidate.titleText,\n        year: parseYearFromText(resolvedTitle ?? candidate.titleText)\n      },\n      container: fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement\n    };\n  }\n\n  return { candidate: null, container: null };\n};\n\nexport const detectActiveTitle = (): ActiveTitleCandidate | null => {\n  return detectActiveTitleContext().candidate;\n};\n","export interface OverlayData {\n  communityRating?: number;\n  ratingCount?: number;\n  matchScore?: number;\n  matchExplanation?: string;\n}\n\nconst TOP_SECTION_ID = \"nxlb-top-section\";\n\nconst buildTopSection = (data: OverlayData): HTMLDivElement => {\n  const host = document.createElement(\"div\");\n  host.id = TOP_SECTION_ID;\n  host.style.display = \"block\";\n  host.style.width = \"100%\";\n  host.style.pointerEvents = \"none\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n      pointer-events: none;\n      display: block;\n      width: 100%;\n      box-sizing: border-box;\n      opacity: 0;\n      transform: translateY(-8px);\n      transition: opacity 180ms cubic-bezier(0.2, 0, 0, 1),\n        transform 180ms cubic-bezier(0.2, 0, 0, 1);\n      will-change: opacity, transform;\n    }\n    :host(.nxl-visible) {\n      opacity: 1;\n      transform: translateY(0);\n    }\n    .nxl-top-section {\n      background: rgba(0, 0, 0, 0.82);\n      color: #f5f5f5;\n      padding: 16px 20px;\n      border-top-left-radius: 12px;\n      border-top-right-radius: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      display: grid;\n      gap: 8px;\n      box-sizing: border-box;\n    }\n    .nxl-header {\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n      gap: 16px;\n    }\n    .nxl-branding {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.85);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .nxl-dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .nxl-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 999px;\n      display: inline-block;\n    }\n    .nxl-dot.green { background: #00c46a; }\n    .nxl-dot.orange { background: #f2b34c; }\n    .nxl-dot.blue { background: #4aa8ff; }\n    .nxl-body {\n      display: grid;\n      gap: 6px;\n      font-size: 15px;\n      color: rgba(255, 255, 255, 0.9);\n    }\n    .nxl-rating {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .nxl-star {\n      color: #e3b341;\n      font-size: 16px;\n    }\n    .nxl-match {\n      display: flex;\n      align-items: baseline;\n      gap: 8px;\n    }\n    .nxl-match-value {\n      color: #46d369;\n      font-weight: 700;\n      font-size: 20px;\n    }\n    .nxl-because {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 14px;\n    }\n  `;\n\n  const section = document.createElement(\"div\");\n  section.className = \"nxl-top-section\";\n\n  const header = document.createElement(\"div\");\n  header.className = \"nxl-header\";\n\n  const branding = document.createElement(\"div\");\n  branding.className = \"nxl-branding\";\n  branding.innerHTML = `\n    Powered by\n    <span class=\"nxl-dots\">\n      <span class=\"nxl-dot green\"></span>\n      <span class=\"nxl-dot orange\"></span>\n      <span class=\"nxl-dot blue\"></span>\n    </span>\n    Letterboxd\n  `;\n\n  header.appendChild(branding);\n\n  const body = document.createElement(\"div\");\n  body.className = \"nxl-body\";\n\n  const communityRating = document.createElement(\"div\");\n  communityRating.className = \"nxl-rating\";\n  communityRating.dataset.field = \"communityRating\";\n  communityRating.textContent = \"Community rating: —\";\n\n  const match = document.createElement(\"div\");\n  match.className = \"nxl-match\";\n  match.dataset.field = \"match\";\n  match.textContent = \"Your match: —\";\n\n  const because = document.createElement(\"div\");\n  because.className = \"nxl-because\";\n  because.dataset.field = \"because\";\n  because.textContent = \"Because you like: —\";\n\n  body.appendChild(communityRating);\n  body.appendChild(match);\n  body.appendChild(because);\n\n  section.appendChild(header);\n  section.appendChild(body);\n\n  shadow.appendChild(style);\n  shadow.appendChild(section);\n\n  return host;\n};\n\nlet currentRoot: HTMLElement | null = null;\nlet currentHost: HTMLDivElement | null = null;\n\nconst formatRatingCount = (value?: number) => {\n  if (value === undefined) return \"\";\n  if (value >= 1_000_000) return `${(value / 1_000_000).toFixed(1)}M`;\n  if (value >= 1_000) return `${(value / 1_000).toFixed(1)}K`;\n  return `${value}`;\n};\n\nconst applyTopSectionData = (data: OverlayData) => {\n  const communityEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='communityRating']\"\n  ) as HTMLDivElement | null;\n  if (communityEl) {\n    if (data.communityRating !== undefined) {\n      const count = formatRatingCount(data.ratingCount);\n      communityEl.innerHTML = `\n        Community rating:\n        <span class=\"nxl-star\">★</span>\n        ${data.communityRating.toFixed(1)}${count ? ` <span class=\"nxl-meta\">${count} ratings</span>` : \"\"}\n      `;\n    } else {\n      communityEl.textContent = \"Community rating: —\";\n    }\n  }\n\n  const matchEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='match']\"\n  ) as HTMLDivElement | null;\n  if (matchEl) {\n    if (data.matchScore !== undefined) {\n      matchEl.innerHTML = `Your match: <span class=\"nxl-match-value\">${data.matchScore}%</span>`;\n    } else {\n      matchEl.textContent = \"Your match: —\";\n    }\n  }\n\n  const becauseEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='because']\"\n  ) as HTMLDivElement | null;\n  if (becauseEl) {\n    becauseEl.textContent = data.matchExplanation\n      ? `Because you like: ${data.matchExplanation.replace(/^Because you like\\\\s*/i, \"\")}`\n      : \"Because you like: —\";\n  }\n};\n\nexport const injectTopSection = (expandedRoot: HTMLElement, data: OverlayData): boolean => {\n  const isNewRoot = currentRoot !== expandedRoot;\n  if (isNewRoot) {\n    if (currentHost) currentHost.remove();\n    currentRoot = expandedRoot;\n    currentHost = buildTopSection(data);\n    expandedRoot.insertBefore(currentHost, expandedRoot.firstChild);\n    requestAnimationFrame(() => {\n      currentHost?.classList.add(\"nxl-visible\");\n    });\n  }\n\n  applyTopSectionData(data);\n  return isNewRoot;\n};\n\nexport const removeTopSection = () => {\n  if (currentHost) currentHost.remove();\n  currentRoot = null;\n  currentHost = null;\n};\n","import { log } from \"../shared/log\";\nimport { getStorage, setStorage } from \"../shared/storage\";\nimport {\n  detectActiveTitleContext,\n  extractDisplayTitle,\n  findExpandedRoot,\n  findOverlayAnchor,\n  findPreviewElement,\n  getRawTitleText,\n  normalizeNetflixTitle\n} from \"./netflixSelectors\";\nimport { injectTopSection, removeTopSection } from \"./overlay\";\nimport type { ResolveTitleMessage, TitleResolvedMessage } from \"../shared/types\";\nimport { DEBUG } from \"../shared/log\";\n\nconst BADGE_ID = \"nxlb-status-badge\";\nconst TOGGLE_COMBO = {\n  ctrlKey: true,\n  shiftKey: true,\n  key: \"l\"\n};\nconst OBSERVER_DEBOUNCE_MS = 250;\nconst HERO_WIDTH_THRESHOLD = 0.85;\nconst HERO_HEIGHT_THRESHOLD = 0.6;\n\nconst ensureBadge = (enabled: boolean) => {\n  const existing = document.getElementById(BADGE_ID);\n  if (!enabled) {\n    if (existing) {\n      existing.remove();\n      log(\"OVERLAY_BADGE_REMOVED\");\n    }\n    return;\n  }\n\n  if (existing) return;\n\n  const host = document.createElement(\"div\");\n  host.id = BADGE_ID;\n  host.style.position = \"fixed\";\n  host.style.bottom = \"16px\";\n  host.style.right = \"16px\";\n  host.style.zIndex = \"2147483647\";\n  host.style.pointerEvents = \"none\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n    }\n    .badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      background: rgba(0, 0, 0, 0.8);\n      border: 1px solid rgba(255, 255, 255, 0.12);\n      border-radius: 999px;\n      padding: 8px 12px;\n      color: #f5f5f5;\n      font-size: 12px;\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);\n      pointer-events: auto;\n      position: relative;\n    }\n    .dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n    .dot.orange { background: #f2b34c; }\n    .dot.green { background: #00c46a; }\n    .dot.blue { background: #4aa8ff; }\n    .status {\n      width: 6px;\n      height: 6px;\n      border-radius: 50%;\n      background: #46d369;\n      box-shadow: 0 0 6px rgba(70, 211, 105, 0.6);\n    }\n    .tooltip {\n      position: absolute;\n      bottom: calc(100% + 8px);\n      right: 0;\n      background: rgba(0, 0, 0, 0.9);\n      color: #f5f5f5;\n      font-size: 11px;\n      padding: 6px 8px;\n      border-radius: 8px;\n      opacity: 0;\n      transform: translateY(4px);\n      transition: opacity 120ms ease, transform 120ms ease;\n      white-space: nowrap;\n      pointer-events: none;\n    }\n    .badge:hover .tooltip {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  `;\n\n  const badge = document.createElement(\"div\");\n  badge.className = \"badge\";\n  badge.innerHTML = `\n    <span class=\"dots\">\n      <span class=\"dot orange\"></span>\n      <span class=\"dot green\"></span>\n      <span class=\"dot blue\"></span>\n    </span>\n    <span>Letterboxd</span>\n    <span class=\"status\" aria-hidden=\"true\"></span>\n    <span class=\"tooltip\">Netflix × Letterboxd overlay enabled</span>\n  `;\n\n  shadow.appendChild(style);\n  shadow.appendChild(badge);\n  document.documentElement.appendChild(host);\n  log(\"OVERLAY_BADGE_MOUNTED\");\n};\n\nlet overlayEnabled = true;\n\nconst applyOverlayState = async (enabled: boolean) => {\n  overlayEnabled = enabled;\n  if (!enabled) {\n    updateOverlay(null, null);\n  }\n  ensureBadge(enabled);\n};\n\nlet lastActiveKey = \"\";\nlet lastContainer: Element | null = null;\nlet debounceTimer: number | undefined;\nlet lastRequestId = \"\";\nlet lastOutlined: HTMLElement | null = null;\n\nconst describeElement = (el: Element | null) => {\n  if (!el) return \"none\";\n  const parts = [el.tagName.toLowerCase()];\n  const className = (el as HTMLElement).className;\n  if (className) {\n    parts.push(\n      \".\" +\n        className\n          .toString()\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 3)\n          .join(\".\")\n    );\n  }\n  const dataUia = (el as HTMLElement).getAttribute?.(\"data-uia\");\n  if (dataUia) parts.push(`[data-uia=\\\"${dataUia}\\\"]`);\n  return parts.join(\"\");\n};\n\nconst isWatchPage = () => window.location.pathname.startsWith(\"/watch\");\n\nconst hasMainPlayerVideo = () => {\n  const videos = Array.from(document.querySelectorAll(\"video\"));\n  return videos.some((video) => {\n    const rect = video.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    const widthRatio = rect.width / window.innerWidth;\n    const heightRatio = rect.height / window.innerHeight;\n    return widthRatio > 0.85 || heightRatio > 0.6;\n  });\n};\n\nconst hasEpisodeHeaderVisible = () => {\n  const candidates = Array.from(\n    document.querySelectorAll(\"h1, h2, h3, [data-uia*='episode'], [class*='episode']\")\n  );\n  return candidates.some((el) => {\n    if (el instanceof HTMLElement) {\n      const rect = el.getBoundingClientRect();\n      if (rect.width === 0 || rect.height === 0) return false;\n      const text = el.textContent ?? \"\";\n      return /episode/i.test(text);\n    }\n    return false;\n  });\n};\n\nconst isHeroSized = (el: Element | null) => {\n  if (!el) return false;\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  return (\n    rect.width > window.innerWidth * HERO_WIDTH_THRESHOLD ||\n    rect.height > window.innerHeight * HERO_HEIGHT_THRESHOLD\n  );\n};\n\nconst updateDebugOutline = (container: HTMLElement | null) => {\n  if (lastOutlined && lastOutlined !== container) {\n    lastOutlined.style.outline = \"\";\n    lastOutlined.style.outlineOffset = \"\";\n    lastOutlined = null;\n  }\n  if (container && DEBUG) {\n    container.style.outline = \"1px solid rgba(255, 80, 80, 0.85)\";\n    container.style.outlineOffset = \"-1px\";\n    lastOutlined = container;\n  }\n};\n\nconst serializeCandidate = (\n  candidate: ReturnType<typeof detectActiveTitleContext>[\"candidate\"]\n): string => {\n  if (!candidate) return \"\";\n  return [\n    candidate.netflixTitleId ?? \"\",\n    candidate.titleText ?? \"\",\n    candidate.year ?? \"\",\n    candidate.href ?? \"\"\n  ].join(\"|\");\n};\n\nconst emitActiveTitleChange = () => {\n  if (!overlayEnabled) return;\n\n  if (isWatchPage()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"watch-page\" });\n    removeTopSection();\n    ensureBadge(false);\n    return;\n  }\n\n  if (hasMainPlayerVideo()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"main-player-video\" });\n    removeTopSection();\n    ensureBadge(false);\n    return;\n  }\n\n  if (hasEpisodeHeaderVisible()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"episode-header-visible\" });\n    removeTopSection();\n    ensureBadge(false);\n    return;\n  }\n\n  const { candidate, container } = detectActiveTitleContext();\n  const previewEl = findPreviewElement(container);\n  const expandedRoot = findExpandedRoot(container) ?? (container as HTMLElement | null);\n  const anchor = findOverlayAnchor(expandedRoot ?? container);\n  const anchorInRoot = expandedRoot?.querySelector(\"a[href^='/title/']\") as\n    | HTMLAnchorElement\n    | null;\n  if (anchorInRoot) {\n    const href = anchorInRoot.getAttribute(\"href\") ?? undefined;\n    const match = href?.match(/\\/title\\/(\\d+)/);\n    if (match) candidate && (candidate.netflixTitleId = match[1]);\n    if (href) candidate && (candidate.href = href);\n  }\n  if (!expandedRoot || !previewEl) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"no-overlay-container\",\n        anchor: describeElement(anchor),\n        container: describeElement(expandedRoot)\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    ensureBadge(false);\n    return;\n  }\n  if (isHeroSized(anchor) || isHeroSized(expandedRoot)) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"hero-sized-anchor\",\n        anchor: describeElement(anchor),\n        container: describeElement(expandedRoot)\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    ensureBadge(false);\n    return;\n  }\n  updateDebugOutline(expandedRoot);\n  if (!candidate) {\n    try {\n      removeTopSection();\n    } catch (error) {\n      log(\"Overlay cleanup failed\", { error });\n    }\n    updateDebugOutline(null);\n    lastActiveKey = \"\";\n    lastContainer = null;\n    return;\n  }\n\n  const displayTitle = extractDisplayTitle(expandedRoot);\n  if (!displayTitle.title) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"no-display-title\",\n        rejectedTitleCandidates: displayTitle.rejectedCount\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    ensureBadge(false);\n    return;\n  }\n  const resolvedTitle = displayTitle.title;\n  const key = serializeCandidate({ ...candidate, titleText: resolvedTitle });\n  if (key === lastActiveKey && expandedRoot === lastContainer) return;\n  lastActiveKey = key;\n  lastContainer = expandedRoot;\n  if (DEBUG) {\n    const rawTitle = getRawTitleText(expandedRoot ?? container);\n    const normalizedTitle = normalizeNetflixTitle(rawTitle ?? candidate.titleText);\n    log(\"Active title changed\", {\n      ...candidate,\n      anchor: describeElement(anchor),\n      container: describeElement(expandedRoot),\n      expandedRootSnippet: expandedRoot?.outerHTML.slice(0, 200),\n      rawTitle,\n      normalizedTitle,\n      chosenTitle: displayTitle.title,\n      rejectedTitleCandidates: displayTitle.rejectedCount,\n      chosenTitleElement: displayTitle.chosen\n        ? displayTitle.chosen.outerHTML.slice(0, 200)\n        : undefined,\n      at: new Date().toISOString()\n    });\n  }\n\n  const requestId = `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n  lastRequestId = requestId;\n  const message: ResolveTitleMessage = {\n    type: \"RESOLVE_TITLE\",\n    requestId,\n    payload: {\n      netflixTitleId: candidate.netflixTitleId,\n      titleText: resolvedTitle,\n      year: candidate.year,\n      href: candidate.href\n    }\n  };\n\n  chrome.runtime\n    .sendMessage(message)\n    .then((response: TitleResolvedMessage) => {\n      if (response?.type !== \"TITLE_RESOLVED\") return;\n      if (response.requestId !== lastRequestId) return;\n      log(\"Title resolved\", { requestId, response });\n\n      try {\n        const didInject = injectTopSection(expandedRoot, {\n          communityRating: response.payload.tmdbVoteAverage,\n          ratingCount: response.payload.tmdbVoteCount,\n          matchScore: response.payload.matchScore,\n          matchExplanation: response.payload.matchExplanation\n        });\n        if (DEBUG && didInject) {\n          log(\"Injected top section\", { container: describeElement(expandedRoot) });\n        }\n        ensureBadge(true);\n      } catch (error) {\n        log(\"Overlay update failed\", { error });\n      }\n    })\n    .catch((err) => {\n      log(\"Title resolve failed\", { requestId, err });\n    });\n\n  try {\n    const didInject = injectTopSection(expandedRoot, {});\n    if (DEBUG && didInject) {\n      log(\"Injected top section\", { container: describeElement(expandedRoot) });\n    }\n    ensureBadge(true);\n  } catch (error) {\n    log(\"Overlay update failed\", { error });\n  }\n};\n\nconst scheduleActiveTitleCheck = () => {\n  if (debounceTimer) window.clearTimeout(debounceTimer);\n  debounceTimer = window.setTimeout(() => {\n    emitActiveTitleChange();\n  }, OBSERVER_DEBOUNCE_MS);\n};\n\nconst observeTitleChanges = () => {\n  const observer = new MutationObserver(() => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Mutation observer failed\", { error });\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter: [\"class\", \"style\", \"aria-expanded\", \"aria-hidden\"]\n  });\n\n  document.addEventListener(\"pointerover\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Pointer observer failed\", { error });\n    }\n  }, true);\n  document.addEventListener(\"focusin\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Focus observer failed\", { error });\n    }\n  }, true);\n  scheduleActiveTitleCheck();\n};\n\nconst toggleOverlay = async () => {\n  const state = await getStorage();\n  const next = !(state.overlayEnabled ?? true);\n  await setStorage({ overlayEnabled: next });\n  await applyOverlayState(next);\n  if (next) scheduleActiveTitleCheck();\n  log(\"Overlay toggled\", { enabled: next });\n};\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  if (\n    event.ctrlKey === TOGGLE_COMBO.ctrlKey &&\n    event.shiftKey === TOGGLE_COMBO.shiftKey &&\n    event.key.toLowerCase() === TOGGLE_COMBO.key\n  ) {\n    event.preventDefault();\n    toggleOverlay().catch((err) => log(\"Toggle failed\", err));\n  }\n};\n\nconst init = async () => {\n  const state = await getStorage();\n  const enabled = state.overlayEnabled ?? true;\n  await applyOverlayState(enabled);\n  observeTitleChanges();\n  window.addEventListener(\"keydown\", handleKeydown);\n};\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    init().catch((err) => log(\"Init failed\", err));\n  }, { once: true });\n} else {\n  init().catch((err) => log(\"Init failed\", err));\n}\n"],"names":["log","args","getStorage","setStorage","state","TITLE_ANCHOR_SELECTOR","CONTAINER_SELECTORS","TITLE_TEXT_SELECTORS","PREVIEW_SELECTORS","CONTROLS_SELECTORS","EPISODE_TITLE_PATTERN","EPISODE_TIME_PATTERN","METADATA_SELECTORS","GENRE_SELECTORS","TITLE_LIKE_SELECTORS","NAV_BANNED_PATTERN","isVisible","el","rect","style","normalizeText","value","text","parseTitleIdFromHref","href","match","parseYearFromText","year","normalizeNetflixTitle","raw","inner","extractFromAnchor","anchor","source","netflixTitleId","titleText","extractTitleTextNear","container","selector","findPrimaryTitle","nodes","node","normalized","findOverlayAnchor","findBestAnchorIn","pageAnchor","findPreviewElement","candidates","best","current","bestRect","currentRect","bestArea","findControlsRow","root","scored","buttons","score","entry","a","b","_a","hasMetadataSection","selectors","findExpandedRoot","findExpandedContainers","maxWidth","maxHeight","candidate","preview","controls","metadata","isBannedTitleText","isInProgressRegion","controlsTop","extractDisplayTitle","expandedRoot","rootRect","rejectedCount","episodeNodes","fontSize","fontWeightRaw","fontWeight","dx","dy","dist","episodeNode","depth","siblingCandidates","sibling","heading","directText","nearby","resolveTitleText","fallback","primary","normalizedFallback","anchors","visible","filtered","ra","rb","detectActiveTitleContext","containers","resolvedTitle","fallbackAnchor","TOP_SECTION_ID","buildTopSection","data","host","shadow","section","header","branding","body","communityRating","because","currentRoot","currentHost","formatRatingCount","applyTopSectionData","communityEl","count","matchEl","_b","becauseEl","_c","injectTopSection","isNewRoot","removeTopSection","BADGE_ID","TOGGLE_COMBO","OBSERVER_DEBOUNCE_MS","HERO_WIDTH_THRESHOLD","HERO_HEIGHT_THRESHOLD","ensureBadge","enabled","existing","badge","overlayEnabled","applyOverlayState","lastActiveKey","lastContainer","debounceTimer","lastRequestId","lastOutlined","describeElement","parts","className","dataUia","isWatchPage","hasMainPlayerVideo","video","widthRatio","heightRatio","hasEpisodeHeaderVisible","isHeroSized","updateDebugOutline","serializeCandidate","emitActiveTitleChange","previewEl","anchorInRoot","displayTitle","key","requestId","message","response","didInject","err","scheduleActiveTitleCheck","observeTitleChanges","toggleOverlay","next","handleKeydown","event","init"],"mappings":"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"}