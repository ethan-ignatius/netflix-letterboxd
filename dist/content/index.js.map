{"version":3,"file":"index.js","sources":["../../src/shared/log.ts","../../src/shared/storage.ts","../../src/content/netflixSelectors.ts","../../src/content/overlay/index.ts","../../src/content/index.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","import { log, warn } from \"./log\";\nimport type { LetterboxdExport, LetterboxdIndex, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  letterboxdExport?: LetterboxdExport;\n  lastImportAt?: string;\n  overlayEnabled?: boolean;\n  tmdbApiKey?: string;\n  tmdbCache?: Record<string, unknown>;\n  letterboxdIndex?: LetterboxdIndex;\n  letterboxdStats?: LetterboxdStats;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    \"letterboxdExport\",\n    \"lastImportAt\",\n    \"overlayEnabled\",\n    \"tmdbApiKey\",\n    \"tmdbCache\",\n    \"letterboxdIndex\",\n    \"letterboxdStats\"\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n","export interface ActiveTitleCandidate {\n  netflixTitleId?: string;\n  titleText?: string;\n  year?: number;\n  href?: string;\n  source: string;\n}\n\nconst TITLE_ANCHOR_SELECTOR = \"a[href^='/title/']\";\n\nconst CONTAINER_SELECTORS = [\n  \"[role='dialog']\",\n  \"[aria-modal='true']\",\n  \"[aria-expanded='true']\",\n  \"[data-uia*='jawbone']\",\n  \"[class*='jawbone']\",\n  \"[data-uia*='preview']\",\n  \"[data-uia*='billboard']\",\n  \"[data-uia*='hero']\",\n  \"[data-uia*='details']\"\n];\n\nconst TITLE_TEXT_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='fallback']\",\n  \"[class*='preview'] [class*='header']\"\n];\n\nconst PREVIEW_SELECTORS = [\n  \"video\",\n  \"img\",\n  \"[data-uia*='preview'] video\",\n  \"[data-uia*='preview'] img\",\n  \"[class*='preview'] video\",\n  \"[class*='preview'] img\",\n  \"[data-uia*='player'] video\",\n  \"[data-uia*='hero'] img\"\n];\n\nconst CONTROLS_SELECTORS = [\n  \"[data-uia*='controls']\",\n  \"[class*='controls']\",\n  \"[class*='control']\",\n  \"[role='toolbar']\"\n];\n\nconst EPISODE_TITLE_PATTERN =\n  /(S\\d+\\s*:?\\s*E\\d+|Season\\s*\\d+\\s*Episode\\s*\\d+|Episode\\s*\\d+|\\bE\\d+\\b)/i;\nconst EPISODE_TIME_PATTERN = /(\\b\\d+\\s*(m|min|minutes)\\b|\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)\\b)/i;\n\nconst METADATA_SELECTORS = [\n  \"[data-uia*='maturity-rating']\",\n  \"[data-uia*='season']\",\n  \"[data-uia*='resolution']\",\n  \"[data-uia*='hd']\",\n  \"[class*='maturity']\",\n  \"[class*='season']\",\n  \"[class*='quality']\"\n];\n\nconst GENRE_SELECTORS = [\n  \"[data-uia*='genre']\",\n  \"a[href*='/genre/']\",\n  \"[class*='genre']\"\n];\n\nconst TITLE_LIKE_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='headline']\",\n  \"[class*='header']\",\n  \"[class*='name']\"\n];\n\nconst isVisible = (el: Element): boolean => {\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  const style = window.getComputedStyle(el as HTMLElement);\n  if (style.visibility === \"hidden\" || style.display === \"none\" || style.opacity === \"0\") {\n    return false;\n  }\n  const inViewport =\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= window.innerHeight &&\n    rect.left <= window.innerWidth;\n  return inViewport;\n};\n\nconst normalizeText = (value?: string | null): string | undefined => {\n  if (!value) return undefined;\n  const text = value.replace(/\\s+/g, \" \").trim();\n  return text.length ? text : undefined;\n};\n\nconst collectVisibleText = (container: Element, selectors: string[]): string[] => {\n  const values: string[] = [];\n  selectors.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      const text = normalizeText(el.textContent);\n      if (!text) return;\n      values.push(text);\n    });\n  });\n  return values;\n};\n\nconst isMetadataCandidate = (value: string) => {\n  const lower = value.toLowerCase();\n  if (lower.includes(\"episode\")) return false;\n  if (lower.includes(\"min\")) return false;\n  if (lower.includes(\"of \")) return false;\n  if (lower.includes(\"season\") || lower.includes(\"hd\") || lower.includes(\"tv-\")) return true;\n  return true;\n};\n\nconst parseTitleIdFromHref = (href?: string | null): string | undefined => {\n  if (!href) return undefined;\n  const match = href.match(/\\/title\\/(\\d+)/);\n  return match?.[1];\n};\n\nconst parseYearFromText = (text?: string): number | undefined => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  if (Number.isNaN(year)) return undefined;\n  return year;\n};\n\nexport const normalizeNetflixTitle = (raw?: string): string | undefined => {\n  if (!raw) return undefined;\n  let value = raw;\n  value = value.replace(/^\\s*S\\d+\\s*:?\\s*E\\d+\\s*/i, \"\");\n  value = value.replace(/\"[^\"]*\"/g, (match) => {\n    const inner = match.replace(/\"/g, \"\");\n    return EPISODE_TITLE_PATTERN.test(inner) ? \"\" : match;\n  });\n  value = value.replace(/Episode\\s*\\d+/gi, \"\");\n  value = value.replace(/\\bE\\d+\\b/gi, \"\");\n  value = value.replace(EPISODE_TIME_PATTERN, \"\");\n  value = value.replace(/\\s+of\\s+\\d+\\s*(m|min|minutes)?/gi, \"\");\n  value = value.replace(/\\s+/g, \" \").trim();\n  return value.length ? value : undefined;\n};\n\nconst extractFromAnchor = (anchor: HTMLAnchorElement, source: string): ActiveTitleCandidate => {\n  const href = anchor.getAttribute(\"href\") || undefined;\n  const netflixTitleId = parseTitleIdFromHref(href);\n  const titleText = normalizeText(anchor.getAttribute(\"aria-label\") || anchor.textContent);\n  return { netflixTitleId, titleText, href, source };\n};\n\nconst extractTitleTextNear = (container: Element): string | undefined => {\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const el = container.querySelector(selector);\n    if (el && isVisible(el)) {\n      const text = normalizeText(el.textContent);\n      if (text) return text;\n    }\n  }\n  return undefined;\n};\n\nexport const getRawTitleText = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  return extractTitleTextNear(container);\n};\n\nconst findPrimaryTitle = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const nodes = Array.from(container.querySelectorAll(selector));\n    for (const node of nodes) {\n      if (!isVisible(node)) continue;\n      const text = normalizeText(node.textContent);\n      if (!text) continue;\n      if (EPISODE_TITLE_PATTERN.test(text) || EPISODE_TIME_PATTERN.test(text)) continue;\n      const normalized = normalizeNetflixTitle(text);\n      if (normalized) return normalized;\n    }\n  }\n  return undefined;\n};\n\nexport const findOverlayAnchor = (container?: Element | null): Element | null => {\n  if (container) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor && isVisible(anchor)) return anchor;\n    for (const selector of TITLE_TEXT_SELECTORS) {\n      const el = container.querySelector(selector);\n      if (el && isVisible(el)) return el;\n    }\n  }\n\n  const pageAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (pageAnchor) return pageAnchor;\n\n  const pageTitle = Array.from(document.querySelectorAll(TITLE_TEXT_SELECTORS.join(\",\"))).find(\n    isVisible\n  );\n  return pageTitle ?? null;\n};\n\nexport const findPreviewElement = (container?: Element | null): Element | null => {\n  if (!container) return null;\n  const candidates: Element[] = [];\n  PREVIEW_SELECTORS.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (isVisible(el)) candidates.push(el);\n    });\n  });\n  if (!candidates.length) return null;\n  return candidates.reduce((best, current) => {\n    const bestRect = best.getBoundingClientRect();\n    const currentRect = current.getBoundingClientRect();\n    const bestArea = bestRect.width * bestRect.height;\n    const currentArea = currentRect.width * currentRect.height;\n    return currentArea > bestArea ? current : best;\n  });\n};\n\nexport const findControlsRow = (root?: Element | null): HTMLElement | null => {\n  if (!root) return null;\n  const candidates: HTMLElement[] = [];\n  CONTROLS_SELECTORS.forEach((selector) => {\n    root.querySelectorAll<HTMLElement>(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      candidates.push(el);\n    });\n  });\n  const unique = Array.from(new Set(candidates));\n  const scored = unique\n    .map((el) => {\n      const buttons = el.querySelectorAll(\"button, [role='button']\").length;\n      const rect = el.getBoundingClientRect();\n      const score = buttons * 10 + rect.width;\n      return { el, score, top: rect.top };\n    })\n    .filter((entry) => entry.score > 0);\n  scored.sort((a, b) => b.score - a.score || b.top - a.top);\n  return scored[0]?.el ?? null;\n};\n\nexport const hasMetadataSection = (root?: Element | null): boolean => {\n  if (!root) return false;\n  const selectors = [...METADATA_SELECTORS, ...GENRE_SELECTORS].join(\",\");\n  const nodes = Array.from(root.querySelectorAll(selectors));\n  return nodes.some((node) => isVisible(node));\n};\n\nexport const findExpandedRoot = (root?: Element | null): HTMLElement | null => {\n  const candidates = findExpandedContainers();\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  for (const candidate of candidates) {\n    const rect = candidate.getBoundingClientRect();\n    if (rect.width > maxWidth || rect.height > maxHeight) continue;\n    const preview = findPreviewElement(candidate);\n    const controls = findControlsRow(candidate);\n    const metadata = hasMetadataSection(candidate);\n    if (preview && controls && metadata) {\n      return candidate as HTMLElement;\n    }\n  }\n  return null;\n};\n\nexport const extractMetadataLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, METADATA_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter(isMetadataCandidate)\n    .filter((value) => !EPISODE_TIME_PATTERN.test(value))\n    .filter((value) => value.length <= 24);\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const extractGenresLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, GENRE_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter((value) => value.length <= 24)\n    .filter((value) => !/episode|min/i.test(value));\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nconst isBannedTitleText = (text: string) => {\n  return (\n    EPISODE_TITLE_PATTERN.test(text) ||\n    EPISODE_TIME_PATTERN.test(text) ||\n    /\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)?\\b/i.test(text) ||\n    /\\b\\d+\\s*(m|min|minutes)\\b/i.test(text)\n  );\n};\n\nconst isInProgressRegion = (el: Element, controlsTop?: number) => {\n  if (el.closest('[role=\"progressbar\"], [data-uia*=\"progress\"], [class*=\"progress\"]')) {\n    return true;\n  }\n  if (controlsTop !== undefined) {\n    const rect = el.getBoundingClientRect();\n    return rect.bottom >= controlsTop - 8;\n  }\n  return false;\n};\n\nexport const extractDisplayTitle = (expandedRoot: HTMLElement): {\n  title: string | null;\n  chosen?: Element;\n  rejectedCount: number;\n} => {\n  const rootRect = expandedRoot.getBoundingClientRect();\n  const controls = findControlsRow(expandedRoot);\n  const controlsTop = controls ? controls.getBoundingClientRect().top : undefined;\n  const candidates = Array.from(expandedRoot.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n  let best: { el: Element; score: number; text: string } | null = null;\n  let rejectedCount = 0;\n  const episodeNodes: Element[] = [];\n\n  candidates.forEach((el) => {\n    if (!isVisible(el)) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isInProgressRegion(el, controlsTop)) {\n      rejectedCount += 1;\n      return;\n    }\n    const text = normalizeText(el.textContent);\n    if (!text || text.length < 2 || text.length > 80) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isBannedTitleText(text)) {\n      episodeNodes.push(el);\n      rejectedCount += 1;\n      return;\n    }\n\n    const rect = el.getBoundingClientRect();\n    const style = window.getComputedStyle(el as HTMLElement);\n    const fontSize = parseFloat(style.fontSize) || 14;\n    const fontWeightRaw = style.fontWeight === \"bold\" ? 700 : Number(style.fontWeight);\n    const fontWeight = Number.isNaN(fontWeightRaw) ? 400 : fontWeightRaw;\n    const dx = rect.left - rootRect.left;\n    const dy = rect.top - rootRect.top;\n    const dist = Math.hypot(dx, dy);\n    const score = fontSize * 10 + fontWeight / 10 + Math.max(0, 300 - dist);\n    if (!best || score > best.score) {\n      best = { el, score, text };\n    }\n  });\n\n  if (best) {\n    const normalized = normalizeNetflixTitle(best.text);\n    return { title: normalized ?? best.text, chosen: best.el, rejectedCount };\n  }\n\n  for (const episodeNode of episodeNodes) {\n    let current: Element | null = episodeNode.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const siblingCandidates = Array.from(\n        current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\"))\n      ).filter((el) => el !== episodeNode);\n      for (const sibling of siblingCandidates) {\n        if (!isVisible(sibling)) continue;\n        if (isInProgressRegion(sibling, controlsTop)) continue;\n        const text = normalizeText(sibling.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: sibling,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  const anchor = expandedRoot.querySelector(\"a[href^='/title/']\");\n  if (anchor) {\n    const heading = anchor.querySelector(TITLE_LIKE_SELECTORS.join(\",\"));\n    const directText = normalizeText(heading?.textContent || anchor.textContent);\n    if (directText && !isBannedTitleText(directText)) {\n      return {\n        title: normalizeNetflixTitle(directText) ?? directText,\n        chosen: heading ?? anchor,\n        rejectedCount\n      };\n    }\n\n    let current: Element | null = anchor.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const nearby = Array.from(current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n      for (const node of nearby) {\n        if (!isVisible(node)) continue;\n        if (isInProgressRegion(node, controlsTop)) continue;\n        const text = normalizeText(node.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: node,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  return { title: null, rejectedCount };\n};\n\nexport const resolveTitleText = (\n  container?: Element | null,\n  fallback?: string\n): string | undefined => {\n  const primary = findPrimaryTitle(container);\n  if (primary) return primary;\n\n  const normalizedFallback = normalizeNetflixTitle(fallback);\n  if (normalizedFallback && !EPISODE_TITLE_PATTERN.test(normalizedFallback)) {\n    return normalizedFallback;\n  }\n\n  if (fallback) return normalizeNetflixTitle(fallback) ?? fallback;\n  return undefined;\n};\n\nexport const findOverlayContainer = (\n  container?: Element | null,\n  preview?: Element | null\n): Element | null => {\n  const candidates = new Set<Element>();\n  const collect = (start?: Element | null) => {\n    let current: Element | null | undefined = start;\n    let depth = 0;\n    while (current && depth < 7) {\n      candidates.add(current);\n      current = current.parentElement;\n      depth += 1;\n    }\n  };\n  collect(container);\n  collect(preview);\n\n  let best: Element | null = null;\n  let bestArea = 0;\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  candidates.forEach((el) => {\n    if (!isVisible(el)) return;\n    const rect = el.getBoundingClientRect();\n    const area = rect.width * rect.height;\n    if (rect.width > maxWidth || rect.height > maxHeight) return;\n    if (area > bestArea && rect.width > 240 && rect.height > 180) {\n      best = el;\n      bestArea = area;\n    }\n  });\n\n  if (best) return best;\n  const isValid = (el?: Element | null) => {\n    if (!el) return false;\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    return rect.width <= maxWidth && rect.height <= maxHeight;\n  };\n  if (isValid(container)) return container ?? null;\n  if (isValid(preview)) return preview ?? null;\n  return null;\n};\n\nconst findBestAnchorIn = (container: Element): HTMLAnchorElement | undefined => {\n  const anchors = Array.from(container.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR));\n  const visible = anchors.filter(isVisible);\n  if (visible.length > 0) return visible[0];\n  return anchors[0];\n};\n\nconst findExpandedContainers = (): Element[] => {\n  const selectors = CONTAINER_SELECTORS.join(\",\");\n  const nodes = Array.from(document.querySelectorAll(selectors));\n  const visible = nodes.filter(isVisible);\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  const filtered = visible.filter((el) => {\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    if (rect.width < 240 || rect.height < 180) return false;\n    if (rect.width > maxWidth || rect.height > maxHeight) return false;\n    return true;\n  });\n  if (filtered.length > 0) {\n    return filtered.sort((a, b) => {\n      const ra = a.getBoundingClientRect();\n      const rb = b.getBoundingClientRect();\n      return rb.width * rb.height - ra.width * ra.height;\n    });\n  }\n  return visible.length > 0 ? visible : nodes;\n};\n\nexport const detectActiveTitleContext = (): {\n  candidate: ActiveTitleCandidate | null;\n  container: Element | null;\n} => {\n  const containers = findExpandedContainers();\n\n  for (const container of containers) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor) {\n      const candidate = extractFromAnchor(anchor, \"container-anchor\");\n      if (candidate.netflixTitleId || candidate.titleText) {\n        const titleText = candidate.titleText ?? extractTitleTextNear(container);\n        const resolvedTitle = resolveTitleText(container, titleText ?? candidate.titleText);\n        return {\n          candidate: {\n            ...candidate,\n            titleText: resolvedTitle,\n            year: parseYearFromText(resolvedTitle ?? titleText)\n          },\n          container\n        };\n      }\n    }\n\n    const titleText = extractTitleTextNear(container);\n    if (titleText) {\n      const resolvedTitle = resolveTitleText(container, titleText);\n      return {\n        candidate: {\n          titleText: resolvedTitle ?? titleText,\n          year: parseYearFromText(resolvedTitle ?? titleText),\n          source: \"container-text\"\n        },\n        container\n      };\n    }\n  }\n\n  const fallbackAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (fallbackAnchor) {\n    const candidate = extractFromAnchor(fallbackAnchor, \"page-anchor\");\n    const resolvedTitle = resolveTitleText(\n      fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement,\n      candidate.titleText\n    );\n    return {\n      candidate: {\n        ...candidate,\n        titleText: resolvedTitle ?? candidate.titleText,\n        year: parseYearFromText(resolvedTitle ?? candidate.titleText)\n      },\n      container: fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement\n    };\n  }\n\n  return { candidate: null, container: null };\n};\n\nexport const detectActiveTitle = (): ActiveTitleCandidate | null => {\n  return detectActiveTitleContext().candidate;\n};\n","export interface OverlayData {\n  titleLine: string;\n  metadataLine?: string;\n  genresLine?: string;\n  communityRating?: number;\n  ratingCount?: number;\n  matchScore?: number;\n  matchExplanation?: string;\n}\n\nconst TOP_SECTION_ID = \"nxlb-top-section\";\n\nconst buildTopSection = (data: OverlayData): HTMLDivElement => {\n  const host = document.createElement(\"div\");\n  host.id = TOP_SECTION_ID;\n  host.style.display = \"block\";\n  host.style.width = \"100%\";\n  host.style.pointerEvents = \"none\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n      pointer-events: none;\n      display: block;\n      width: 100%;\n      box-sizing: border-box;\n    }\n    .nxl-top-section {\n      background: rgba(0, 0, 0, 0.85);\n      color: #f5f5f5;\n      padding: 20px;\n      border-top-left-radius: 12px;\n      border-top-right-radius: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      display: grid;\n      gap: 10px;\n      box-sizing: border-box;\n    }\n    .nxl-header {\n      display: flex;\n      align-items: flex-start;\n      justify-content: space-between;\n      gap: 16px;\n    }\n    .nxl-title {\n      font-size: 30px;\n      font-weight: 700;\n      line-height: 1.1;\n      letter-spacing: 0.01em;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      max-width: 70%;\n    }\n    .nxl-meta {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.75);\n      margin-top: 6px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-genres {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.7);\n      margin-top: 4px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-branding {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.8);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .nxl-dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .nxl-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 999px;\n      display: inline-block;\n    }\n    .nxl-dot.green { background: #00c46a; }\n    .nxl-dot.orange { background: #f2b34c; }\n    .nxl-dot.blue { background: #4aa8ff; }\n    .nxl-body {\n      display: grid;\n      gap: 8px;\n      font-size: 16px;\n      color: rgba(255, 255, 255, 0.9);\n      max-height: 220px;\n      overflow: auto;\n    }\n    .nxl-rating {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .nxl-star {\n      color: #e3b341;\n      font-size: 16px;\n    }\n    .nxl-match {\n      display: flex;\n      align-items: baseline;\n      gap: 8px;\n    }\n    .nxl-match-value {\n      color: #46d369;\n      font-weight: 700;\n      font-size: 20px;\n    }\n    .nxl-because {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 14px;\n    }\n  `;\n\n  const section = document.createElement(\"div\");\n  section.className = \"nxl-top-section\";\n\n  const header = document.createElement(\"div\");\n  header.className = \"nxl-header\";\n\n  const titleBlock = document.createElement(\"div\");\n\n  const title = document.createElement(\"div\");\n  title.className = \"nxl-title\";\n  title.textContent = data.titleLine;\n\n  const meta = document.createElement(\"div\");\n  meta.className = \"nxl-meta\";\n  meta.dataset.field = \"metadata\";\n\n  const genres = document.createElement(\"div\");\n  genres.className = \"nxl-genres\";\n  genres.dataset.field = \"genres\";\n\n  titleBlock.appendChild(title);\n  titleBlock.appendChild(meta);\n  titleBlock.appendChild(genres);\n\n  const branding = document.createElement(\"div\");\n  branding.className = \"nxl-branding\";\n  branding.innerHTML = `\n    Powered by\n    <span class=\"nxl-dots\">\n      <span class=\"nxl-dot green\"></span>\n      <span class=\"nxl-dot orange\"></span>\n      <span class=\"nxl-dot blue\"></span>\n    </span>\n    Letterboxd\n  `;\n\n  header.appendChild(titleBlock);\n  header.appendChild(branding);\n\n  const body = document.createElement(\"div\");\n  body.className = \"nxl-body\";\n\n  const communityRating = document.createElement(\"div\");\n  communityRating.className = \"nxl-rating\";\n  communityRating.dataset.field = \"communityRating\";\n  communityRating.textContent = \"Community rating: —\";\n\n  const match = document.createElement(\"div\");\n  match.className = \"nxl-match\";\n  match.dataset.field = \"match\";\n  match.textContent = \"Your match: —\";\n\n  const because = document.createElement(\"div\");\n  because.className = \"nxl-because\";\n  because.dataset.field = \"because\";\n  because.textContent = \"Because you like —\";\n\n  body.appendChild(communityRating);\n  body.appendChild(match);\n  body.appendChild(because);\n\n  section.appendChild(header);\n  section.appendChild(body);\n\n  shadow.appendChild(style);\n  shadow.appendChild(section);\n\n  return host;\n};\n\nlet currentRoot: HTMLElement | null = null;\nlet currentHost: HTMLDivElement | null = null;\n\nconst formatRatingCount = (value?: number) => {\n  if (value === undefined) return \"\";\n  if (value >= 1_000_000) return `${(value / 1_000_000).toFixed(1)}M`;\n  if (value >= 1_000) return `${(value / 1_000).toFixed(1)}K`;\n  return `${value}`;\n};\n\nconst applyTopSectionData = (data: OverlayData) => {\n  const titleEl = currentHost?.shadowRoot?.querySelector(\".nxl-title\");\n  if (titleEl) titleEl.textContent = data.titleLine;\n\n  const communityEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='communityRating']\"\n  ) as HTMLDivElement | null;\n  if (communityEl) {\n    if (data.communityRating !== undefined) {\n      const count = formatRatingCount(data.ratingCount);\n      communityEl.innerHTML = `\n        Community rating:\n        <span class=\"nxl-star\">★</span>\n        ${data.communityRating.toFixed(1)}${count ? ` <span class=\"nxl-meta\">${count} ratings</span>` : \"\"}\n      `;\n    } else {\n      communityEl.textContent = \"Community rating: —\";\n    }\n  }\n\n  const matchEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='match']\"\n  ) as HTMLDivElement | null;\n  if (matchEl) {\n    if (data.matchScore !== undefined) {\n      matchEl.innerHTML = `Your match: <span class=\"nxl-match-value\">${data.matchScore}%</span>`;\n    } else {\n      matchEl.textContent = \"Your match: —\";\n    }\n  }\n\n  const becauseEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='because']\"\n  ) as HTMLDivElement | null;\n  if (becauseEl) {\n    becauseEl.textContent = data.matchExplanation ?? \"Because you like —\";\n  }\n\n  const metaEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='metadata']\"\n  ) as HTMLDivElement | null;\n  if (metaEl) {\n    if (data.metadataLine) {\n      metaEl.style.display = \"block\";\n      metaEl.textContent = data.metadataLine;\n    } else {\n      metaEl.style.display = \"none\";\n      metaEl.textContent = \"\";\n    }\n  }\n\n  const genresEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='genres']\"\n  ) as HTMLDivElement | null;\n  if (genresEl) {\n    if (data.genresLine) {\n      genresEl.style.display = \"block\";\n      genresEl.textContent = data.genresLine;\n    } else {\n      genresEl.style.display = \"none\";\n      genresEl.textContent = \"\";\n    }\n  }\n};\n\nexport const injectTopSection = (expandedRoot: HTMLElement, data: OverlayData): boolean => {\n  const isNewRoot = currentRoot !== expandedRoot;\n  if (isNewRoot) {\n    if (currentHost) currentHost.remove();\n    currentRoot = expandedRoot;\n    currentHost = buildTopSection(data);\n    expandedRoot.insertBefore(currentHost, expandedRoot.firstChild);\n  }\n\n  applyTopSectionData(data);\n  return isNewRoot;\n};\n\nexport const removeTopSection = () => {\n  if (currentHost) currentHost.remove();\n  currentRoot = null;\n  currentHost = null;\n};\n","import { log } from \"../shared/log\";\nimport { getStorage, setStorage } from \"../shared/storage\";\nimport {\n  detectActiveTitleContext,\n  extractDisplayTitle,\n  extractGenresLine,\n  extractMetadataLine,\n  findExpandedRoot,\n  findOverlayAnchor,\n  findPreviewElement,\n  getRawTitleText,\n  normalizeNetflixTitle\n} from \"./netflixSelectors\";\nimport { injectTopSection, removeTopSection } from \"./overlay\";\nimport type { ResolveTitleMessage, TitleResolvedMessage } from \"../shared/types\";\nimport { DEBUG } from \"../shared/log\";\n\nconst BADGE_ID = \"nxlb-debug-badge\";\nconst TOGGLE_COMBO = {\n  ctrlKey: true,\n  shiftKey: true,\n  key: \"l\"\n};\nconst OBSERVER_DEBOUNCE_MS = 250;\nconst HERO_WIDTH_THRESHOLD = 0.85;\nconst HERO_HEIGHT_THRESHOLD = 0.6;\n\nconst ensureBadge = (enabled: boolean) => {\n  const existing = document.getElementById(BADGE_ID);\n  if (!enabled) {\n    existing?.remove();\n    return;\n  }\n\n  if (existing) return;\n\n  const host = document.createElement(\"div\");\n  host.id = BADGE_ID;\n  host.style.position = \"fixed\";\n  host.style.bottom = \"16px\";\n  host.style.right = \"16px\";\n  host.style.zIndex = \"2147483647\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Space Grotesk\", sans-serif;\n    }\n    .badge {\n      background: #111;\n      color: #f5f5f5;\n      border-radius: 999px;\n      padding: 6px 10px;\n      font-size: 11px;\n      letter-spacing: 0.08em;\n      text-transform: uppercase;\n      border: 1px solid rgba(255, 255, 255, 0.14);\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);\n    }\n  `;\n\n  const badge = document.createElement(\"div\");\n  badge.className = \"badge\";\n  badge.textContent = \"N×L active\";\n\n  shadow.appendChild(style);\n  shadow.appendChild(badge);\n  document.documentElement.appendChild(host);\n};\n\nlet overlayEnabled = true;\n\nconst applyOverlayState = async (enabled: boolean) => {\n  overlayEnabled = enabled;\n  if (!enabled) {\n    updateOverlay(null, null);\n  }\n  ensureBadge(enabled);\n};\n\nlet lastActiveKey = \"\";\nlet lastContainer: Element | null = null;\nlet debounceTimer: number | undefined;\nlet lastRequestId = \"\";\nlet lastOutlined: HTMLElement | null = null;\n\nconst describeElement = (el: Element | null) => {\n  if (!el) return \"none\";\n  const parts = [el.tagName.toLowerCase()];\n  const className = (el as HTMLElement).className;\n  if (className) {\n    parts.push(\n      \".\" +\n        className\n          .toString()\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 3)\n          .join(\".\")\n    );\n  }\n  const dataUia = (el as HTMLElement).getAttribute?.(\"data-uia\");\n  if (dataUia) parts.push(`[data-uia=\\\"${dataUia}\\\"]`);\n  return parts.join(\"\");\n};\n\nconst isWatchPage = () => window.location.pathname.startsWith(\"/watch\");\n\nconst hasMainPlayerVideo = () => {\n  const videos = Array.from(document.querySelectorAll(\"video\"));\n  return videos.some((video) => {\n    const rect = video.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    const widthRatio = rect.width / window.innerWidth;\n    const heightRatio = rect.height / window.innerHeight;\n    return widthRatio > 0.85 || heightRatio > 0.6;\n  });\n};\n\nconst hasEpisodeHeaderVisible = () => {\n  const candidates = Array.from(\n    document.querySelectorAll(\"h1, h2, h3, [data-uia*='episode'], [class*='episode']\")\n  );\n  return candidates.some((el) => {\n    if (el instanceof HTMLElement) {\n      const rect = el.getBoundingClientRect();\n      if (rect.width === 0 || rect.height === 0) return false;\n      const text = el.textContent ?? \"\";\n      return /episode/i.test(text);\n    }\n    return false;\n  });\n};\n\nconst isHeroSized = (el: Element | null) => {\n  if (!el) return false;\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  return (\n    rect.width > window.innerWidth * HERO_WIDTH_THRESHOLD ||\n    rect.height > window.innerHeight * HERO_HEIGHT_THRESHOLD\n  );\n};\n\nconst updateDebugOutline = (container: HTMLElement | null) => {\n  if (lastOutlined && lastOutlined !== container) {\n    lastOutlined.style.outline = \"\";\n    lastOutlined.style.outlineOffset = \"\";\n    lastOutlined = null;\n  }\n  if (container && DEBUG) {\n    container.style.outline = \"1px solid rgba(255, 80, 80, 0.85)\";\n    container.style.outlineOffset = \"-1px\";\n    lastOutlined = container;\n  }\n};\n\nconst serializeCandidate = (\n  candidate: ReturnType<typeof detectActiveTitleContext>[\"candidate\"]\n): string => {\n  if (!candidate) return \"\";\n  return [\n    candidate.netflixTitleId ?? \"\",\n    candidate.titleText ?? \"\",\n    candidate.year ?? \"\",\n    candidate.href ?? \"\"\n  ].join(\"|\");\n};\n\nconst emitActiveTitleChange = () => {\n  if (!overlayEnabled) return;\n\n  if (isWatchPage()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"watch-page\" });\n    removeTopSection();\n    return;\n  }\n\n  if (hasMainPlayerVideo()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"main-player-video\" });\n    removeTopSection();\n    return;\n  }\n\n  if (hasEpisodeHeaderVisible()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"episode-header-visible\" });\n    removeTopSection();\n    return;\n  }\n\n  const { candidate, container } = detectActiveTitleContext();\n  const previewEl = findPreviewElement(container);\n  const expandedRoot = findExpandedRoot(container) ?? (container as HTMLElement | null);\n  const anchor = findOverlayAnchor(expandedRoot ?? container);\n  const anchorInRoot = expandedRoot?.querySelector(\"a[href^='/title/']\") as\n    | HTMLAnchorElement\n    | null;\n  if (anchorInRoot) {\n    const href = anchorInRoot.getAttribute(\"href\") ?? undefined;\n    const match = href?.match(/\\/title\\/(\\d+)/);\n    if (match) candidate && (candidate.netflixTitleId = match[1]);\n    if (href) candidate && (candidate.href = href);\n  }\n  const metadataLine = extractMetadataLine(expandedRoot ?? container);\n  const genresLine = extractGenresLine(expandedRoot ?? container);\n  if (!expandedRoot || !previewEl) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"no-overlay-container\",\n        anchor: describeElement(anchor),\n        container: describeElement(expandedRoot)\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    return;\n  }\n  if (isHeroSized(anchor) || isHeroSized(expandedRoot)) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"hero-sized-anchor\",\n        anchor: describeElement(anchor),\n        container: describeElement(expandedRoot)\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    return;\n  }\n  updateDebugOutline(expandedRoot);\n  if (!candidate) {\n    try {\n      removeTopSection();\n    } catch (error) {\n      log(\"Overlay cleanup failed\", { error });\n    }\n    updateDebugOutline(null);\n    lastActiveKey = \"\";\n    lastContainer = null;\n    return;\n  }\n\n  const displayTitle = extractDisplayTitle(expandedRoot);\n  if (!displayTitle.title) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"no-display-title\",\n        rejectedTitleCandidates: displayTitle.rejectedCount\n      });\n    }\n    removeTopSection();\n    updateDebugOutline(null);\n    return;\n  }\n  const resolvedTitle = displayTitle.title;\n  const key = serializeCandidate({ ...candidate, titleText: resolvedTitle });\n  if (key === lastActiveKey && expandedRoot === lastContainer) return;\n  lastActiveKey = key;\n  lastContainer = expandedRoot;\n  if (DEBUG) {\n    const rawTitle = getRawTitleText(expandedRoot ?? container);\n    const normalizedTitle = normalizeNetflixTitle(rawTitle ?? candidate.titleText);\n    log(\"Active title changed\", {\n      ...candidate,\n      anchor: describeElement(anchor),\n      container: describeElement(expandedRoot),\n      rawTitle,\n      normalizedTitle,\n      chosenTitle: displayTitle.title,\n      rejectedTitleCandidates: displayTitle.rejectedCount,\n      chosenTitleElement: displayTitle.chosen\n        ? displayTitle.chosen.outerHTML.slice(0, 200)\n        : undefined,\n      at: new Date().toISOString()\n    });\n  }\n\n  const requestId = `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n  lastRequestId = requestId;\n  const message: ResolveTitleMessage = {\n    type: \"RESOLVE_TITLE\",\n    requestId,\n    payload: {\n      netflixTitleId: candidate.netflixTitleId,\n      titleText: resolvedTitle,\n      year: candidate.year,\n      href: candidate.href\n    }\n  };\n\n  chrome.runtime\n    .sendMessage(message)\n    .then((response: TitleResolvedMessage) => {\n      if (response?.type !== \"TITLE_RESOLVED\") return;\n      if (response.requestId !== lastRequestId) return;\n      log(\"Title resolved\", { requestId, response });\n\n      try {\n        const didInject = injectTopSection(expandedRoot, {\n          titleLine: resolvedTitle,\n          metadataLine,\n          genresLine,\n          communityRating: response.payload.tmdbVoteAverage,\n          ratingCount: response.payload.tmdbVoteCount,\n          matchScore: response.payload.matchScore,\n          matchExplanation: response.payload.matchExplanation\n        });\n        if (DEBUG && didInject) {\n          log(\"Injected top section\", { container: describeElement(expandedRoot) });\n        }\n      } catch (error) {\n        log(\"Overlay update failed\", { error });\n      }\n    })\n    .catch((err) => {\n      log(\"Title resolve failed\", { requestId, err });\n    });\n\n  const titleLine = resolvedTitle;\n\n  try {\n    const didInject = injectTopSection(expandedRoot, {\n      titleLine,\n      metadataLine,\n      genresLine\n    });\n    if (DEBUG && didInject) {\n      log(\"Injected top section\", { container: describeElement(expandedRoot) });\n    }\n  } catch (error) {\n    log(\"Overlay update failed\", { error });\n  }\n};\n\nconst scheduleActiveTitleCheck = () => {\n  if (debounceTimer) window.clearTimeout(debounceTimer);\n  debounceTimer = window.setTimeout(() => {\n    emitActiveTitleChange();\n  }, OBSERVER_DEBOUNCE_MS);\n};\n\nconst observeTitleChanges = () => {\n  const observer = new MutationObserver(() => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Mutation observer failed\", { error });\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter: [\"class\", \"style\", \"aria-expanded\", \"aria-hidden\"]\n  });\n\n  document.addEventListener(\"pointerover\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Pointer observer failed\", { error });\n    }\n  }, true);\n  document.addEventListener(\"focusin\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Focus observer failed\", { error });\n    }\n  }, true);\n  scheduleActiveTitleCheck();\n};\n\nconst toggleOverlay = async () => {\n  const state = await getStorage();\n  const next = !(state.overlayEnabled ?? true);\n  await setStorage({ overlayEnabled: next });\n  await applyOverlayState(next);\n  if (next) scheduleActiveTitleCheck();\n  log(\"Overlay toggled\", { enabled: next });\n};\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  if (\n    event.ctrlKey === TOGGLE_COMBO.ctrlKey &&\n    event.shiftKey === TOGGLE_COMBO.shiftKey &&\n    event.key.toLowerCase() === TOGGLE_COMBO.key\n  ) {\n    event.preventDefault();\n    toggleOverlay().catch((err) => log(\"Toggle failed\", err));\n  }\n};\n\nconst init = async () => {\n  const state = await getStorage();\n  const enabled = state.overlayEnabled ?? true;\n  await applyOverlayState(enabled);\n  observeTitleChanges();\n  window.addEventListener(\"keydown\", handleKeydown);\n};\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    init().catch((err) => log(\"Init failed\", err));\n  }, { once: true });\n} else {\n  init().catch((err) => log(\"Init failed\", err));\n}\n"],"names":["log","args","getStorage","setStorage","state","TITLE_ANCHOR_SELECTOR","CONTAINER_SELECTORS","TITLE_TEXT_SELECTORS","PREVIEW_SELECTORS","CONTROLS_SELECTORS","EPISODE_TITLE_PATTERN","EPISODE_TIME_PATTERN","METADATA_SELECTORS","GENRE_SELECTORS","TITLE_LIKE_SELECTORS","isVisible","el","rect","style","normalizeText","value","text","collectVisibleText","container","selectors","values","selector","isMetadataCandidate","lower","parseTitleIdFromHref","href","match","parseYearFromText","year","normalizeNetflixTitle","raw","inner","extractFromAnchor","anchor","source","netflixTitleId","titleText","extractTitleTextNear","findPrimaryTitle","nodes","node","normalized","findOverlayAnchor","findBestAnchorIn","pageAnchor","findPreviewElement","candidates","best","current","bestRect","currentRect","bestArea","findControlsRow","root","scored","buttons","score","entry","a","b","_a","hasMetadataSection","findExpandedRoot","findExpandedContainers","maxWidth","maxHeight","candidate","preview","controls","metadata","extractMetadataLine","unique","extractGenresLine","isBannedTitleText","isInProgressRegion","controlsTop","extractDisplayTitle","expandedRoot","rootRect","rejectedCount","episodeNodes","fontSize","fontWeightRaw","fontWeight","dx","dy","dist","episodeNode","depth","siblingCandidates","sibling","heading","directText","nearby","resolveTitleText","fallback","primary","normalizedFallback","anchors","visible","filtered","ra","rb","detectActiveTitleContext","containers","resolvedTitle","fallbackAnchor","TOP_SECTION_ID","buildTopSection","data","host","shadow","section","header","titleBlock","title","meta","genres","branding","body","communityRating","because","currentRoot","currentHost","formatRatingCount","applyTopSectionData","titleEl","communityEl","_b","count","matchEl","_c","becauseEl","_d","metaEl","_e","genresEl","_f","injectTopSection","isNewRoot","removeTopSection","BADGE_ID","TOGGLE_COMBO","OBSERVER_DEBOUNCE_MS","HERO_WIDTH_THRESHOLD","HERO_HEIGHT_THRESHOLD","ensureBadge","enabled","existing","badge","overlayEnabled","applyOverlayState","lastActiveKey","lastContainer","debounceTimer","lastRequestId","lastOutlined","describeElement","parts","className","dataUia","isWatchPage","hasMainPlayerVideo","video","widthRatio","heightRatio","hasEpisodeHeaderVisible","isHeroSized","updateDebugOutline","serializeCandidate","emitActiveTitleChange","previewEl","anchorInRoot","metadataLine","genresLine","displayTitle","key","requestId","message","response","didInject","err","titleLine","scheduleActiveTitleCheck","observeTitleChanges","toggleOverlay","next","handleKeydown","event","init"],"mappings":"yBAEO,MAAMA,EAAM,IAAIC,IAAoB,CAG3C,ECQaC,EAAa,SAEjB,OAAO,QAAQ,MAAM,IAAI,CAC9B,mBACA,eACA,iBACA,aACA,YACA,kBACA,iBAAA,CACD,EAGUC,GAAa,MAAOC,GAAuC,CAEtE,MAAM,OAAO,QAAQ,MAAM,IAAIA,CAAK,CACtC,ECrBMC,EAAwB,qBAExBC,EAAsB,CAC1B,kBACA,sBACA,yBACA,wBACA,qBACA,wBACA,0BACA,qBACA,uBACF,EAEMC,EAAuB,CAC3B,KACA,KACA,KACA,sBACA,mBACA,sBACA,sCACF,EAEMC,GAAoB,CACxB,QACA,MACA,8BACA,4BACA,2BACA,yBACA,6BACA,wBACF,EAEMC,GAAqB,CACzB,yBACA,sBACA,qBACA,kBACF,EAEMC,EACJ,0EACIC,EAAuB,oEAEvBC,EAAqB,CACzB,gCACA,uBACA,2BACA,mBACA,sBACA,oBACA,oBACF,EAEMC,EAAkB,CACtB,sBACA,qBACA,kBACF,EAEMC,EAAuB,CAC3B,KACA,KACA,KACA,KACA,sBACA,mBACA,sBACA,oBACA,iBACF,EAEMC,EAAaC,GAAyB,CAC1C,MAAMC,EAAOD,EAAG,sBAAA,EAChB,GAAIC,EAAK,QAAU,GAAKA,EAAK,SAAW,EAAG,MAAO,GAClD,MAAMC,EAAQ,OAAO,iBAAiBF,CAAiB,EACvD,OAAIE,EAAM,aAAe,UAAYA,EAAM,UAAY,QAAUA,EAAM,UAAY,IAC1E,GAGPD,EAAK,QAAU,GACfA,EAAK,OAAS,GACdA,EAAK,KAAO,OAAO,aACnBA,EAAK,MAAQ,OAAO,UAExB,EAEME,EAAiBC,GAA8C,CACnE,GAAI,CAACA,EAAO,OACZ,MAAMC,EAAOD,EAAM,QAAQ,OAAQ,GAAG,EAAE,KAAA,EACxC,OAAOC,EAAK,OAASA,EAAO,MAC9B,EAEMC,EAAqB,CAACC,EAAoBC,IAAkC,CAChF,MAAMC,EAAmB,CAAA,EACzB,OAAAD,EAAU,QAASE,GAAa,CAC9BH,EAAU,iBAAiBG,CAAQ,EAAE,QAASV,GAAO,CACnD,GAAI,CAACD,EAAUC,CAAE,EAAG,OACpB,MAAMK,EAAOF,EAAcH,EAAG,WAAW,EACpCK,GACLI,EAAO,KAAKJ,CAAI,CAClB,CAAC,CACH,CAAC,EACMI,CACT,EAEME,GAAuBP,GAAkB,CAC7C,MAAMQ,EAAQR,EAAM,YAAA,EAGpB,OAFIQ,EAAM,SAAS,SAAS,GACxBA,EAAM,SAAS,KAAK,GACpBA,EAAM,SAAS,KAAK,EAAU,IAC9BA,EAAM,SAAS,QAAQ,GAAKA,EAAM,SAAS,IAAI,GAAKA,EAAM,SAAS,KAAK,EAAU,GAExF,EAEMC,GAAwBC,GAA6C,CACzE,GAAI,CAACA,EAAM,OACX,MAAMC,EAAQD,EAAK,MAAM,gBAAgB,EACzC,OAAOC,GAAA,YAAAA,EAAQ,EACjB,EAEMC,EAAqBX,GAAsC,CAC/D,GAAI,CAACA,EAAM,OACX,MAAMU,EAAQV,EAAK,MAAM,mBAAmB,EAC5C,GAAI,CAACU,EAAO,OACZ,MAAME,EAAO,OAAOF,EAAM,CAAC,CAAC,EAC5B,GAAI,QAAO,MAAME,CAAI,EACrB,OAAOA,CACT,EAEaC,EAAyBC,GAAqC,CACzE,GAAI,CAACA,EAAK,OACV,IAAIf,EAAQe,EACZ,OAAAf,EAAQA,EAAM,QAAQ,2BAA4B,EAAE,EACpDA,EAAQA,EAAM,QAAQ,WAAaW,GAAU,CAC3C,MAAMK,EAAQL,EAAM,QAAQ,KAAM,EAAE,EACpC,OAAOrB,EAAsB,KAAK0B,CAAK,EAAI,GAAKL,CAClD,CAAC,EACDX,EAAQA,EAAM,QAAQ,kBAAmB,EAAE,EAC3CA,EAAQA,EAAM,QAAQ,aAAc,EAAE,EACtCA,EAAQA,EAAM,QAAQT,EAAsB,EAAE,EAC9CS,EAAQA,EAAM,QAAQ,mCAAoC,EAAE,EAC5DA,EAAQA,EAAM,QAAQ,OAAQ,GAAG,EAAE,KAAA,EAC5BA,EAAM,OAASA,EAAQ,MAChC,EAEMiB,EAAoB,CAACC,EAA2BC,IAAyC,CAC7F,MAAMT,EAAOQ,EAAO,aAAa,MAAM,GAAK,OACtCE,EAAiBX,GAAqBC,CAAI,EAC1CW,EAAYtB,EAAcmB,EAAO,aAAa,YAAY,GAAKA,EAAO,WAAW,EACvF,MAAO,CAAE,eAAAE,EAAgB,UAAAC,EAAW,KAAAX,EAAM,OAAAS,CAAA,CAC5C,EAEMG,EAAwBnB,GAA2C,CACvE,UAAWG,KAAYnB,EAAsB,CAC3C,MAAMS,EAAKO,EAAU,cAAcG,CAAQ,EAC3C,GAAIV,GAAMD,EAAUC,CAAE,EAAG,CACvB,MAAMK,EAAOF,EAAcH,EAAG,WAAW,EACzC,GAAIK,EAAM,OAAOA,CACnB,CACF,CAEF,EAOMsB,GAAoBpB,GAAmD,CAC3E,GAAKA,EACL,UAAWG,KAAYnB,EAAsB,CAC3C,MAAMqC,EAAQ,MAAM,KAAKrB,EAAU,iBAAiBG,CAAQ,CAAC,EAC7D,UAAWmB,KAAQD,EAAO,CACxB,GAAI,CAAC7B,EAAU8B,CAAI,EAAG,SACtB,MAAMxB,EAAOF,EAAc0B,EAAK,WAAW,EAE3C,GADI,CAACxB,GACDX,EAAsB,KAAKW,CAAI,GAAKV,EAAqB,KAAKU,CAAI,EAAG,SACzE,MAAMyB,EAAaZ,EAAsBb,CAAI,EAC7C,GAAIyB,EAAY,OAAOA,CACzB,CACF,CAEF,EAEaC,GAAqBxB,GAA+C,CAC/E,GAAIA,EAAW,CACb,MAAMe,EAASU,EAAiBzB,CAAS,EACzC,GAAIe,GAAUvB,EAAUuB,CAAM,EAAG,OAAOA,EACxC,UAAWZ,KAAYnB,EAAsB,CAC3C,MAAMS,EAAKO,EAAU,cAAcG,CAAQ,EAC3C,GAAIV,GAAMD,EAAUC,CAAE,EAAG,OAAOA,CAClC,CACF,CAEA,MAAMiC,EAAa,MAAM,KACvB,SAAS,iBAAoC5C,CAAqB,CAAA,EAClE,KAAKU,CAAS,EAChB,OAAIkC,IAEc,MAAM,KAAK,SAAS,iBAAiB1C,EAAqB,KAAK,GAAG,CAAC,CAAC,EAAE,KACtFQ,CAAA,GAEkB,KACtB,EAEamC,EAAsB3B,GAA+C,CAChF,GAAI,CAACA,EAAW,OAAO,KACvB,MAAM4B,EAAwB,CAAA,EAM9B,OALA3C,GAAkB,QAASkB,GAAa,CACtCH,EAAU,iBAAiBG,CAAQ,EAAE,QAASV,GAAO,CAC/CD,EAAUC,CAAE,GAAGmC,EAAW,KAAKnC,CAAE,CACvC,CAAC,CACH,CAAC,EACImC,EAAW,OACTA,EAAW,OAAO,CAACC,EAAMC,IAAY,CAC1C,MAAMC,EAAWF,EAAK,sBAAA,EAChBG,EAAcF,EAAQ,sBAAA,EACtBG,EAAWF,EAAS,MAAQA,EAAS,OAE3C,OADoBC,EAAY,MAAQA,EAAY,OAC/BC,EAAWH,EAAUD,CAC5C,CAAC,EAP8B,IAQjC,EAEaK,EAAmBC,GAA8C,OAC5E,GAAI,CAACA,EAAM,OAAO,KAClB,MAAMP,EAA4B,CAAA,EAClC1C,GAAmB,QAASiB,GAAa,CACvCgC,EAAK,iBAA8BhC,CAAQ,EAAE,QAASV,GAAO,CACtDD,EAAUC,CAAE,GACjBmC,EAAW,KAAKnC,CAAE,CACpB,CAAC,CACH,CAAC,EAED,MAAM2C,EADS,MAAM,KAAK,IAAI,IAAIR,CAAU,CAAC,EAE1C,IAAKnC,GAAO,CACX,MAAM4C,EAAU5C,EAAG,iBAAiB,yBAAyB,EAAE,OACzDC,EAAOD,EAAG,sBAAA,EACV6C,EAAQD,EAAU,GAAK3C,EAAK,MAClC,MAAO,CAAE,GAAAD,EAAI,MAAA6C,EAAO,IAAK5C,EAAK,GAAA,CAChC,CAAC,EACA,OAAQ6C,GAAUA,EAAM,MAAQ,CAAC,EACpC,OAAAH,EAAO,KAAK,CAACI,EAAGC,IAAMA,EAAE,MAAQD,EAAE,OAASC,EAAE,IAAMD,EAAE,GAAG,IACjDE,EAAAN,EAAO,CAAC,IAAR,YAAAM,EAAW,KAAM,IAC1B,EAEaC,GAAsBR,GAAmC,CACpE,GAAI,CAACA,EAAM,MAAO,GAClB,MAAMlC,EAAY,CAAC,GAAGZ,EAAoB,GAAGC,CAAe,EAAE,KAAK,GAAG,EAEtE,OADc,MAAM,KAAK6C,EAAK,iBAAiBlC,CAAS,CAAC,EAC5C,KAAMqB,GAAS9B,EAAU8B,CAAI,CAAC,CAC7C,EAEasB,GAAoBT,GAA8C,CAC7E,MAAMP,EAAaiB,EAAA,EACbC,EAAW,OAAO,WAAa,IAC/BC,EAAY,OAAO,YAAc,GACvC,UAAWC,KAAapB,EAAY,CAClC,MAAMlC,EAAOsD,EAAU,sBAAA,EACvB,GAAItD,EAAK,MAAQoD,GAAYpD,EAAK,OAASqD,EAAW,SACtD,MAAME,EAAUtB,EAAmBqB,CAAS,EACtCE,EAAWhB,EAAgBc,CAAS,EACpCG,EAAWR,GAAmBK,CAAS,EAC7C,GAAIC,GAAWC,GAAYC,EACzB,OAAOH,CAEX,CACA,OAAO,IACT,EAEaI,GAAuBpD,GAAmD,CACrF,GAAI,CAACA,EAAW,OAChB,MAAME,EAASH,EAAmBC,EAAWX,CAAkB,EAC5D,IAAKQ,GAAUA,EAAM,QAAQ,OAAQ,GAAG,EAAE,KAAA,CAAM,EAChD,OAAQA,GAAUA,EAAM,OAAS,CAAC,EAClC,OAAOO,EAAmB,EAC1B,OAAQP,GAAU,CAACT,EAAqB,KAAKS,CAAK,CAAC,EACnD,OAAQA,GAAUA,EAAM,QAAU,EAAE,EACjCwD,EAAS,MAAM,KAAK,IAAI,IAAInD,CAAM,CAAC,EACzC,GAAKmD,EAAO,OACZ,OAAOA,EAAO,MAAM,EAAG,CAAC,EAAE,KAAK,KAAK,CACtC,EAEaC,GAAqBtD,GAAmD,CACnF,GAAI,CAACA,EAAW,OAChB,MAAME,EAASH,EAAmBC,EAAWV,CAAe,EACzD,IAAKO,GAAUA,EAAM,QAAQ,OAAQ,GAAG,EAAE,KAAA,CAAM,EAChD,OAAQA,GAAUA,EAAM,OAAS,CAAC,EAClC,OAAQA,GAAUA,EAAM,QAAU,EAAE,EACpC,OAAQA,GAAU,CAAC,eAAe,KAAKA,CAAK,CAAC,EAC1CwD,EAAS,MAAM,KAAK,IAAI,IAAInD,CAAM,CAAC,EACzC,GAAKmD,EAAO,OACZ,OAAOA,EAAO,MAAM,EAAG,CAAC,EAAE,KAAK,KAAK,CACtC,EAEME,EAAqBzD,GAEvBX,EAAsB,KAAKW,CAAI,GAC/BV,EAAqB,KAAKU,CAAI,GAC9B,yCAAyC,KAAKA,CAAI,GAClD,6BAA6B,KAAKA,CAAI,EAIpC0D,EAAqB,CAAC/D,EAAagE,IACnChE,EAAG,QAAQ,mEAAmE,EACzE,GAELgE,IAAgB,OACLhE,EAAG,sBAAA,EACJ,QAAUgE,EAAc,EAE/B,GAGIC,GAAuBC,GAI/B,CACH,MAAMC,EAAWD,EAAa,sBAAA,EACxBT,EAAWhB,EAAgByB,CAAY,EACvCF,EAAcP,EAAWA,EAAS,sBAAA,EAAwB,IAAM,OAChEtB,EAAa,MAAM,KAAK+B,EAAa,iBAAiBpE,EAAqB,KAAK,GAAG,CAAC,CAAC,EAC3F,IAAIsC,EAA4D,KAC5DgC,EAAgB,EACpB,MAAMC,EAA0B,CAAA,EAoChC,GAlCAlC,EAAW,QAASnC,GAAO,CACzB,GAAI,CAACD,EAAUC,CAAE,EAAG,CAClBoE,GAAiB,EACjB,MACF,CACA,GAAIL,EAAmB/D,EAAIgE,CAAW,EAAG,CACvCI,GAAiB,EACjB,MACF,CACA,MAAM/D,EAAOF,EAAcH,EAAG,WAAW,EACzC,GAAI,CAACK,GAAQA,EAAK,OAAS,GAAKA,EAAK,OAAS,GAAI,CAChD+D,GAAiB,EACjB,MACF,CACA,GAAIN,EAAkBzD,CAAI,EAAG,CAC3BgE,EAAa,KAAKrE,CAAE,EACpBoE,GAAiB,EACjB,MACF,CAEA,MAAMnE,EAAOD,EAAG,sBAAA,EACVE,EAAQ,OAAO,iBAAiBF,CAAiB,EACjDsE,EAAW,WAAWpE,EAAM,QAAQ,GAAK,GACzCqE,EAAgBrE,EAAM,aAAe,OAAS,IAAM,OAAOA,EAAM,UAAU,EAC3EsE,EAAa,OAAO,MAAMD,CAAa,EAAI,IAAMA,EACjDE,GAAKxE,EAAK,KAAOkE,EAAS,KAC1BO,GAAKzE,EAAK,IAAMkE,EAAS,IACzBQ,GAAO,KAAK,MAAMF,GAAIC,EAAE,EACxB7B,GAAQyB,EAAW,GAAKE,EAAa,GAAK,KAAK,IAAI,EAAG,IAAMG,EAAI,GAClE,CAACvC,GAAQS,GAAQT,EAAK,SACxBA,EAAO,CAAE,GAAApC,EAAI,MAAA6C,GAAO,KAAAxC,CAAA,EAExB,CAAC,EAEG+B,EAEF,MAAO,CAAE,MADUlB,EAAsBkB,EAAK,IAAI,GACpBA,EAAK,KAAM,OAAQA,EAAK,GAAI,cAAAgC,CAAA,EAG5D,UAAWQ,KAAeP,EAAc,CACtC,IAAIhC,EAA0BuC,EAAY,cACtCC,EAAQ,EACZ,KAAOxC,GAAWwC,EAAQ,GAAG,CAC3B,MAAMC,EAAoB,MAAM,KAC9BzC,EAAQ,iBAAiBvC,EAAqB,KAAK,GAAG,CAAC,CAAA,EACvD,OAAQE,GAAOA,IAAO4E,CAAW,EACnC,UAAWG,KAAWD,EAAmB,CAEvC,GADI,CAAC/E,EAAUgF,CAAO,GAClBhB,EAAmBgB,EAASf,CAAW,EAAG,SAC9C,MAAM3D,EAAOF,EAAc4E,EAAQ,WAAW,EAC9C,GAAI,GAAC1E,GAAQA,EAAK,OAAS,GAAKA,EAAK,OAAS,KAC1C,CAAAyD,EAAkBzD,CAAI,EAC1B,MAAO,CACL,MAAOa,EAAsBb,CAAI,GAAKA,EACtC,OAAQ0E,EACR,cAAAX,CAAA,CAEJ,CACA/B,EAAUA,EAAQ,cAClBwC,GAAS,CACX,CACF,CAEA,MAAMvD,EAAS4C,EAAa,cAAc,oBAAoB,EAC9D,GAAI5C,EAAQ,CACV,MAAM0D,EAAU1D,EAAO,cAAcxB,EAAqB,KAAK,GAAG,CAAC,EAC7DmF,EAAa9E,GAAc6E,GAAA,YAAAA,EAAS,cAAe1D,EAAO,WAAW,EAC3E,GAAI2D,GAAc,CAACnB,EAAkBmB,CAAU,EAC7C,MAAO,CACL,MAAO/D,EAAsB+D,CAAU,GAAKA,EAC5C,OAAQD,GAAW1D,EACnB,cAAA8C,CAAA,EAIJ,IAAI/B,EAA0Bf,EAAO,cACjCuD,EAAQ,EACZ,KAAOxC,GAAWwC,EAAQ,GAAG,CAC3B,MAAMK,EAAS,MAAM,KAAK7C,EAAQ,iBAAiBvC,EAAqB,KAAK,GAAG,CAAC,CAAC,EAClF,UAAW+B,KAAQqD,EAAQ,CAEzB,GADI,CAACnF,EAAU8B,CAAI,GACfkC,EAAmBlC,EAAMmC,CAAW,EAAG,SAC3C,MAAM3D,EAAOF,EAAc0B,EAAK,WAAW,EAC3C,GAAI,GAACxB,GAAQA,EAAK,OAAS,GAAKA,EAAK,OAAS,KAC1C,CAAAyD,EAAkBzD,CAAI,EAC1B,MAAO,CACL,MAAOa,EAAsBb,CAAI,GAAKA,EACtC,OAAQwB,EACR,cAAAuC,CAAA,CAEJ,CACA/B,EAAUA,EAAQ,cAClBwC,GAAS,CACX,CACF,CAEA,MAAO,CAAE,MAAO,KAAM,cAAAT,CAAA,CACxB,EAEae,EAAmB,CAC9B5E,EACA6E,IACuB,CACvB,MAAMC,EAAU1D,GAAiBpB,CAAS,EAC1C,GAAI8E,EAAS,OAAOA,EAEpB,MAAMC,EAAqBpE,EAAsBkE,CAAQ,EACzD,GAAIE,GAAsB,CAAC5F,EAAsB,KAAK4F,CAAkB,EACtE,OAAOA,EAGT,GAAIF,EAAU,OAAOlE,EAAsBkE,CAAQ,GAAKA,CAE1D,EA8CMpD,EAAoBzB,GAAsD,CAC9E,MAAMgF,EAAU,MAAM,KAAKhF,EAAU,iBAAoClB,CAAqB,CAAC,EACzFmG,EAAUD,EAAQ,OAAOxF,CAAS,EACxC,OAAIyF,EAAQ,OAAS,EAAUA,EAAQ,CAAC,EACjCD,EAAQ,CAAC,CAClB,EAEMnC,EAAyB,IAAiB,CAC9C,MAAM5C,EAAYlB,EAAoB,KAAK,GAAG,EACxCsC,EAAQ,MAAM,KAAK,SAAS,iBAAiBpB,CAAS,CAAC,EACvDgF,EAAU5D,EAAM,OAAO7B,CAAS,EAChCsD,EAAW,OAAO,WAAa,IAC/BC,EAAY,OAAO,YAAc,GACjCmC,EAAWD,EAAQ,OAAQxF,GAAO,CACtC,MAAMC,EAAOD,EAAG,sBAAA,EAGhB,MAFI,EAAAC,EAAK,QAAU,GAAKA,EAAK,SAAW,GACpCA,EAAK,MAAQ,KAAOA,EAAK,OAAS,KAClCA,EAAK,MAAQoD,GAAYpD,EAAK,OAASqD,EAE7C,CAAC,EACD,OAAImC,EAAS,OAAS,EACbA,EAAS,KAAK,CAAC1C,EAAGC,IAAM,CAC7B,MAAM0C,EAAK3C,EAAE,sBAAA,EACP4C,EAAK3C,EAAE,sBAAA,EACb,OAAO2C,EAAG,MAAQA,EAAG,OAASD,EAAG,MAAQA,EAAG,MAC9C,CAAC,EAEIF,EAAQ,OAAS,EAAIA,EAAU5D,CACxC,EAEagE,GAA2B,IAGnC,CACH,MAAMC,EAAazC,EAAA,EAEnB,UAAW7C,KAAasF,EAAY,CAClC,MAAMvE,EAASU,EAAiBzB,CAAS,EACzC,GAAIe,EAAQ,CACV,MAAMiC,EAAYlC,EAAkBC,EAAQ,kBAAkB,EAC9D,GAAIiC,EAAU,gBAAkBA,EAAU,UAAW,CACnD,MAAM9B,EAAY8B,EAAU,WAAa7B,EAAqBnB,CAAS,EACjEuF,EAAgBX,EAAiB5E,EAAWkB,GAAa8B,EAAU,SAAS,EAClF,MAAO,CACL,UAAW,CACT,GAAGA,EACH,UAAWuC,EACX,KAAM9E,EAAkB8E,GAAiBrE,CAAS,CAAA,EAEpD,UAAAlB,CAAA,CAEJ,CACF,CAEA,MAAMkB,EAAYC,EAAqBnB,CAAS,EAChD,GAAIkB,EAAW,CACb,MAAMqE,EAAgBX,EAAiB5E,EAAWkB,CAAS,EAC3D,MAAO,CACL,UAAW,CACT,UAAWqE,GAAiBrE,EAC5B,KAAMT,EAAkB8E,GAAiBrE,CAAS,EAClD,OAAQ,gBAAA,EAEV,UAAAlB,CAAA,CAEJ,CACF,CAEA,MAAMwF,EAAiB,MAAM,KAC3B,SAAS,iBAAoC1G,CAAqB,CAAA,EAClE,KAAKU,CAAS,EAChB,GAAIgG,EAAgB,CAClB,MAAMxC,EAAYlC,EAAkB0E,EAAgB,aAAa,EAC3DD,EAAgBX,EACpBY,EAAe,QAAQzG,EAAoB,KAAK,GAAG,CAAC,GAAKyG,EAAe,cACxExC,EAAU,SAAA,EAEZ,MAAO,CACL,UAAW,CACT,GAAGA,EACH,UAAWuC,GAAiBvC,EAAU,UACtC,KAAMvC,EAAkB8E,GAAiBvC,EAAU,SAAS,CAAA,EAE9D,UAAWwC,EAAe,QAAQzG,EAAoB,KAAK,GAAG,CAAC,GAAKyG,EAAe,aAAA,CAEvF,CAEA,MAAO,CAAE,UAAW,KAAM,UAAW,IAAA,CACvC,EC/jBMC,GAAiB,mBAEjBC,GAAmBC,GAAsC,CAC7D,MAAMC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,GAAKH,GACVG,EAAK,MAAM,QAAU,QACrBA,EAAK,MAAM,MAAQ,OACnBA,EAAK,MAAM,cAAgB,OAE3B,MAAMC,EAASD,EAAK,aAAa,CAAE,KAAM,OAAQ,EAC3CjG,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,YAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA+GpB,MAAMmG,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,kBAEpB,MAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,aAEnB,MAAMC,EAAa,SAAS,cAAc,KAAK,EAEzCC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,YAClBA,EAAM,YAAcN,EAAK,UAEzB,MAAMO,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,WACjBA,EAAK,QAAQ,MAAQ,WAErB,MAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,aACnBA,EAAO,QAAQ,MAAQ,SAEvBH,EAAW,YAAYC,CAAK,EAC5BD,EAAW,YAAYE,CAAI,EAC3BF,EAAW,YAAYG,CAAM,EAE7B,MAAMC,EAAW,SAAS,cAAc,KAAK,EAC7CA,EAAS,UAAY,eACrBA,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUrBL,EAAO,YAAYC,CAAU,EAC7BD,EAAO,YAAYK,CAAQ,EAE3B,MAAMC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,WAEjB,MAAMC,EAAkB,SAAS,cAAc,KAAK,EACpDA,EAAgB,UAAY,aAC5BA,EAAgB,QAAQ,MAAQ,kBAChCA,EAAgB,YAAc,sBAE9B,MAAM9F,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,YAClBA,EAAM,QAAQ,MAAQ,QACtBA,EAAM,YAAc,gBAEpB,MAAM+F,EAAU,SAAS,cAAc,KAAK,EAC5C,OAAAA,EAAQ,UAAY,cACpBA,EAAQ,QAAQ,MAAQ,UACxBA,EAAQ,YAAc,qBAEtBF,EAAK,YAAYC,CAAe,EAChCD,EAAK,YAAY7F,CAAK,EACtB6F,EAAK,YAAYE,CAAO,EAExBT,EAAQ,YAAYC,CAAM,EAC1BD,EAAQ,YAAYO,CAAI,EAExBR,EAAO,YAAYlG,CAAK,EACxBkG,EAAO,YAAYC,CAAO,EAEnBF,CACT,EAEA,IAAIY,EAAkC,KAClCC,EAAqC,KAEzC,MAAMC,GAAqB7G,GACrBA,IAAU,OAAkB,GAC5BA,GAAS,IAAkB,IAAIA,EAAQ,KAAW,QAAQ,CAAC,CAAC,IAC5DA,GAAS,IAAc,IAAIA,EAAQ,KAAO,QAAQ,CAAC,CAAC,IACjD,GAAGA,CAAK,GAGX8G,GAAuBhB,GAAsB,iBACjD,MAAMiB,GAAUlE,EAAA+D,GAAA,YAAAA,EAAa,aAAb,YAAA/D,EAAyB,cAAc,cACnDkE,IAASA,EAAQ,YAAcjB,EAAK,WAExC,MAAMkB,GAAcC,EAAAL,GAAA,YAAAA,EAAa,aAAb,YAAAK,EAAyB,cAC3C,kCAEF,GAAID,EACF,GAAIlB,EAAK,kBAAoB,OAAW,CACtC,MAAMoB,EAAQL,GAAkBf,EAAK,WAAW,EAChDkB,EAAY,UAAY;AAAA;AAAA;AAAA,UAGpBlB,EAAK,gBAAgB,QAAQ,CAAC,CAAC,GAAGoB,EAAQ,2BAA2BA,CAAK,kBAAoB,EAAE;AAAA,OAEtG,MACEF,EAAY,YAAc,sBAI9B,MAAMG,GAAUC,EAAAR,GAAA,YAAAA,EAAa,aAAb,YAAAQ,EAAyB,cACvC,wBAEED,IACErB,EAAK,aAAe,OACtBqB,EAAQ,UAAY,6CAA6CrB,EAAK,UAAU,WAEhFqB,EAAQ,YAAc,iBAI1B,MAAME,GAAYC,EAAAV,GAAA,YAAAA,EAAa,aAAb,YAAAU,EAAyB,cACzC,0BAEED,IACFA,EAAU,YAAcvB,EAAK,kBAAoB,sBAGnD,MAAMyB,GAASC,EAAAZ,GAAA,YAAAA,EAAa,aAAb,YAAAY,EAAyB,cACtC,2BAEED,IACEzB,EAAK,cACPyB,EAAO,MAAM,QAAU,QACvBA,EAAO,YAAczB,EAAK,eAE1ByB,EAAO,MAAM,QAAU,OACvBA,EAAO,YAAc,KAIzB,MAAME,GAAWC,EAAAd,GAAA,YAAAA,EAAa,aAAb,YAAAc,EAAyB,cACxC,yBAEED,IACE3B,EAAK,YACP2B,EAAS,MAAM,QAAU,QACzBA,EAAS,YAAc3B,EAAK,aAE5B2B,EAAS,MAAM,QAAU,OACzBA,EAAS,YAAc,IAG7B,EAEaE,EAAmB,CAAC7D,EAA2BgC,IAA+B,CACzF,MAAM8B,EAAYjB,IAAgB7C,EAClC,OAAI8D,IACEhB,KAAyB,OAAA,EAC7BD,EAAc7C,EACd8C,EAAcf,GAAgBC,CAAI,EAClChC,EAAa,aAAa8C,EAAa9C,EAAa,UAAU,GAGhEgD,GAAoBhB,CAAI,EACjB8B,CACT,EAEaC,EAAmB,IAAM,CAChCjB,KAAyB,OAAA,EAC7BD,EAAc,KACdC,EAAc,IAChB,ECrRMkB,EAAW,mBACXC,EAAe,CACnB,QAAS,GACT,SAAU,GACV,IAAK,GACP,EACMC,GAAuB,IACvBC,GAAuB,IACvBC,GAAwB,GAExBC,GAAeC,GAAqB,CACxC,MAAMC,EAAW,SAAS,eAAeP,CAAQ,EACjD,GAAI,CAACM,EAAS,CACZC,GAAA,MAAAA,EAAU,SACV,MACF,CAEA,GAAIA,EAAU,OAEd,MAAMtC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,GAAK+B,EACV/B,EAAK,MAAM,SAAW,QACtBA,EAAK,MAAM,OAAS,OACpBA,EAAK,MAAM,MAAQ,OACnBA,EAAK,MAAM,OAAS,aAEpB,MAAMC,EAASD,EAAK,aAAa,CAAE,KAAM,OAAQ,EAC3CjG,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,YAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAkBpB,MAAMwI,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,QAClBA,EAAM,YAAc,aAEpBtC,EAAO,YAAYlG,CAAK,EACxBkG,EAAO,YAAYsC,CAAK,EACxB,SAAS,gBAAgB,YAAYvC,CAAI,CAC3C,EAEA,IAAIwC,EAAiB,GAErB,MAAMC,EAAoB,MAAOJ,GAAqB,CACpDG,EAAiBH,EACZA,GACH,cAAc,KAAM,IAAI,EAE1BD,GAAYC,CAAO,CACrB,EAEA,IAAIK,EAAgB,GAChBC,EAAgC,KAChCC,EACAC,GAAgB,GAChBC,EAAmC,KAEvC,MAAMC,GAAmBlJ,GAAuB,OAC9C,GAAI,CAACA,EAAI,MAAO,OAChB,MAAMmJ,EAAQ,CAACnJ,EAAG,QAAQ,aAAa,EACjCoJ,EAAapJ,EAAmB,UAClCoJ,GACFD,EAAM,KACJ,IACEC,EACG,SAAA,EACA,MAAM,KAAK,EACX,OAAO,OAAO,EACd,MAAM,EAAG,CAAC,EACV,KAAK,GAAG,CAAA,EAGjB,MAAMC,GAAWpG,EAAAjD,EAAmB,eAAnB,YAAAiD,EAAA,KAAAjD,EAAkC,YACnD,OAAIqJ,GAASF,EAAM,KAAK,cAAeE,CAAO,IAAK,EAC5CF,EAAM,KAAK,EAAE,CACtB,EAEMG,GAAc,IAAM,OAAO,SAAS,SAAS,WAAW,QAAQ,EAEhEC,GAAqB,IACV,MAAM,KAAK,SAAS,iBAAiB,OAAO,CAAC,EAC9C,KAAMC,GAAU,CAC5B,MAAMvJ,EAAOuJ,EAAM,sBAAA,EACnB,GAAIvJ,EAAK,QAAU,GAAKA,EAAK,SAAW,EAAG,MAAO,GAClD,MAAMwJ,EAAaxJ,EAAK,MAAQ,OAAO,WACjCyJ,EAAczJ,EAAK,OAAS,OAAO,YACzC,OAAOwJ,EAAa,KAAQC,EAAc,EAC5C,CAAC,EAGGC,GAA0B,IACX,MAAM,KACvB,SAAS,iBAAiB,uDAAuD,CAAA,EAEjE,KAAM3J,GAAO,CAC7B,GAAIA,aAAc,YAAa,CAC7B,MAAMC,EAAOD,EAAG,sBAAA,EAChB,GAAIC,EAAK,QAAU,GAAKA,EAAK,SAAW,EAAG,MAAO,GAClD,MAAMI,EAAOL,EAAG,aAAe,GAC/B,MAAO,WAAW,KAAKK,CAAI,CAC7B,CACA,MAAO,EACT,CAAC,EAGGuJ,GAAe5J,GAAuB,CAC1C,GAAI,CAACA,EAAI,MAAO,GAChB,MAAMC,EAAOD,EAAG,sBAAA,EAChB,OAAIC,EAAK,QAAU,GAAKA,EAAK,SAAW,EAAU,GAEhDA,EAAK,MAAQ,OAAO,WAAaoI,IACjCpI,EAAK,OAAS,OAAO,YAAcqI,EAEvC,EAEMuB,EAAsBtJ,GAAkC,CACxD0I,GAAgBA,IAAiB1I,IACnC0I,EAAa,MAAM,QAAU,GAC7BA,EAAa,MAAM,cAAgB,GACnCA,EAAe,KAOnB,EAEMa,GACJvG,GAEKA,EACE,CACLA,EAAU,gBAAkB,GAC5BA,EAAU,WAAa,GACvBA,EAAU,MAAQ,GAClBA,EAAU,MAAQ,EAAA,EAClB,KAAK,GAAG,EANa,GASnBwG,GAAwB,IAAM,CAClC,GAAI,CAACpB,EAAgB,OAErB,GAAIW,KAAe,CAEjBrB,EAAA,EACA,MACF,CAEA,GAAIsB,KAAsB,CAExBtB,EAAA,EACA,MACF,CAEA,GAAI0B,KAA2B,CAE7B1B,EAAA,EACA,MACF,CAEA,KAAM,CAAE,UAAA1E,EAAW,UAAAhD,CAAA,EAAcqF,GAAA,EAC3BoE,EAAY9H,EAAmB3B,CAAS,EACxC2D,EAAef,GAA0B,GAAM5C,EAC/Ce,EAASS,GAAkBmC,GAAgB3D,CAAS,EACpD0J,EAAe/F,GAAA,YAAAA,EAAc,cAAc,sBAGjD,GAAI+F,EAAc,CAChB,MAAMnJ,EAAOmJ,EAAa,aAAa,MAAM,GAAK,OAC5ClJ,EAAQD,GAAA,YAAAA,EAAM,MAAM,kBACtBC,GAAOwC,IAAcA,EAAU,eAAiBxC,EAAM,CAAC,GACvDD,GAAMyC,IAAcA,EAAU,KAAOzC,EAC3C,CACA,MAAMoJ,EAAevG,GAAoBO,GAAgB3D,CAAS,EAC5D4J,EAAatG,GAAkBK,GAAgB3D,CAAS,EAC9D,GAAI,CAAC2D,GAAgB,CAAC8F,EAAW,CAQ/B/B,EAAA,EACA4B,EAAmB,IAAI,EACvB,MACF,CACA,GAAID,GAAYtI,CAAM,GAAKsI,GAAY1F,CAAY,EAAG,CAQpD+D,EAAA,EACA4B,EAAmB,IAAI,EACvB,MACF,CAEA,GADAA,EAAmB3F,CAAY,EAC3B,CAACX,EAAW,CACd,GAAI,CACF0E,EAAA,CACF,MAAgB,CAEhB,CACA4B,EAAmB,IAAI,EACvBhB,EAAgB,GAChBC,EAAgB,KAChB,MACF,CAEA,MAAMsB,EAAenG,GAAoBC,CAAY,EACrD,GAAI,CAACkG,EAAa,MAAO,CAOvBnC,EAAA,EACA4B,EAAmB,IAAI,EACvB,MACF,CACA,MAAM/D,EAAgBsE,EAAa,MAC7BC,EAAMP,GAAmB,CAAE,GAAGvG,EAAW,UAAWuC,EAAe,EACzE,GAAIuE,IAAQxB,GAAiB3E,IAAiB4E,EAAe,OAC7DD,EAAgBwB,EAChBvB,EAAgB5E,EAmBhB,MAAMoG,EAAY,OAAO,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GAC7EtB,GAAgBsB,EAChB,MAAMC,EAA+B,CACnC,KAAM,gBACN,UAAAD,EACA,QAAS,CACP,eAAgB/G,EAAU,eAC1B,UAAWuC,EACX,KAAMvC,EAAU,KAChB,KAAMA,EAAU,IAAA,CAClB,EAGF,OAAO,QACJ,YAAYgH,CAAO,EACnB,KAAMC,GAAmC,CACxC,IAAIA,GAAA,YAAAA,EAAU,QAAS,kBACnBA,EAAS,YAAcxB,GAG3B,GAAI,CACF,MAAMyB,EAAY1C,EAAiB7D,EAAc,CAC/C,UAAW4B,EACX,aAAAoE,EACA,WAAAC,EACA,gBAAiBK,EAAS,QAAQ,gBAClC,YAAaA,EAAS,QAAQ,cAC9B,WAAYA,EAAS,QAAQ,WAC7B,iBAAkBA,EAAS,QAAQ,gBAAA,CACpC,CAIH,MAAgB,CAEhB,CACF,CAAC,EACA,MAAOE,GAAQ,CAEhB,CAAC,EAEH,MAAMC,EAAY7E,EAElB,GAAI,CACF,MAAM2E,EAAY1C,EAAiB7D,EAAc,CAC/C,UAAAyG,EACA,aAAAT,EACA,WAAAC,CAAA,CACD,CAIH,MAAgB,CAEhB,CACF,EAEMS,EAA2B,IAAM,CACjC7B,GAAe,OAAO,aAAaA,CAAa,EACpDA,EAAgB,OAAO,WAAW,IAAM,CACtCgB,GAAA,CACF,EAAG3B,EAAoB,CACzB,EAEMyC,GAAsB,IAAM,CACf,IAAI,iBAAiB,IAAM,CAC1C,GAAI,CACFD,EAAA,CACF,MAAgB,CAEhB,CACF,CAAC,EACQ,QAAQ,SAAS,KAAM,CAC9B,UAAW,GACX,QAAS,GACT,WAAY,GACZ,gBAAiB,CAAC,QAAS,QAAS,gBAAiB,aAAa,CAAA,CACnE,EAED,SAAS,iBAAiB,cAAe,IAAM,CAC7C,GAAI,CACFA,EAAA,CACF,MAAgB,CAEhB,CACF,EAAG,EAAI,EACP,SAAS,iBAAiB,UAAW,IAAM,CACzC,GAAI,CACFA,EAAA,CACF,MAAgB,CAEhB,CACF,EAAG,EAAI,EACPA,EAAA,CACF,EAEME,GAAgB,SAAY,CAEhC,MAAMC,EAAO,GADC,MAAM7L,EAAA,GACC,gBAAkB,IACvC,MAAMC,GAAW,CAAE,eAAgB4L,EAAM,EACzC,MAAMnC,EAAkBmC,CAAI,EACxBA,GAAMH,EAAA,CAEZ,EAEMI,GAAiBC,GAAyB,CAE5CA,EAAM,UAAY9C,EAAa,SAC/B8C,EAAM,WAAa9C,EAAa,UAChC8C,EAAM,IAAI,YAAA,IAAkB9C,EAAa,MAEzC8C,EAAM,eAAA,EACNH,GAAA,EAAgB,MAAOJ,GAAQ1L,EAAI,gBAAiB0L,CAAG,CAAC,EAE5D,EAEMQ,GAAO,SAAY,CAEvB,MAAM1C,GADQ,MAAMtJ,EAAA,GACE,gBAAkB,GACxC,MAAM0J,EAAkBJ,CAAO,EAC/BqC,GAAA,EACA,OAAO,iBAAiB,UAAWG,EAAa,CAClD,EAEI,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoB,IAAM,CAClDE,GAAA,EAAO,MAAOR,GAAQ1L,EAAI,cAAe0L,CAAG,CAAC,CAC/C,EAAG,CAAE,KAAM,GAAM,EAEjBQ,GAAA,EAAO,MAAOR,GAAQ1L,EAAI,cAAe0L,CAAG,CAAC"}