{"version":3,"file":"index.js","sources":["../../src/shared/constants.ts","../../src/shared/logger.ts","../../src/shared/storage.ts","../../src/content/netflix/selectors.ts","../../src/content/ui/overlay/index.ts","../../src/content/ui/badge/index.ts","../../src/content/netflix/observer.ts","../../src/content/index.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const STORAGE_KEYS = {\n  OVERLAY_ENABLED: \"overlayEnabled\",\n  TMDB_API_KEY: \"tmdbApiKey\",\n  TMDB_CACHE: \"tmdbCache\",\n  TMDB_FEATURE_CACHE: \"tmdbFeatureCache\",\n  MATCH_PROFILE: \"matchProfile\",\n  LETTERBOXD_INDEX: \"lb_index_v1\",\n  LETTERBOXD_STATS: \"lb_stats_v1\",\n  LAST_IMPORT_AT: \"lastImportAt\"\n} as const;\n\nexport type StorageKey = (typeof STORAGE_KEYS)[keyof typeof STORAGE_KEYS];\n","import { DEBUG } from \"./constants\";\n\nexport { DEBUG };\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","import { log, warn } from \"./logger\";\nimport { STORAGE_KEYS } from \"./constants\";\nimport type { LetterboxdIndex, LetterboxdIndexLegacy, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  [STORAGE_KEYS.OVERLAY_ENABLED]?: boolean;\n  [STORAGE_KEYS.TMDB_API_KEY]?: string;\n  [STORAGE_KEYS.TMDB_CACHE]?: Record<string, unknown>;\n  [STORAGE_KEYS.TMDB_FEATURE_CACHE]?: Record<string, unknown>;\n  [STORAGE_KEYS.MATCH_PROFILE]?: Record<string, unknown>;\n  [STORAGE_KEYS.LETTERBOXD_INDEX]?: LetterboxdIndex | LetterboxdIndexLegacy;\n  [STORAGE_KEYS.LETTERBOXD_STATS]?: LetterboxdStats;\n  [STORAGE_KEYS.LAST_IMPORT_AT]?: string;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    STORAGE_KEYS.OVERLAY_ENABLED,\n    STORAGE_KEYS.TMDB_API_KEY,\n    STORAGE_KEYS.TMDB_CACHE,\n    STORAGE_KEYS.TMDB_FEATURE_CACHE,\n    STORAGE_KEYS.MATCH_PROFILE,\n    STORAGE_KEYS.LETTERBOXD_INDEX,\n    STORAGE_KEYS.LETTERBOXD_STATS,\n    STORAGE_KEYS.LAST_IMPORT_AT\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n\nexport const getLetterboxdIndex = async (): Promise<LetterboxdIndex | null> => {\n  const data = await chrome.storage.local.get([STORAGE_KEYS.LETTERBOXD_INDEX]);\n  const raw = data[STORAGE_KEYS.LETTERBOXD_INDEX] as\n    | LetterboxdIndex\n    | LetterboxdIndexLegacy\n    | undefined;\n  if (!raw) return null;\n\n  if (\"ratingsByKey\" in raw && \"watchlistKeys\" in raw) {\n    return raw as LetterboxdIndex;\n  }\n\n  const legacy = raw as LetterboxdIndexLegacy;\n  const ratingsByKey: Record<string, number> = {};\n  const watchlistKeys: Record<string, true> = {};\n  Object.entries(legacy).forEach(([key, entry]) => {\n    if (entry.r !== undefined) ratingsByKey[key] = entry.r;\n    if (entry.w === 1) watchlistKeys[key] = true;\n  });\n  return {\n    ratingsByKey,\n    watchlistKeys,\n    updatedAt: Date.now()\n  };\n};\n\nexport const setLetterboxdIndex = async (index: LetterboxdIndex): Promise<void> => {\n  await chrome.storage.local.set({ [STORAGE_KEYS.LETTERBOXD_INDEX]: index });\n};\n","export interface ActiveTitleCandidate {\n  netflixTitleId?: string;\n  titleText?: string;\n  year?: number;\n  href?: string;\n  source: string;\n}\n\nconst TITLE_ANCHOR_SELECTOR = \"a[href^='/title/']\";\n\nconst CONTAINER_SELECTORS = [\n  \"[role='dialog']\",\n  \"[aria-modal='true']\",\n  \"[aria-expanded='true']\",\n  \"[data-uia*='jawbone']\",\n  \"[class*='jawbone']\",\n  \"[data-uia*='preview']\",\n  \"[data-uia*='billboard']\",\n  \"[data-uia*='hero']\",\n  \"[data-uia*='details']\"\n];\n\nexport const EXPANDED_CONTAINER_SELECTOR = CONTAINER_SELECTORS.join(\",\");\n\nconst TITLE_TEXT_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='fallback']\",\n  \"[class*='preview'] [class*='header']\"\n];\n\nconst PREVIEW_SELECTORS = [\n  \"video\",\n  \"img\",\n  \"[data-uia*='preview'] video\",\n  \"[data-uia*='preview'] img\",\n  \"[class*='preview'] video\",\n  \"[class*='preview'] img\",\n  \"[data-uia*='player'] video\",\n  \"[data-uia*='hero'] img\"\n];\n\nconst CONTROLS_SELECTORS = [\n  \"[data-uia*='controls']\",\n  \"[class*='controls']\",\n  \"[class*='control']\",\n  \"[role='toolbar']\"\n];\n\nconst EPISODE_TITLE_PATTERN =\n  /(S\\d+\\s*:?\\s*E\\d+|Season\\s*\\d+\\s*Episode\\s*\\d+|Episode\\s*\\d+|\\bE\\d+\\b)/i;\nconst EPISODE_TIME_PATTERN = /(\\b\\d+\\s*(m|min|minutes)\\b|\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)\\b)/i;\n\nconst METADATA_SELECTORS = [\n  \"[data-uia*='maturity-rating']\",\n  \"[data-uia*='season']\",\n  \"[data-uia*='resolution']\",\n  \"[data-uia*='hd']\",\n  \"[class*='maturity']\",\n  \"[class*='season']\",\n  \"[class*='quality']\"\n];\n\nconst GENRE_SELECTORS = [\n  \"[data-uia*='genre']\",\n  \"a[href*='/genre/']\",\n  \"[class*='genre']\"\n];\n\nconst TITLE_LIKE_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='headline']\",\n  \"[class*='header']\",\n  \"[class*='name']\"\n];\n\nconst NAV_BANNED_PATTERN = /(browse|home|my list|popular)/i;\n\nconst isVisible = (el: Element): boolean => {\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  const style = window.getComputedStyle(el as HTMLElement);\n  if (style.visibility === \"hidden\" || style.display === \"none\" || style.opacity === \"0\") {\n    return false;\n  }\n  const inViewport =\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= window.innerHeight &&\n    rect.left <= window.innerWidth;\n  return inViewport;\n};\n\nconst normalizeText = (value?: string | null): string | undefined => {\n  if (!value) return undefined;\n  const text = value.replace(/\\s+/g, \" \").trim();\n  return text.length ? text : undefined;\n};\n\nconst parseTitleIdFromHref = (href?: string | null): string | undefined => {\n  if (!href) return undefined;\n  const match = href.match(/\\/title\\/(\\d+)/);\n  return match?.[1];\n};\n\nconst parseYearFromText = (text?: string): number | undefined => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  if (Number.isNaN(year)) return undefined;\n  return year;\n};\n\nexport const normalizeNetflixTitle = (raw?: string): string | undefined => {\n  if (!raw) return undefined;\n  let value = raw;\n  value = value.replace(/^\\s*S\\d+\\s*:?\\s*E\\d+\\s*/i, \"\");\n  value = value.replace(/\"[^\"]*\"/g, (match) => {\n    const inner = match.replace(/\"/g, \"\");\n    return EPISODE_TITLE_PATTERN.test(inner) ? \"\" : match;\n  });\n  value = value.replace(/Episode\\s*\\d+/gi, \"\");\n  value = value.replace(/\\bE\\d+\\b/gi, \"\");\n  value = value.replace(EPISODE_TIME_PATTERN, \"\");\n  value = value.replace(/\\s+of\\s+\\d+\\s*(m|min|minutes)?/gi, \"\");\n  value = value.replace(/\\s+/g, \" \").trim();\n  return value.length ? value : undefined;\n};\n\nconst extractFromAnchor = (anchor: HTMLAnchorElement, source: string): ActiveTitleCandidate => {\n  const href = anchor.getAttribute(\"href\") || undefined;\n  const netflixTitleId = parseTitleIdFromHref(href);\n  const titleText = normalizeText(anchor.getAttribute(\"aria-label\") || anchor.textContent);\n  return { netflixTitleId, titleText, href, source };\n};\n\nconst extractTitleTextNear = (container: Element): string | undefined => {\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const el = container.querySelector(selector);\n    if (el && isVisible(el)) {\n      const text = normalizeText(el.textContent);\n      if (text) return text;\n    }\n  }\n  return undefined;\n};\n\nexport const getRawTitleText = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  return extractTitleTextNear(container);\n};\n\nconst findPrimaryTitle = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const nodes = Array.from(container.querySelectorAll(selector));\n    for (const node of nodes) {\n      if (!isVisible(node)) continue;\n      const text = normalizeText(node.textContent);\n      if (!text) continue;\n      if (EPISODE_TITLE_PATTERN.test(text) || EPISODE_TIME_PATTERN.test(text)) continue;\n      const normalized = normalizeNetflixTitle(text);\n      if (normalized) return normalized;\n    }\n  }\n  return undefined;\n};\n\nexport const findOverlayAnchor = (container?: Element | null): Element | null => {\n  if (container) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor && isVisible(anchor)) return anchor;\n    for (const selector of TITLE_TEXT_SELECTORS) {\n      const el = container.querySelector(selector);\n      if (el && isVisible(el)) return el;\n    }\n  }\n\n  const pageAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (pageAnchor) return pageAnchor;\n\n  const pageTitle = Array.from(document.querySelectorAll(TITLE_TEXT_SELECTORS.join(\",\"))).find(\n    isVisible\n  );\n  return pageTitle ?? null;\n};\n\nexport const findPreviewElement = (container?: Element | null): Element | null => {\n  if (!container) return null;\n  const candidates: Element[] = [];\n  PREVIEW_SELECTORS.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (isVisible(el)) candidates.push(el);\n    });\n  });\n  if (!candidates.length) return null;\n  return candidates.reduce((best, current) => {\n    const bestRect = best.getBoundingClientRect();\n    const currentRect = current.getBoundingClientRect();\n    const bestArea = bestRect.width * bestRect.height;\n    const currentArea = currentRect.width * currentRect.height;\n    return currentArea > bestArea ? current : best;\n  });\n};\n\nexport const findControlsRow = (root?: Element | null): HTMLElement | null => {\n  if (!root) return null;\n  const candidates: HTMLElement[] = [];\n  CONTROLS_SELECTORS.forEach((selector) => {\n    root.querySelectorAll<HTMLElement>(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      candidates.push(el);\n    });\n  });\n  const unique = Array.from(new Set(candidates));\n  const scored = unique\n    .map((el) => {\n      const buttons = el.querySelectorAll(\"button, [role='button']\").length;\n      const rect = el.getBoundingClientRect();\n      const score = buttons * 10 + rect.width;\n      return { el, score, top: rect.top };\n    })\n    .filter((entry) => entry.score > 0);\n  scored.sort((a, b) => b.score - a.score || b.top - a.top);\n  return scored[0]?.el ?? null;\n};\n\nexport const hasMetadataSection = (root?: Element | null): boolean => {\n  if (!root) return false;\n  const selectors = [...METADATA_SELECTORS, ...GENRE_SELECTORS].join(\",\");\n  const nodes = Array.from(root.querySelectorAll(selectors));\n  return nodes.some((node) => isVisible(node));\n};\n\nexport const findExpandedRoot = (): HTMLElement | null => {\n  const candidates = findExpandedContainers();\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  for (const candidate of candidates) {\n    const rect = candidate.getBoundingClientRect();\n    if (rect.width > maxWidth || rect.height > maxHeight) continue;\n    const preview = findPreviewElement(candidate);\n    const controls = findControlsRow(candidate);\n    const metadata = hasMetadataSection(candidate);\n    if (preview && controls && metadata) {\n      return candidate as HTMLElement;\n    }\n  }\n  return null;\n};\n\n\nconst isBannedTitleText = (text: string) => {\n  if (NAV_BANNED_PATTERN.test(text)) return true;\n  return (\n    EPISODE_TITLE_PATTERN.test(text) ||\n    EPISODE_TIME_PATTERN.test(text) ||\n    /\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)?\\b/i.test(text) ||\n    /\\b\\d+\\s*(m|min|minutes)\\b/i.test(text)\n  );\n};\n\nconst isInProgressRegion = (el: Element, controlsTop?: number) => {\n  if (el.closest('[role=\"progressbar\"], [data-uia*=\"progress\"], [class*=\"progress\"]')) {\n    return true;\n  }\n  if (controlsTop !== undefined) {\n    const rect = el.getBoundingClientRect();\n    return rect.bottom >= controlsTop - 8;\n  }\n  return false;\n};\n\nexport const extractDisplayTitle = (expandedRoot: HTMLElement): {\n  title: string | null;\n  chosen?: Element;\n  rejectedCount: number;\n} => {\n  const rootRect = expandedRoot.getBoundingClientRect();\n  const controls = findControlsRow(expandedRoot);\n  const controlsTop = controls ? controls.getBoundingClientRect().top : undefined;\n  const candidates = Array.from(expandedRoot.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n  let best: { el: Element; score: number; text: string } | undefined;\n  let rejectedCount = 0;\n  const episodeNodes: Element[] = [];\n\n  candidates.forEach((el) => {\n    if (!isVisible(el)) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isInProgressRegion(el, controlsTop)) {\n      rejectedCount += 1;\n      return;\n    }\n    const text = normalizeText(el.textContent);\n    if (!text || text.length < 2 || text.length > 80) {\n      rejectedCount += 1;\n      return;\n    }\n    if (isBannedTitleText(text)) {\n      episodeNodes.push(el);\n      rejectedCount += 1;\n      return;\n    }\n\n    const rect = el.getBoundingClientRect();\n    const style = window.getComputedStyle(el as HTMLElement);\n    const fontSize = parseFloat(style.fontSize) || 14;\n    const fontWeightRaw = style.fontWeight === \"bold\" ? 700 : Number(style.fontWeight);\n    const fontWeight = Number.isNaN(fontWeightRaw) ? 400 : fontWeightRaw;\n    const dx = rect.left - rootRect.left;\n    const dy = rect.top - rootRect.top;\n    const dist = Math.hypot(dx, dy);\n    const score = fontSize * 10 + fontWeight / 10 + Math.max(0, 300 - dist);\n    if (!best || score > best.score) {\n      best = { el, score, text };\n    }\n  });\n\n  if (best) {\n    const normalized = normalizeNetflixTitle(best.text);\n    return { title: normalized ?? best.text, chosen: best.el, rejectedCount };\n  }\n\n  for (const episodeNode of episodeNodes) {\n    let current: Element | null = episodeNode.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const siblingCandidates = Array.from(\n        current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\"))\n      ).filter((el) => el !== episodeNode);\n      for (const sibling of siblingCandidates) {\n        if (!isVisible(sibling)) continue;\n        if (isInProgressRegion(sibling, controlsTop)) continue;\n        const text = normalizeText(sibling.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: sibling,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  const anchor = expandedRoot.querySelector(\"a[href^='/title/']\");\n  if (anchor) {\n    const heading = anchor.querySelector(TITLE_LIKE_SELECTORS.join(\",\"));\n    const directText = normalizeText(heading?.textContent || anchor.textContent);\n    if (directText && !isBannedTitleText(directText)) {\n      return {\n        title: normalizeNetflixTitle(directText) ?? directText,\n        chosen: heading ?? anchor,\n        rejectedCount\n      };\n    }\n\n    let current: Element | null = anchor.parentElement;\n    let depth = 0;\n    while (current && depth < 4) {\n      const nearby = Array.from(current.querySelectorAll(TITLE_LIKE_SELECTORS.join(\",\")));\n      for (const node of nearby) {\n        if (!isVisible(node)) continue;\n        if (isInProgressRegion(node, controlsTop)) continue;\n        const text = normalizeText(node.textContent);\n        if (!text || text.length < 2 || text.length > 80) continue;\n        if (isBannedTitleText(text)) continue;\n        return {\n          title: normalizeNetflixTitle(text) ?? text,\n          chosen: node,\n          rejectedCount\n        };\n      }\n      current = current.parentElement;\n      depth += 1;\n    }\n  }\n\n  return { title: null, rejectedCount };\n};\n\nexport const resolveTitleText = (\n  container?: Element | null,\n  fallback?: string\n): string | undefined => {\n  const primary = findPrimaryTitle(container);\n  if (primary) return primary;\n\n  const normalizedFallback = normalizeNetflixTitle(fallback);\n  if (normalizedFallback && !EPISODE_TITLE_PATTERN.test(normalizedFallback)) {\n    return normalizedFallback;\n  }\n\n  if (fallback) return normalizeNetflixTitle(fallback) ?? fallback;\n  return undefined;\n};\n\n\nconst findBestAnchorIn = (container: Element): HTMLAnchorElement | undefined => {\n  const anchors = Array.from(container.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR));\n  const visible = anchors.filter(isVisible);\n  if (visible.length > 0) return visible[0];\n  return anchors[0];\n};\n\nconst findExpandedContainers = (): Element[] => {\n  const selectors = CONTAINER_SELECTORS.join(\",\");\n  const nodes = Array.from(document.querySelectorAll(selectors));\n  const visible = nodes.filter(isVisible);\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  const filtered = visible.filter((el) => {\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    if (rect.width < 240 || rect.height < 180) return false;\n    if (rect.width > maxWidth || rect.height > maxHeight) return false;\n    return true;\n  });\n  if (filtered.length > 0) {\n    return filtered.sort((a, b) => {\n      const ra = a.getBoundingClientRect();\n      const rb = b.getBoundingClientRect();\n      return rb.width * rb.height - ra.width * ra.height;\n    });\n  }\n  return visible.length > 0 ? visible : nodes;\n};\n\nexport const detectActiveTitleContext = (): {\n  candidate: ActiveTitleCandidate | null;\n  container: Element | null;\n} => {\n  const containers = findExpandedContainers();\n\n  for (const container of containers) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor) {\n      const candidate = extractFromAnchor(anchor, \"container-anchor\");\n      if (candidate.netflixTitleId || candidate.titleText) {\n        const titleText = candidate.titleText ?? extractTitleTextNear(container);\n        const resolvedTitle = resolveTitleText(container, titleText ?? candidate.titleText);\n        return {\n          candidate: {\n            ...candidate,\n            titleText: resolvedTitle,\n            year: parseYearFromText(resolvedTitle ?? titleText)\n          },\n          container\n        };\n      }\n    }\n\n    const titleText = extractTitleTextNear(container);\n    if (titleText) {\n      const resolvedTitle = resolveTitleText(container, titleText);\n      return {\n        candidate: {\n          titleText: resolvedTitle ?? titleText,\n          year: parseYearFromText(resolvedTitle ?? titleText),\n          source: \"container-text\"\n        },\n        container\n      };\n    }\n  }\n\n  const fallbackAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (fallbackAnchor) {\n    const candidate = extractFromAnchor(fallbackAnchor, \"page-anchor\");\n    const resolvedTitle = resolveTitleText(\n      fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement,\n      candidate.titleText\n    );\n    return {\n      candidate: {\n        ...candidate,\n        titleText: resolvedTitle ?? candidate.titleText,\n        year: parseYearFromText(resolvedTitle ?? candidate.titleText)\n      },\n      container: fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement\n    };\n  }\n\n  return { candidate: null, container: null };\n};\n\n// Intentionally no default export.\n","export interface OverlayData {\n  communityRating?: number;\n  ratingCount?: number;\n  matchScore?: number;\n  matchExplanation?: string;\n  inWatchlist?: boolean;\n  userRating?: number;\n}\n\nconst TOP_SECTION_ID = \"nxlb-top-section\";\n\nconst buildTopSection = (): HTMLDivElement => {\n  const host = document.createElement(\"div\");\n  host.id = TOP_SECTION_ID;\n  host.style.display = \"block\";\n  host.style.width = \"100%\";\n  host.style.pointerEvents = \"none\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n      pointer-events: none;\n      display: block;\n      width: 100%;\n      box-sizing: border-box;\n      opacity: 0;\n      transform: translateY(-8px);\n      transition: opacity 180ms cubic-bezier(0.2, 0, 0, 1),\n        transform 180ms cubic-bezier(0.2, 0, 0, 1);\n      will-change: opacity, transform;\n    }\n    :host(.nxl-visible) {\n      opacity: 1;\n      transform: translateY(0);\n    }\n    .nxl-top-section {\n      background: rgba(0, 0, 0, 0.82);\n      color: #f5f5f5;\n      padding: 16px 20px;\n      border-top-left-radius: 12px;\n      border-top-right-radius: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      display: grid;\n      gap: 8px;\n      box-sizing: border-box;\n    }\n    .nxl-header {\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n      gap: 16px;\n    }\n    .nxl-branding {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.85);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .nxl-dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .nxl-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 999px;\n      display: inline-block;\n    }\n    .nxl-dot.green { background: #00c46a; }\n    .nxl-dot.orange { background: #f2b34c; }\n    .nxl-dot.blue { background: #4aa8ff; }\n    .nxl-body {\n      display: grid;\n      gap: 6px;\n      font-size: 15px;\n      color: rgba(255, 255, 255, 0.9);\n    }\n    .nxl-rating {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .nxl-star {\n      color: #e3b341;\n      font-size: 16px;\n    }\n    .nxl-match {\n      display: flex;\n      align-items: baseline;\n      gap: 8px;\n    }\n    .nxl-match-value {\n      color: #46d369;\n      font-weight: 700;\n      font-size: 20px;\n    }\n    .nxl-because {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 14px;\n    }\n    .nxl-badges {\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.85);\n    }\n    .nxl-badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      padding: 4px 8px;\n      border-radius: 999px;\n      border: 1px solid rgba(255, 255, 255, 0.18);\n      background: rgba(255, 255, 255, 0.06);\n    }\n  `;\n\n  const section = document.createElement(\"div\");\n  section.className = \"nxl-top-section\";\n\n  const header = document.createElement(\"div\");\n  header.className = \"nxl-header\";\n\n  const branding = document.createElement(\"div\");\n  branding.className = \"nxl-branding\";\n  branding.innerHTML = `\n    Powered by\n    <span class=\"nxl-dots\">\n      <span class=\"nxl-dot green\"></span>\n      <span class=\"nxl-dot orange\"></span>\n      <span class=\"nxl-dot blue\"></span>\n    </span>\n    Letterboxd\n  `;\n\n  header.appendChild(branding);\n\n  const body = document.createElement(\"div\");\n  body.className = \"nxl-body\";\n\n  const communityRating = document.createElement(\"div\");\n  communityRating.className = \"nxl-rating\";\n  communityRating.dataset.field = \"communityRating\";\n  communityRating.textContent = \"Community rating: —\";\n\n  const match = document.createElement(\"div\");\n  match.className = \"nxl-match\";\n  match.dataset.field = \"match\";\n  match.textContent = \"Your match: —\";\n\n  const because = document.createElement(\"div\");\n  because.className = \"nxl-because\";\n  because.dataset.field = \"because\";\n  because.textContent = \"Because you like: —\";\n\n  const badges = document.createElement(\"div\");\n  badges.className = \"nxl-badges\";\n  badges.dataset.field = \"badges\";\n\n  body.appendChild(communityRating);\n  body.appendChild(match);\n  body.appendChild(because);\n  body.appendChild(badges);\n\n  section.appendChild(header);\n  section.appendChild(body);\n\n  shadow.appendChild(style);\n  shadow.appendChild(section);\n\n  return host;\n};\n\nconst formatRatingCount = (value?: number) => {\n  if (value === undefined) return \"\";\n  if (value >= 1_000_000) return `${(value / 1_000_000).toFixed(1)}M`;\n  if (value >= 1_000) return `${(value / 1_000).toFixed(1)}K`;\n  return `${value}`;\n};\n\nconst renderStars = (rating: number) => {\n  const clamped = Math.max(0, Math.min(5, rating));\n  const full = Math.floor(clamped);\n  const half = clamped % 1 >= 0.5;\n  return \"★\".repeat(full) + (half ? \"½\" : \"\");\n};\n\nconst applyTopSectionData = (host: HTMLDivElement, data: OverlayData) => {\n  const communityEl = host.shadowRoot?.querySelector(\n    \"[data-field='communityRating']\"\n  ) as HTMLDivElement | null;\n  if (communityEl) {\n    if (data.communityRating !== undefined) {\n      const count = formatRatingCount(data.ratingCount);\n      communityEl.innerHTML = `\n        Community rating:\n        <span class=\"nxl-star\">★</span>\n        ${data.communityRating.toFixed(1)}${\n        count ? ` <span class=\"nxl-meta\">${count} ratings</span>` : \"\"\n      }\n      `;\n    } else {\n      communityEl.textContent = \"Community rating: —\";\n    }\n  }\n\n  const matchEl = host.shadowRoot?.querySelector(\"[data-field='match']\") as\n    | HTMLDivElement\n    | null;\n  if (matchEl) {\n    if (data.matchScore !== undefined) {\n      matchEl.innerHTML = `Your match: <span class=\"nxl-match-value\">${data.matchScore}%</span>`;\n    } else {\n      matchEl.textContent = \"Your match: —\";\n    }\n  }\n\n  const becauseEl = host.shadowRoot?.querySelector(\"[data-field='because']\") as\n    | HTMLDivElement\n    | null;\n  if (becauseEl) {\n    becauseEl.textContent = data.matchExplanation\n      ? `Because you like: ${data.matchExplanation.replace(/^Because you like\\s*/i, \"\")}`\n      : \"Because you like: —\";\n  }\n\n  const badgesEl = host.shadowRoot?.querySelector(\"[data-field='badges']\") as\n    | HTMLDivElement\n    | null;\n  if (badgesEl) {\n    badgesEl.innerHTML = \"\";\n    if (data.inWatchlist) {\n      const badge = document.createElement(\"span\");\n      badge.className = \"nxl-badge\";\n      badge.textContent = \"On watchlist\";\n      badgesEl.appendChild(badge);\n    }\n    if (data.userRating !== undefined) {\n      const badge = document.createElement(\"span\");\n      badge.className = \"nxl-badge\";\n      badge.textContent = `You rated ${renderStars(data.userRating)}`;\n      badgesEl.appendChild(badge);\n    }\n    if (!data.inWatchlist && data.userRating === undefined) {\n      const badge = document.createElement(\"span\");\n      badge.className = \"nxl-badge\";\n      badge.textContent = \"Letterboxd: —\";\n      badgesEl.appendChild(badge);\n    }\n  }\n};\n\nexport const createOverlayManager = () => {\n  let currentRoot: HTMLElement | null = null;\n  let host: HTMLDivElement | null = null;\n  let lastData: OverlayData = {};\n\n  const ensureHost = () => {\n    if (!host) host = buildTopSection();\n  };\n\n  const mount = (expandedRoot: HTMLElement) => {\n    ensureHost();\n    if (!host) return;\n    if (currentRoot !== expandedRoot) {\n      host.remove();\n      expandedRoot.insertBefore(host, expandedRoot.firstChild);\n      currentRoot = expandedRoot;\n      requestAnimationFrame(() => {\n        host?.classList.add(\"nxl-visible\");\n      });\n    }\n  };\n\n  const update = (data: OverlayData) => {\n    lastData = { ...lastData, ...data };\n    if (host) applyTopSectionData(host, lastData);\n  };\n\n  const unmount = () => {\n    if (host) host.remove();\n    currentRoot = null;\n  };\n\n  const renderLast = () => {\n    if (host) applyTopSectionData(host, lastData);\n  };\n\n  return {\n    mount,\n    update,\n    unmount,\n    renderLast,\n    getLastData: () => lastData,\n    getCurrentRoot: () => currentRoot,\n    isMounted: () => Boolean(host && host.isConnected)\n  };\n};\n","import { log } from \"../../../shared/logger\";\n\nconst BADGE_ID = \"nxlb-status-badge\";\n\nconst buildBadgeHost = () => {\n  const host = document.createElement(\"div\");\n  host.id = BADGE_ID;\n  host.style.position = \"fixed\";\n  host.style.bottom = \"16px\";\n  host.style.right = \"16px\";\n  host.style.zIndex = \"2147483647\";\n  host.style.pointerEvents = \"none\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n    }\n    .badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      background: rgba(0, 0, 0, 0.8);\n      border: 1px solid rgba(255, 255, 255, 0.12);\n      border-radius: 999px;\n      padding: 8px 12px;\n      color: #f5f5f5;\n      font-size: 12px;\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);\n      pointer-events: auto;\n      position: relative;\n    }\n    .dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n    .dot.orange { background: #f2b34c; }\n    .dot.green { background: #00c46a; }\n    .dot.blue { background: #4aa8ff; }\n    .status {\n      width: 6px;\n      height: 6px;\n      border-radius: 50%;\n      background: #46d369;\n      box-shadow: 0 0 6px rgba(70, 211, 105, 0.6);\n    }\n    .tooltip {\n      position: absolute;\n      bottom: calc(100% + 8px);\n      right: 0;\n      background: rgba(0, 0, 0, 0.9);\n      color: #f5f5f5;\n      font-size: 11px;\n      padding: 6px 8px;\n      border-radius: 8px;\n      opacity: 0;\n      transform: translateY(4px);\n      transition: opacity 120ms ease, transform 120ms ease;\n      white-space: nowrap;\n      pointer-events: none;\n    }\n    .badge:hover .tooltip {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  `;\n\n  const badge = document.createElement(\"div\");\n  badge.className = \"badge\";\n  badge.innerHTML = `\n    <span class=\"dots\">\n      <span class=\"dot orange\"></span>\n      <span class=\"dot green\"></span>\n      <span class=\"dot blue\"></span>\n    </span>\n    <span>Letterboxd</span>\n    <span class=\"status\" aria-hidden=\"true\"></span>\n    <span class=\"tooltip\">Netflix × Letterboxd overlay enabled</span>\n  `;\n\n  shadow.appendChild(style);\n  shadow.appendChild(badge);\n  return host;\n};\n\nexport const setBadgeVisible = (enabled: boolean) => {\n  const existing = document.getElementById(BADGE_ID);\n  if (!enabled) {\n    if (existing) {\n      existing.remove();\n      log(\"OVERLAY_BADGE_REMOVED\");\n    }\n    return;\n  }\n\n  if (existing) return;\n\n  const host = buildBadgeHost();\n  document.documentElement.appendChild(host);\n  log(\"OVERLAY_BADGE_MOUNTED\");\n};\n","import { log, DEBUG } from \"../../shared/logger\";\nimport { STORAGE_KEYS } from \"../../shared/constants\";\nimport { getStorage, setStorage } from \"../../shared/storage\";\nimport { buildLetterboxdKey } from \"../../shared/normalize\";\nimport type {\n  LetterboxdIndexUpdatedAckMessage,\n  ResolveTitleMessage,\n  TitleResolvedMessage\n} from \"../../shared/types\";\nimport {\n  detectActiveTitleContext,\n  extractDisplayTitle,\n  findExpandedRoot,\n  findPreviewElement,\n  getRawTitleText,\n  normalizeNetflixTitle,\n  EXPANDED_CONTAINER_SELECTOR\n} from \"./selectors\";\nimport { createOverlayManager } from \"../ui/overlay\";\nimport { setBadgeVisible } from \"../ui/badge\";\n\nconst TOGGLE_COMBO = {\n  ctrlKey: true,\n  shiftKey: true,\n  key: \"l\"\n};\nconst OBSERVER_DEBOUNCE_MS = 250;\nconst WATCHDOG_INTERVAL_MS = 2000;\nconst HERO_WIDTH_THRESHOLD = 0.85;\nconst HERO_HEIGHT_THRESHOLD = 0.6;\n\nconst overlayManager = createOverlayManager();\n\nlet overlayEnabled = true;\nlet lastActiveKey = \"\";\nlet lastContainer: Element | null = null;\nlet debounceTimer: number | undefined;\nlet watchdogTimer: number | undefined;\nlet lastRequestId = \"\";\nlet lastOutlined: HTMLElement | null = null;\nlet playbackActive = false;\nlet lastResolvedPayload: TitleResolvedMessage[\"payload\"] | null = null;\n\ntype NxlWindow = Window & {\n  __nxlBooted?: boolean;\n  __nxlDebug?: {\n    getIndex: () => Promise<Record<string, unknown>>;\n    forceRerender: () => void;\n    lastResolved: () => TitleResolvedMessage[\"payload\"] | null;\n  };\n};\n\nconst getNxlWindow = () => window as NxlWindow;\n\nconst describeElement = (el: Element | null) => {\n  if (!el) return \"none\";\n  const parts = [el.tagName.toLowerCase()];\n  const className = (el as HTMLElement).className;\n  if (className) {\n    parts.push(\n      \".\" +\n        className\n          .toString()\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 3)\n          .join(\".\")\n    );\n  }\n  const dataUia = (el as HTMLElement).getAttribute?.(\"data-uia\");\n  if (dataUia) parts.push(`[data-uia=\"${dataUia}\"]`);\n  return parts.join(\"\");\n};\n\nconst isHeroSized = (el: Element | null) => {\n  if (!el) return false;\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  return (\n    rect.width > window.innerWidth * HERO_WIDTH_THRESHOLD ||\n    rect.height > window.innerHeight * HERO_HEIGHT_THRESHOLD\n  );\n};\n\nconst updateDebugOutline = (container: HTMLElement | null) => {\n  if (lastOutlined && lastOutlined !== container) {\n    lastOutlined.style.outline = \"\";\n    lastOutlined.style.outlineOffset = \"\";\n    lastOutlined = null;\n  }\n  if (container && DEBUG) {\n    container.style.outline = \"1px solid rgba(255, 80, 80, 0.85)\";\n    container.style.outlineOffset = \"-1px\";\n    lastOutlined = container;\n  }\n};\n\nconst isPlaybackRoute = () => window.location.pathname.includes(\"/watch/\");\n\nconst isPlayingMainVideo = () => {\n  const videos = Array.from(document.querySelectorAll(\"video\"));\n  return videos.some((video) => {\n    if (video.paused || video.ended) return false;\n    const rect = video.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    const widthRatio = rect.width / window.innerWidth;\n    const heightRatio = rect.height / window.innerHeight;\n    return widthRatio > 0.85 || heightRatio > 0.6;\n  });\n};\n\nconst hasPlayerContainer = () => {\n  return Boolean(\n    document.querySelector(\n      \"[data-uia*='video-player'], [class*='VideoPlayer'], [class*='watch-video'], [data-uia*='player']\"\n    )\n  );\n};\n\nconst detectPlaybackActive = () => {\n  if (isPlaybackRoute()) return true;\n  if (isPlayingMainVideo()) return true;\n  if (hasPlayerContainer() && isPlayingMainVideo()) return true;\n  return false;\n};\n\nconst updatePlaybackState = () => {\n  const next = detectPlaybackActive();\n  if (next === playbackActive) return;\n  playbackActive = next;\n\n  if (playbackActive) {\n    setBadgeVisible(false);\n    log(\"BADGE_HIDDEN_PLAYBACK\");\n    overlayManager.unmount();\n  } else {\n    if (overlayEnabled) {\n      setBadgeVisible(true);\n      log(\"BADGE_SHOWN\");\n      log(\"BROWSE_MODE_DETECTED\");\n    }\n  }\n};\n\nconst setBadgeForState = () => {\n  if (!overlayEnabled) {\n    setBadgeVisible(false);\n    return;\n  }\n  if (!playbackActive) {\n    setBadgeVisible(true);\n    log(\"BADGE_SHOWN\");\n  }\n};\n\nconst serializeCandidateKey = (titleText?: string, year?: number, href?: string) => {\n  return [titleText ?? \"\", year ?? \"\", href ?? \"\"].join(\"|\");\n};\n\nconst parseYearFromText = (text?: string) => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  return Number.isNaN(year) ? undefined : year;\n};\n\nconst findHoveredExpandedRoot = () => {\n  const hovered = Array.from(document.querySelectorAll(\":hover\"));\n  if (!hovered.length) return null;\n  const candidates = hovered\n    .map((el) => (el as Element).closest(EXPANDED_CONTAINER_SELECTOR) ?? (el as Element))\n    .filter(Boolean) as Element[];\n  let best: HTMLElement | null = null;\n  let bestArea = 0;\n  candidates.forEach((candidate) => {\n    const rect = candidate.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return;\n    const area = rect.width * rect.height;\n    if (area > bestArea) {\n      bestArea = area;\n      best = candidate as HTMLElement;\n    }\n  });\n  return best;\n};\n\nconst attemptResolve = (reason: string) => {\n  if (!overlayEnabled) return;\n  updatePlaybackState();\n  if (playbackActive) return;\n\n  if (DEBUG) log(\"OVERLAY_MOUNT_ATTEMPT\", { reason });\n\n  const strategies: Array<{\n    name: string;\n    root: HTMLElement | null;\n    candidate?: ReturnType<typeof detectActiveTitleContext>[\"candidate\"] | null;\n  }> = [];\n\n  const detected = detectActiveTitleContext();\n  const detectedRoot = findExpandedRoot() ?? (detected.container as HTMLElement | null);\n  strategies.push({ name: \"detect-active\", root: detectedRoot, candidate: detected.candidate });\n\n  const expandedRoot = findExpandedRoot();\n  strategies.push({ name: \"expanded-root\", root: expandedRoot, candidate: null });\n\n  const hoveredRoot = findHoveredExpandedRoot();\n  strategies.push({ name: \"hovered\", root: hoveredRoot, candidate: null });\n\n  for (const strategy of strategies) {\n    const root = strategy.root;\n    if (!root) continue;\n    if (isHeroSized(root)) continue;\n    const previewEl = findPreviewElement(root);\n    if (!previewEl) continue;\n\n    const anchorInRoot = root.querySelector(\"a[href^='/title/']\") as HTMLAnchorElement | null;\n    const href = anchorInRoot?.getAttribute(\"href\") ?? undefined;\n    const idMatch = href?.match(/\\/title\\/(\\d+)/);\n    const netflixTitleId = idMatch?.[1] ?? strategy.candidate?.netflixTitleId;\n\n    const displayTitle = extractDisplayTitle(root);\n    const resolvedTitle = displayTitle.title ?? strategy.candidate?.titleText;\n    if (!resolvedTitle) {\n      if (DEBUG) log(\"OVERLAY_MOUNT_FAILED\", { reason: \"no-display-title\", strategy: strategy.name });\n      continue;\n    }\n\n    const normalizedTitle = normalizeNetflixTitle(resolvedTitle) ?? resolvedTitle;\n    const year = parseYearFromText(normalizedTitle);\n    const key = serializeCandidateKey(normalizedTitle, year, href);\n\n    if (key === lastActiveKey && root === lastContainer) {\n      if (DEBUG) log(\"OVERLAY_MOUNT_SUCCESS\", { strategy: strategy.name, reused: true });\n      return;\n    }\n\n    lastActiveKey = key;\n    lastContainer = root;\n    updateDebugOutline(root);\n\n    if (DEBUG) {\n      const rawTitle = getRawTitleText(root);\n      log(\"OVERLAY_MOUNT_SUCCESS\", {\n        strategy: strategy.name,\n        titleText: normalizedTitle,\n        href,\n        netflixTitleId,\n        rawTitle,\n        container: describeElement(root),\n        rejectedTitleCandidates: displayTitle.rejectedCount,\n        chosenTitleElement: displayTitle.chosen\n          ? displayTitle.chosen.outerHTML.slice(0, 200)\n          : undefined\n      });\n    }\n\n    overlayManager.mount(root);\n    overlayManager.update({});\n\n    const requestId = `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n    lastRequestId = requestId;\n    const message: ResolveTitleMessage = {\n      type: \"RESOLVE_TITLE\",\n      requestId,\n      payload: {\n        netflixTitleId,\n        titleText: normalizedTitle,\n        year,\n        href\n      }\n    };\n\n    chrome.runtime\n      .sendMessage(message)\n      .then((response: TitleResolvedMessage) => {\n        if (response?.type !== \"TITLE_RESOLVED\") return;\n        if (response.requestId !== lastRequestId) return;\n        lastResolvedPayload = response.payload;\n        log(\"Title resolved\", { requestId, response });\n\n        overlayManager.update({\n          communityRating: response.payload.tmdbVoteAverage,\n          ratingCount: response.payload.tmdbVoteCount,\n          matchScore: response.payload.matchScore,\n          matchExplanation: response.payload.matchExplanation,\n          inWatchlist: response.payload.inWatchlist,\n          userRating: response.payload.userRating\n        });\n\n        if (DEBUG) {\n          if (\n            response.payload.inWatchlist === undefined &&\n            response.payload.userRating === undefined\n          ) {\n            const keyForLookup = buildLetterboxdKey(normalizedTitle, year);\n            chrome.storage.local.get([STORAGE_KEYS.LETTERBOXD_INDEX]).then((data) => {\n              if (!data[STORAGE_KEYS.LETTERBOXD_INDEX]) {\n                log(\"LB_MATCH_NOT_FOUND\", { reason: \"no-index\", key: keyForLookup });\n              } else if (!year) {\n                log(\"LB_MATCH_NOT_FOUND\", { reason: \"missing-year\", key: keyForLookup });\n              } else {\n                log(\"LB_MATCH_NOT_FOUND\", { reason: \"no-key\", key: keyForLookup });\n              }\n            });\n          }\n        }\n      })\n      .catch((err) => {\n        log(\"Title resolve failed\", { requestId, err });\n      });\n\n    return;\n  }\n\n  if (DEBUG) log(\"OVERLAY_MOUNT_FAILED\", { reason: \"no-strategy\" });\n  overlayManager.unmount();\n  updateDebugOutline(null);\n};\n\nconst scheduleResolve = (reason: string) => {\n  if (debounceTimer) window.clearTimeout(debounceTimer);\n  debounceTimer = window.setTimeout(() => {\n    attemptResolve(reason);\n  }, OBSERVER_DEBOUNCE_MS);\n};\n\nconst observeTitleChanges = () => {\n  const observer = new MutationObserver(() => {\n    try {\n      scheduleResolve(\"mutation\");\n    } catch (error) {\n      log(\"Mutation observer failed\", { error });\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter: [\"class\", \"style\", \"aria-expanded\", \"aria-hidden\"]\n  });\n\n  document.addEventListener(\n    \"pointerover\",\n    () => {\n      try {\n        scheduleResolve(\"pointer\");\n      } catch (error) {\n        log(\"Pointer observer failed\", { error });\n      }\n    },\n    true\n  );\n  document.addEventListener(\n    \"focusin\",\n    () => {\n      try {\n        scheduleResolve(\"focus\");\n      } catch (error) {\n        log(\"Focus observer failed\", { error });\n      }\n    },\n    true\n  );\n\n  if (watchdogTimer) window.clearInterval(watchdogTimer);\n  watchdogTimer = window.setInterval(() => {\n    if (!overlayEnabled) return;\n    updatePlaybackState();\n    if (playbackActive) return;\n    if (!overlayManager.isMounted()) {\n      attemptResolve(\"watchdog\");\n    }\n  }, WATCHDOG_INTERVAL_MS);\n\n  scheduleResolve(\"init\");\n};\n\nconst toggleOverlay = async () => {\n  const state = await getStorage();\n  const next = !(state[STORAGE_KEYS.OVERLAY_ENABLED] ?? true);\n  await setStorage({ [STORAGE_KEYS.OVERLAY_ENABLED]: next });\n  overlayEnabled = next;\n  if (!next) {\n    overlayManager.unmount();\n    setBadgeVisible(false);\n  } else {\n    setBadgeForState();\n    scheduleResolve(\"toggle\");\n  }\n  log(\"Overlay toggled\", { enabled: next });\n};\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  if (\n    event.ctrlKey === TOGGLE_COMBO.ctrlKey &&\n    event.shiftKey === TOGGLE_COMBO.shiftKey &&\n    event.key.toLowerCase() === TOGGLE_COMBO.key\n  ) {\n    event.preventDefault();\n    toggleOverlay().catch((err) => log(\"Toggle failed\", err));\n  }\n};\n\nconst bindRuntimeMessages = () => {\n  chrome.runtime.onMessage.addListener((message: LetterboxdIndexUpdatedAckMessage) => {\n    if (message?.type === \"LB_INDEX_UPDATED_ACK\") {\n      log(\"LB_INDEX_UPDATED_ACK\", message.payload);\n      scheduleResolve(\"lb-index-updated\");\n    }\n  });\n};\n\nconst setDebugHook = () => {\n  const win = getNxlWindow();\n  win.__nxlDebug = {\n    getIndex: async () => chrome.storage.local.get(STORAGE_KEYS.LETTERBOXD_INDEX),\n    forceRerender: () => overlayManager.renderLast(),\n    lastResolved: () => lastResolvedPayload\n  };\n};\n\nexport const initNetflixObserver = async () => {\n  const win = getNxlWindow();\n  if (win.__nxlBooted) return;\n  win.__nxlBooted = true;\n\n  const state = await getStorage();\n  overlayEnabled = state[STORAGE_KEYS.OVERLAY_ENABLED] ?? true;\n\n  updatePlaybackState();\n  if (overlayEnabled && !playbackActive) {\n    setBadgeVisible(true);\n    log(\"BADGE_SHOWN\");\n    log(\"BROWSE_MODE_DETECTED\");\n  }\n\n  observeTitleChanges();\n  bindRuntimeMessages();\n  setDebugHook();\n  window.addEventListener(\"keydown\", handleKeydown);\n};\n","import { log } from \"../shared/logger\";\nimport { initNetflixObserver } from \"./netflix/observer\";\n\nconst init = async () => {\n  await initNetflixObserver();\n};\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\n    \"DOMContentLoaded\",\n    () => {\n      init().catch((err) => log(\"Init failed\", err));\n    },\n    { once: true }\n  );\n} else {\n  init().catch((err) => log(\"Init failed\", err));\n}\n"],"names":["STORAGE_KEYS","log","args","getStorage","setStorage","state","TITLE_ANCHOR_SELECTOR","CONTAINER_SELECTORS","EXPANDED_CONTAINER_SELECTOR","TITLE_TEXT_SELECTORS","PREVIEW_SELECTORS","CONTROLS_SELECTORS","EPISODE_TITLE_PATTERN","EPISODE_TIME_PATTERN","METADATA_SELECTORS","GENRE_SELECTORS","TITLE_LIKE_SELECTORS","NAV_BANNED_PATTERN","isVisible","el","rect","style","normalizeText","value","text","parseTitleIdFromHref","href","match","parseYearFromText","year","normalizeNetflixTitle","raw","inner","extractFromAnchor","anchor","source","netflixTitleId","titleText","extractTitleTextNear","container","selector","findPrimaryTitle","nodes","node","normalized","findPreviewElement","candidates","best","current","bestRect","currentRect","bestArea","findControlsRow","root","scored","buttons","score","entry","a","b","_a","hasMetadataSection","selectors","findExpandedRoot","findExpandedContainers","maxWidth","maxHeight","candidate","preview","controls","metadata","isBannedTitleText","isInProgressRegion","controlsTop","extractDisplayTitle","expandedRoot","rootRect","rejectedCount","episodeNodes","fontSize","fontWeightRaw","fontWeight","dx","dy","dist","episodeNode","depth","siblingCandidates","sibling","heading","directText","nearby","resolveTitleText","fallback","primary","normalizedFallback","findBestAnchorIn","anchors","visible","filtered","ra","rb","detectActiveTitleContext","containers","resolvedTitle","fallbackAnchor","TOP_SECTION_ID","buildTopSection","host","shadow","section","header","branding","body","communityRating","because","badges","formatRatingCount","renderStars","rating","clamped","full","half","applyTopSectionData","data","communityEl","count","matchEl","_b","becauseEl","_c","badgesEl","_d","badge","createOverlayManager","currentRoot","lastData","ensureHost","BADGE_ID","buildBadgeHost","setBadgeVisible","enabled","existing","TOGGLE_COMBO","OBSERVER_DEBOUNCE_MS","WATCHDOG_INTERVAL_MS","HERO_WIDTH_THRESHOLD","HERO_HEIGHT_THRESHOLD","overlayManager","overlayEnabled","lastActiveKey","lastContainer","debounceTimer","watchdogTimer","lastRequestId","lastOutlined","playbackActive","lastResolvedPayload","getNxlWindow","isHeroSized","updateDebugOutline","isPlaybackRoute","isPlayingMainVideo","video","widthRatio","heightRatio","hasPlayerContainer","detectPlaybackActive","updatePlaybackState","next","setBadgeForState","serializeCandidateKey","findHoveredExpandedRoot","hovered","area","attemptResolve","reason","strategies","detected","detectedRoot","hoveredRoot","strategy","anchorInRoot","idMatch","normalizedTitle","key","requestId","message","response","err","scheduleResolve","observeTitleChanges","toggleOverlay","handleKeydown","event","bindRuntimeMessages","setDebugHook","win","initNetflixObserver","init"],"mappings":"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"}