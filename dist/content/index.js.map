{"version":3,"file":"index.js","sources":["../../src/shared/log.ts","../../src/shared/storage.ts","../../src/content/netflixSelectors.ts","../../src/content/overlay/index.ts","../../src/content/index.ts"],"sourcesContent":["export const DEBUG = import.meta.env.DEV;\n\nexport const log = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.log(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const warn = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.warn(\"[Netflix+Letterboxd]\", ...args);\n};\n\nexport const error = (...args: unknown[]) => {\n  if (!DEBUG) return;\n  console.error(\"[Netflix+Letterboxd]\", ...args);\n};\n","import { log, warn } from \"./log\";\nimport type { LetterboxdExport, LetterboxdIndex, LetterboxdStats } from \"./types\";\n\nexport interface StorageState {\n  letterboxdExport?: LetterboxdExport;\n  lastImportAt?: string;\n  overlayEnabled?: boolean;\n  tmdbApiKey?: string;\n  tmdbCache?: Record<string, unknown>;\n  letterboxdIndex?: LetterboxdIndex;\n  letterboxdStats?: LetterboxdStats;\n}\n\nexport const getStorage = async (): Promise<StorageState> => {\n  log(\"Loading storage state\");\n  return chrome.storage.local.get([\n    \"letterboxdExport\",\n    \"lastImportAt\",\n    \"overlayEnabled\",\n    \"tmdbApiKey\",\n    \"tmdbCache\",\n    \"letterboxdIndex\",\n    \"letterboxdStats\"\n  ]) as Promise<StorageState>;\n};\n\nexport const setStorage = async (state: StorageState): Promise<void> => {\n  log(\"Saving storage state\", state);\n  await chrome.storage.local.set(state);\n};\n\nexport const clearStorage = async (): Promise<void> => {\n  warn(\"Clearing storage state\");\n  await chrome.storage.local.clear();\n};\n","export interface ActiveTitleCandidate {\n  netflixTitleId?: string;\n  titleText?: string;\n  year?: number;\n  href?: string;\n  source: string;\n}\n\nconst TITLE_ANCHOR_SELECTOR = \"a[href^='/title/']\";\n\nconst CONTAINER_SELECTORS = [\n  \"[role='dialog']\",\n  \"[aria-modal='true']\",\n  \"[aria-expanded='true']\",\n  \"[data-uia*='jawbone']\",\n  \"[class*='jawbone']\",\n  \"[data-uia*='preview']\",\n  \"[data-uia*='billboard']\",\n  \"[data-uia*='hero']\",\n  \"[data-uia*='details']\"\n];\n\nconst TITLE_TEXT_SELECTORS = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"[data-uia*='title']\",\n  \"[class*='title']\",\n  \"[class*='fallback']\",\n  \"[class*='preview'] [class*='header']\"\n];\n\nconst PREVIEW_SELECTORS = [\n  \"video\",\n  \"img\",\n  \"[data-uia*='preview'] video\",\n  \"[data-uia*='preview'] img\",\n  \"[class*='preview'] video\",\n  \"[class*='preview'] img\",\n  \"[data-uia*='player'] video\",\n  \"[data-uia*='hero'] img\"\n];\n\nconst EPISODE_TITLE_PATTERN =\n  /(S\\d+\\s*:?\\s*E\\d+|Season\\s*\\d+\\s*Episode\\s*\\d+|Episode\\s*\\d+|\\bE\\d+\\b)/i;\nconst EPISODE_TIME_PATTERN = /(\\b\\d+\\s*(m|min|minutes)\\b|\\b\\d+\\s*of\\s*\\d+\\s*(m|min|minutes)\\b)/i;\n\nconst METADATA_SELECTORS = [\n  \"[data-uia*='maturity-rating']\",\n  \"[data-uia*='season']\",\n  \"[data-uia*='resolution']\",\n  \"[data-uia*='hd']\",\n  \"[class*='maturity']\",\n  \"[class*='season']\",\n  \"[class*='quality']\"\n];\n\nconst GENRE_SELECTORS = [\n  \"[data-uia*='genre']\",\n  \"a[href*='/genre/']\",\n  \"[class*='genre']\"\n];\n\nconst isVisible = (el: Element): boolean => {\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  const style = window.getComputedStyle(el as HTMLElement);\n  if (style.visibility === \"hidden\" || style.display === \"none\" || style.opacity === \"0\") {\n    return false;\n  }\n  const inViewport =\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= window.innerHeight &&\n    rect.left <= window.innerWidth;\n  return inViewport;\n};\n\nconst normalizeText = (value?: string | null): string | undefined => {\n  if (!value) return undefined;\n  const text = value.replace(/\\s+/g, \" \").trim();\n  return text.length ? text : undefined;\n};\n\nconst collectVisibleText = (container: Element, selectors: string[]): string[] => {\n  const values: string[] = [];\n  selectors.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (!isVisible(el)) return;\n      const text = normalizeText(el.textContent);\n      if (!text) return;\n      values.push(text);\n    });\n  });\n  return values;\n};\n\nconst isMetadataCandidate = (value: string) => {\n  const lower = value.toLowerCase();\n  if (lower.includes(\"episode\")) return false;\n  if (lower.includes(\"min\")) return false;\n  if (lower.includes(\"of \")) return false;\n  if (lower.includes(\"season\") || lower.includes(\"hd\") || lower.includes(\"tv-\")) return true;\n  return true;\n};\n\nconst parseTitleIdFromHref = (href?: string | null): string | undefined => {\n  if (!href) return undefined;\n  const match = href.match(/\\/title\\/(\\d+)/);\n  return match?.[1];\n};\n\nconst parseYearFromText = (text?: string): number | undefined => {\n  if (!text) return undefined;\n  const match = text.match(/(19\\d{2}|20\\d{2})/);\n  if (!match) return undefined;\n  const year = Number(match[1]);\n  if (Number.isNaN(year)) return undefined;\n  return year;\n};\n\nexport const normalizeNetflixTitle = (raw?: string): string | undefined => {\n  if (!raw) return undefined;\n  let value = raw;\n  value = value.replace(/^\\s*S\\d+\\s*:?\\s*E\\d+\\s*/i, \"\");\n  value = value.replace(/\"[^\"]*\"/g, (match) => {\n    const inner = match.replace(/\"/g, \"\");\n    return EPISODE_TITLE_PATTERN.test(inner) ? \"\" : match;\n  });\n  value = value.replace(/Episode\\s*\\d+/gi, \"\");\n  value = value.replace(/\\bE\\d+\\b/gi, \"\");\n  value = value.replace(EPISODE_TIME_PATTERN, \"\");\n  value = value.replace(/\\s+of\\s+\\d+\\s*(m|min|minutes)?/gi, \"\");\n  value = value.replace(/\\s+/g, \" \").trim();\n  return value.length ? value : undefined;\n};\n\nconst extractFromAnchor = (anchor: HTMLAnchorElement, source: string): ActiveTitleCandidate => {\n  const href = anchor.getAttribute(\"href\") || undefined;\n  const netflixTitleId = parseTitleIdFromHref(href);\n  const titleText = normalizeText(anchor.getAttribute(\"aria-label\") || anchor.textContent);\n  return { netflixTitleId, titleText, href, source };\n};\n\nconst extractTitleTextNear = (container: Element): string | undefined => {\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const el = container.querySelector(selector);\n    if (el && isVisible(el)) {\n      const text = normalizeText(el.textContent);\n      if (text) return text;\n    }\n  }\n  return undefined;\n};\n\nexport const getRawTitleText = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  return extractTitleTextNear(container);\n};\n\nconst findPrimaryTitle = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  for (const selector of TITLE_TEXT_SELECTORS) {\n    const nodes = Array.from(container.querySelectorAll(selector));\n    for (const node of nodes) {\n      if (!isVisible(node)) continue;\n      const text = normalizeText(node.textContent);\n      if (!text) continue;\n      if (EPISODE_TITLE_PATTERN.test(text) || EPISODE_TIME_PATTERN.test(text)) continue;\n      const normalized = normalizeNetflixTitle(text);\n      if (normalized) return normalized;\n    }\n  }\n  return undefined;\n};\n\nexport const findOverlayAnchor = (container?: Element | null): Element | null => {\n  if (container) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor && isVisible(anchor)) return anchor;\n    for (const selector of TITLE_TEXT_SELECTORS) {\n      const el = container.querySelector(selector);\n      if (el && isVisible(el)) return el;\n    }\n  }\n\n  const pageAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (pageAnchor) return pageAnchor;\n\n  const pageTitle = Array.from(document.querySelectorAll(TITLE_TEXT_SELECTORS.join(\",\"))).find(\n    isVisible\n  );\n  return pageTitle ?? null;\n};\n\nexport const findPreviewElement = (container?: Element | null): Element | null => {\n  if (!container) return null;\n  const candidates: Element[] = [];\n  PREVIEW_SELECTORS.forEach((selector) => {\n    container.querySelectorAll(selector).forEach((el) => {\n      if (isVisible(el)) candidates.push(el);\n    });\n  });\n  if (!candidates.length) return null;\n  return candidates.reduce((best, current) => {\n    const bestRect = best.getBoundingClientRect();\n    const currentRect = current.getBoundingClientRect();\n    const bestArea = bestRect.width * bestRect.height;\n    const currentArea = currentRect.width * currentRect.height;\n    return currentArea > bestArea ? current : best;\n  });\n};\n\nexport const extractMetadataLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, METADATA_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter(isMetadataCandidate)\n    .filter((value) => !EPISODE_TIME_PATTERN.test(value))\n    .filter((value) => value.length <= 24);\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const extractGenresLine = (container?: Element | null): string | undefined => {\n  if (!container) return undefined;\n  const values = collectVisibleText(container, GENRE_SELECTORS)\n    .map((value) => value.replace(/\\s+/g, \" \").trim())\n    .filter((value) => value.length > 0)\n    .filter((value) => value.length <= 24)\n    .filter((value) => !/episode|min/i.test(value));\n  const unique = Array.from(new Set(values));\n  if (!unique.length) return undefined;\n  return unique.slice(0, 3).join(\" • \");\n};\n\nexport const resolveTitleText = (\n  container?: Element | null,\n  fallback?: string\n): string | undefined => {\n  const primary = findPrimaryTitle(container);\n  if (primary) return primary;\n\n  const normalizedFallback = normalizeNetflixTitle(fallback);\n  if (normalizedFallback && !EPISODE_TITLE_PATTERN.test(normalizedFallback)) {\n    return normalizedFallback;\n  }\n\n  if (fallback) return normalizeNetflixTitle(fallback) ?? fallback;\n  return undefined;\n};\n\nexport const findOverlayContainer = (\n  container?: Element | null,\n  preview?: Element | null\n): Element | null => {\n  const candidates = new Set<Element>();\n  const collect = (start?: Element | null) => {\n    let current: Element | null | undefined = start;\n    let depth = 0;\n    while (current && depth < 7) {\n      candidates.add(current);\n      current = current.parentElement;\n      depth += 1;\n    }\n  };\n  collect(container);\n  collect(preview);\n\n  let best: Element | null = null;\n  let bestArea = 0;\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  candidates.forEach((el) => {\n    if (!isVisible(el)) return;\n    const rect = el.getBoundingClientRect();\n    const area = rect.width * rect.height;\n    if (rect.width > maxWidth || rect.height > maxHeight) return;\n    if (area > bestArea && rect.width > 240 && rect.height > 180) {\n      best = el;\n      bestArea = area;\n    }\n  });\n\n  if (best) return best;\n  const isValid = (el?: Element | null) => {\n    if (!el) return false;\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    return rect.width <= maxWidth && rect.height <= maxHeight;\n  };\n  if (isValid(container)) return container ?? null;\n  if (isValid(preview)) return preview ?? null;\n  return null;\n};\n\nconst findBestAnchorIn = (container: Element): HTMLAnchorElement | undefined => {\n  const anchors = Array.from(container.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR));\n  const visible = anchors.filter(isVisible);\n  if (visible.length > 0) return visible[0];\n  return anchors[0];\n};\n\nconst findExpandedContainers = (): Element[] => {\n  const selectors = CONTAINER_SELECTORS.join(\",\");\n  const nodes = Array.from(document.querySelectorAll(selectors));\n  const visible = nodes.filter(isVisible);\n  const maxWidth = window.innerWidth * 0.85;\n  const maxHeight = window.innerHeight * 0.6;\n  const filtered = visible.filter((el) => {\n    const rect = el.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    if (rect.width < 240 || rect.height < 180) return false;\n    if (rect.width > maxWidth || rect.height > maxHeight) return false;\n    return true;\n  });\n  if (filtered.length > 0) {\n    return filtered.sort((a, b) => {\n      const ra = a.getBoundingClientRect();\n      const rb = b.getBoundingClientRect();\n      return rb.width * rb.height - ra.width * ra.height;\n    });\n  }\n  return visible.length > 0 ? visible : nodes;\n};\n\nexport const detectActiveTitleContext = (): {\n  candidate: ActiveTitleCandidate | null;\n  container: Element | null;\n} => {\n  const containers = findExpandedContainers();\n\n  for (const container of containers) {\n    const anchor = findBestAnchorIn(container);\n    if (anchor) {\n      const candidate = extractFromAnchor(anchor, \"container-anchor\");\n      if (candidate.netflixTitleId || candidate.titleText) {\n        const titleText = candidate.titleText ?? extractTitleTextNear(container);\n        const resolvedTitle = resolveTitleText(container, titleText ?? candidate.titleText);\n        return {\n          candidate: {\n            ...candidate,\n            titleText: resolvedTitle,\n            year: parseYearFromText(resolvedTitle ?? titleText)\n          },\n          container\n        };\n      }\n    }\n\n    const titleText = extractTitleTextNear(container);\n    if (titleText) {\n      const resolvedTitle = resolveTitleText(container, titleText);\n      return {\n        candidate: {\n          titleText: resolvedTitle ?? titleText,\n          year: parseYearFromText(resolvedTitle ?? titleText),\n          source: \"container-text\"\n        },\n        container\n      };\n    }\n  }\n\n  const fallbackAnchor = Array.from(\n    document.querySelectorAll<HTMLAnchorElement>(TITLE_ANCHOR_SELECTOR)\n  ).find(isVisible);\n  if (fallbackAnchor) {\n    const candidate = extractFromAnchor(fallbackAnchor, \"page-anchor\");\n    const resolvedTitle = resolveTitleText(\n      fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement,\n      candidate.titleText\n    );\n    return {\n      candidate: {\n        ...candidate,\n        titleText: resolvedTitle ?? candidate.titleText,\n        year: parseYearFromText(resolvedTitle ?? candidate.titleText)\n      },\n      container: fallbackAnchor.closest(CONTAINER_SELECTORS.join(\",\")) ?? fallbackAnchor.parentElement\n    };\n  }\n\n  return { candidate: null, container: null };\n};\n\nexport const detectActiveTitle = (): ActiveTitleCandidate | null => {\n  return detectActiveTitleContext().candidate;\n};\n","export interface OverlayData {\n  titleLine: string;\n  metadataLine?: string;\n  genresLine?: string;\n  communityRating?: number;\n  ratingCount?: number;\n  inWatchlist?: boolean;\n  userRating?: number;\n  matchScore?: number;\n  matchExplanation?: string;\n  debug?: {\n    titleText?: string;\n    year?: number;\n    netflixTitleId?: string;\n    href?: string;\n    tmdbId?: number;\n    tmdbVoteAverage?: number;\n    tmdbVoteCount?: number;\n    inWatchlist?: boolean;\n    userRating?: number;\n    matchScore?: number;\n    matchExplanation?: string;\n  };\n}\n\nconst OVERLAY_ID = \"nxlb-overlay-panel\";\nconst positionOverrides = new WeakMap<Element, string>();\n\nconst ensureContainerPosition = (container: Element) => {\n  const computed = window.getComputedStyle(container);\n  if (computed.position !== \"static\") return;\n\n  if (!positionOverrides.has(container)) {\n    positionOverrides.set(container, container instanceof HTMLElement ? container.style.position : \"\");\n  }\n\n  if (container instanceof HTMLElement) {\n    container.style.position = \"relative\";\n    container.dataset.nxlbPositioned = \"true\";\n  }\n};\n\nconst restoreContainerPosition = (container: Element | null) => {\n  if (!container || !(container instanceof HTMLElement)) return;\n  if (!container.dataset.nxlbPositioned) return;\n\n  const previous = positionOverrides.get(container) ?? \"\";\n  container.style.position = previous;\n  delete container.dataset.nxlbPositioned;\n  positionOverrides.delete(container);\n};\n\nconst buildOverlay = (data: OverlayData): HTMLDivElement => {\n  const host = document.createElement(\"div\");\n  host.id = OVERLAY_ID;\n  host.style.position = \"absolute\";\n  host.style.inset = \"0\";\n  host.style.width = \"100%\";\n  host.style.height = \"100%\";\n  host.style.zIndex = \"2147483647\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Netflix Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n      pointer-events: none;\n      --preview-top-px: 240px;\n      --preview-bottom-px: 420px;\n      --controls-height: 64px;\n    }\n    .nxl-card {\n      position: absolute;\n      inset: 0;\n      color: #f5f5f5;\n      border-radius: 12px;\n      border: 1px solid rgba(255, 255, 255, 0.08);\n      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);\n      overflow: hidden;\n      animation: nxlFadeIn 150ms ease-out;\n    }\n    .nxl-shade {\n      position: absolute;\n      left: 0;\n      right: 0;\n      background: rgba(0, 0, 0, 0.88);\n      backdrop-filter: blur(8px);\n    }\n    .nxl-shade.top {\n      top: 0;\n      height: var(--preview-top-px);\n    }\n    .nxl-shade.bottom {\n      top: var(--preview-bottom-px);\n      bottom: 0;\n    }\n    .nxl-content {\n      position: relative;\n      z-index: 1;\n      display: grid;\n      grid-template-rows: auto auto auto auto 1fr auto;\n      gap: 12px;\n      padding: 20px;\n      height: 100%;\n      box-sizing: border-box;\n    }\n    .nxl-top {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      gap: 16px;\n    }\n    .nxl-title-section {\n      flex: 1;\n      min-width: 0;\n      max-width: 70%;\n    }\n    .nxl-title {\n      font-size: 30px;\n      font-weight: 700;\n      letter-spacing: 0.01em;\n      line-height: 1.1;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-meta {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.75);\n      margin-top: 6px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-genres {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.7);\n      margin-top: 4px;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    .nxl-branding {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.8);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .nxl-dots {\n      display: inline-flex;\n      gap: 4px;\n      align-items: center;\n    }\n    .nxl-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n    .nxl-dot.green { background: #00c46a; }\n    .nxl-dot.orange { background: #f2b34c; }\n    .nxl-dot.blue { background: #4aa8ff; }\n    .nxl-divider {\n      height: 1px;\n      width: 100%;\n      background: rgba(255, 255, 255, 0.1);\n    }\n    .nxl-metadata {\n      display: grid;\n      gap: 8px;\n      font-size: 16px;\n      color: rgba(255, 255, 255, 0.9);\n    }\n    .nxl-rating {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .nxl-star {\n      color: #e3b341;\n      font-size: 16px;\n    }\n    .nxl-match {\n      display: flex;\n      align-items: baseline;\n      gap: 8px;\n    }\n    .nxl-match-value {\n      color: #46d369;\n      font-weight: 700;\n      font-size: 20px;\n      animation: nxlPop 200ms ease-out;\n    }\n    .nxl-because {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 14px;\n    }\n    .nxl-preview {\n      min-height: 180px;\n    }\n    .nxl-controls {\n      min-height: var(--controls-height);\n    }\n    .debug {\n      margin-top: 4px;\n      padding-top: 8px;\n      border-top: 1px solid rgba(255, 255, 255, 0.08);\n      font-size: 11px;\n      opacity: 0.7;\n      display: none;\n      white-space: pre-wrap;\n    }\n    .safe .nxl-shade {\n      backdrop-filter: blur(4px);\n    }\n    @keyframes nxlFadeIn {\n      from { opacity: 0; transform: translateY(6px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n    @keyframes nxlPop {\n      0% { transform: scale(0.96); }\n      100% { transform: scale(1); }\n    }\n  `;\n\n  const panel = document.createElement(\"div\");\n  panel.className = \"nxl-card\";\n\n  const shadeTop = document.createElement(\"div\");\n  shadeTop.className = \"nxl-shade top\";\n\n  const shadeBottom = document.createElement(\"div\");\n  shadeBottom.className = \"nxl-shade bottom\";\n\n  const content = document.createElement(\"div\");\n  content.className = \"nxl-content\";\n\n  const top = document.createElement(\"div\");\n  top.className = \"nxl-top\";\n\n  const titleSection = document.createElement(\"div\");\n  titleSection.className = \"nxl-title-section\";\n\n  const title = document.createElement(\"div\");\n  title.className = \"nxl-title\";\n  title.textContent = data.titleLine;\n\n  const metaLine = document.createElement(\"div\");\n  metaLine.className = \"nxl-meta\";\n  metaLine.dataset.field = \"metadata\";\n  metaLine.textContent = data.metadataLine ?? \"TV-14 • 2 Seasons • HD\";\n\n  const genresLine = document.createElement(\"div\");\n  genresLine.className = \"nxl-genres\";\n  genresLine.dataset.field = \"genres\";\n  genresLine.textContent = data.genresLine ?? \"Genres\";\n\n  titleSection.appendChild(title);\n  titleSection.appendChild(metaLine);\n  titleSection.appendChild(genresLine);\n\n  const branding = document.createElement(\"div\");\n  branding.className = \"nxl-branding\";\n  branding.innerHTML = `\n    Powered by\n    <span class=\"nxl-dots\">\n      <span class=\"nxl-dot green\"></span>\n      <span class=\"nxl-dot orange\"></span>\n      <span class=\"nxl-dot blue\"></span>\n    </span>\n    Letterboxd\n  `;\n\n  top.appendChild(titleSection);\n  top.appendChild(branding);\n\n  const divider = document.createElement(\"div\");\n  divider.className = \"nxl-divider\";\n\n  const metadata = document.createElement(\"div\");\n  metadata.className = \"nxl-metadata\";\n\n  const communityRating = document.createElement(\"div\");\n  communityRating.className = \"nxl-rating\";\n  communityRating.dataset.field = \"communityRating\";\n  communityRating.textContent = \"Community rating: —\";\n\n  const match = document.createElement(\"div\");\n  match.className = \"nxl-match\";\n  match.dataset.field = \"match\";\n  match.textContent = \"Your match: —\";\n\n  const because = document.createElement(\"div\");\n  because.className = \"nxl-because\";\n  because.dataset.field = \"because\";\n  because.textContent = \"Because you like —\";\n\n  metadata.appendChild(communityRating);\n  metadata.appendChild(match);\n  metadata.appendChild(because);\n\n  const preview = document.createElement(\"div\");\n  preview.className = \"nxl-preview\";\n  preview.dataset.field = \"preview\";\n\n  const controls = document.createElement(\"div\");\n  controls.className = \"nxl-controls\";\n  controls.dataset.field = \"controls\";\n\n  content.appendChild(top);\n  content.appendChild(divider);\n  content.appendChild(metadata);\n  content.appendChild(preview);\n  content.appendChild(controls);\n\n  const debug = document.createElement(\"div\");\n  debug.className = \"debug\";\n  debug.dataset.field = \"debug\";\n  content.appendChild(debug);\n\n  panel.appendChild(shadeTop);\n  panel.appendChild(shadeBottom);\n  panel.appendChild(content);\n\n  shadow.appendChild(style);\n  shadow.appendChild(panel);\n\n  return host;\n};\n\nlet currentContainer: Element | null = null;\nlet currentHost: HTMLDivElement | null = null;\nlet currentAnchor: Element | null = null;\n\nconst formatRatingCount = (value?: number) => {\n  if (value === undefined) return \"\";\n  if (value >= 1_000_000) return `${(value / 1_000_000).toFixed(1)}M`;\n  if (value >= 1_000) return `${(value / 1_000).toFixed(1)}K`;\n  return `${value}`;\n};\n\nconst applyOverlayData = (data: OverlayData) => {\n  const titleEl = currentHost?.shadowRoot?.querySelector(\".nxl-title\");\n  if (titleEl) titleEl.textContent = data.titleLine;\n\n  const communityEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='communityRating']\"\n  ) as HTMLDivElement | null;\n  if (communityEl) {\n    if (data.communityRating !== undefined) {\n      const count = formatRatingCount(data.ratingCount);\n      communityEl.innerHTML = `\n        Community rating:\n        <span class=\"nxl-star\">★</span>\n        ${data.communityRating.toFixed(1)}${count ? ` <span class=\"nxl-meta\">${count} ratings</span>` : \"\"}\n      `;\n    } else {\n      communityEl.textContent = \"Community rating: —\";\n    }\n  }\n\n  const matchEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='match']\"\n  ) as HTMLDivElement | null;\n  if (matchEl) {\n    if (data.matchScore !== undefined) {\n      matchEl.innerHTML = `Your match: <span class=\"nxl-match-value\">${data.matchScore}%</span>`;\n    } else {\n      matchEl.textContent = \"Your match: —\";\n    }\n  }\n\n  const becauseEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='because']\"\n  ) as HTMLDivElement | null;\n  if (becauseEl) {\n    becauseEl.textContent = data.matchExplanation ?? \"Because you like —\";\n  }\n\n  const metaEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='metadata']\"\n  ) as HTMLDivElement | null;\n  if (metaEl) {\n    if (data.metadataLine) {\n      metaEl.style.display = \"block\";\n      metaEl.textContent = data.metadataLine;\n    } else {\n      metaEl.style.display = \"none\";\n      metaEl.textContent = \"\";\n    }\n  }\n\n  const genresEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='genres']\"\n  ) as HTMLDivElement | null;\n  if (genresEl) {\n    if (data.genresLine) {\n      genresEl.style.display = \"block\";\n      genresEl.textContent = data.genresLine;\n    } else {\n      genresEl.style.display = \"none\";\n      genresEl.textContent = \"\";\n    }\n  }\n\n  const debugEl = currentHost?.shadowRoot?.querySelector(\n    \"[data-field='debug']\"\n  ) as HTMLDivElement | null;\n  if (debugEl) {\n    if (data.debug) {\n      debugEl.style.display = \"block\";\n      debugEl.textContent = JSON.stringify(data.debug, null, 2);\n    } else {\n      debugEl.style.display = \"none\";\n      debugEl.textContent = \"\";\n    }\n  }\n};\n\nexport const updateOverlay = (\n  container: Element | null,\n  data: OverlayData | null,\n  anchor: Element | null = null,\n  safeMode = false,\n  previewRegion?: {\n    top: number;\n    bottom: number;\n    containerHeight: number;\n    previewHeight: number;\n    controlsHeight: number;\n  }\n) => {\n  if (!data || !container) {\n    if (currentHost) currentHost.remove();\n    restoreContainerPosition(currentContainer);\n    currentContainer = null;\n    currentHost = null;\n    currentAnchor = null;\n    return;\n  }\n\n  if (currentContainer !== container || currentAnchor !== anchor) {\n    if (currentHost) currentHost.remove();\n    restoreContainerPosition(currentContainer);\n    currentContainer = container;\n    currentAnchor = anchor;\n    currentHost = buildOverlay(data);\n\n    ensureContainerPosition(container);\n    container.appendChild(currentHost);\n    const rect = container.getBoundingClientRect();\n    currentHost.style.width = `${rect.width}px`;\n    currentHost.style.height = `${rect.height}px`;\n    if (previewRegion) {\n      const topPx = Math.max(160, previewRegion.top - 8);\n      const bottomPx = Math.max(\n        topPx + Math.max(120, previewRegion.previewHeight),\n        previewRegion.bottom + 8\n      );\n      currentHost.style.setProperty(\"--preview-top-px\", `${topPx}px`);\n      currentHost.style.setProperty(\"--preview-bottom-px\", `${bottomPx}px`);\n      currentHost.style.setProperty(\"--controls-height\", `${previewRegion.controlsHeight}px`);\n    }\n\n    const panel = currentHost.shadowRoot?.querySelector(\".nxl-card\");\n    if (panel) {\n      panel.classList.toggle(\"safe\", safeMode);\n    }\n\n    applyOverlayData(data);\n    return;\n  }\n\n  if (previewRegion && currentHost) {\n    const rect = container.getBoundingClientRect();\n    currentHost.style.width = `${rect.width}px`;\n    currentHost.style.height = `${rect.height}px`;\n    const topPx = Math.max(160, previewRegion.top - 8);\n    const bottomPx = Math.max(\n      topPx + Math.max(120, previewRegion.previewHeight),\n      previewRegion.bottom + 8\n    );\n    currentHost.style.setProperty(\"--preview-top-px\", `${topPx}px`);\n    currentHost.style.setProperty(\"--preview-bottom-px\", `${bottomPx}px`);\n    currentHost.style.setProperty(\"--controls-height\", `${previewRegion.controlsHeight}px`);\n  }\n\n  const panel = currentHost?.shadowRoot?.querySelector(\".nxl-card\");\n  if (panel) {\n    panel.classList.toggle(\"safe\", safeMode);\n  }\n\n  applyOverlayData(data);\n};\n","import { log } from \"../shared/log\";\nimport { getStorage, setStorage } from \"../shared/storage\";\nimport {\n  detectActiveTitleContext,\n  extractGenresLine,\n  extractMetadataLine,\n  findOverlayContainer,\n  findOverlayAnchor,\n  findPreviewElement,\n  getRawTitleText,\n  normalizeNetflixTitle\n} from \"./netflixSelectors\";\nimport { updateOverlay } from \"./overlay\";\nimport type { ResolveTitleMessage, TitleResolvedMessage } from \"../shared/types\";\nimport { DEBUG } from \"../shared/log\";\n\nconst BADGE_ID = \"nxlb-debug-badge\";\nconst TOGGLE_COMBO = {\n  ctrlKey: true,\n  shiftKey: true,\n  key: \"l\"\n};\nconst OBSERVER_DEBOUNCE_MS = 250;\nconst HERO_WIDTH_THRESHOLD = 0.85;\nconst HERO_HEIGHT_THRESHOLD = 0.6;\n\nconst ensureBadge = (enabled: boolean) => {\n  const existing = document.getElementById(BADGE_ID);\n  if (!enabled) {\n    existing?.remove();\n    return;\n  }\n\n  if (existing) return;\n\n  const host = document.createElement(\"div\");\n  host.id = BADGE_ID;\n  host.style.position = \"fixed\";\n  host.style.bottom = \"16px\";\n  host.style.right = \"16px\";\n  host.style.zIndex = \"2147483647\";\n\n  const shadow = host.attachShadow({ mode: \"open\" });\n  const style = document.createElement(\"style\");\n  style.textContent = `\n    :host {\n      all: initial;\n      font-family: \"Space Grotesk\", sans-serif;\n    }\n    .badge {\n      background: #111;\n      color: #f5f5f5;\n      border-radius: 999px;\n      padding: 6px 10px;\n      font-size: 11px;\n      letter-spacing: 0.08em;\n      text-transform: uppercase;\n      border: 1px solid rgba(255, 255, 255, 0.14);\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);\n    }\n  `;\n\n  const badge = document.createElement(\"div\");\n  badge.className = \"badge\";\n  badge.textContent = \"N×L active\";\n\n  shadow.appendChild(style);\n  shadow.appendChild(badge);\n  document.documentElement.appendChild(host);\n};\n\nlet overlayEnabled = true;\n\nconst applyOverlayState = async (enabled: boolean) => {\n  overlayEnabled = enabled;\n  if (!enabled) {\n    updateOverlay(null, null);\n  }\n  ensureBadge(enabled);\n};\n\nlet lastActiveKey = \"\";\nlet lastContainer: Element | null = null;\nlet debounceTimer: number | undefined;\nlet lastRequestId = \"\";\n\nconst describeElement = (el: Element | null) => {\n  if (!el) return \"none\";\n  const parts = [el.tagName.toLowerCase()];\n  const className = (el as HTMLElement).className;\n  if (className) {\n    parts.push(\n      \".\" +\n        className\n          .toString()\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 3)\n          .join(\".\")\n    );\n  }\n  const dataUia = (el as HTMLElement).getAttribute?.(\"data-uia\");\n  if (dataUia) parts.push(`[data-uia=\\\"${dataUia}\\\"]`);\n  return parts.join(\"\");\n};\n\nconst isWatchPage = () => window.location.pathname.startsWith(\"/watch\");\n\nconst hasMainPlayerVideo = () => {\n  const videos = Array.from(document.querySelectorAll(\"video\"));\n  return videos.some((video) => {\n    const rect = video.getBoundingClientRect();\n    if (rect.width === 0 || rect.height === 0) return false;\n    const widthRatio = rect.width / window.innerWidth;\n    const heightRatio = rect.height / window.innerHeight;\n    return widthRatio > 0.85 || heightRatio > 0.6;\n  });\n};\n\nconst hasEpisodeHeaderVisible = () => {\n  const candidates = Array.from(\n    document.querySelectorAll(\"h1, h2, h3, [data-uia*='episode'], [class*='episode']\")\n  );\n  return candidates.some((el) => {\n    if (el instanceof HTMLElement) {\n      const rect = el.getBoundingClientRect();\n      if (rect.width === 0 || rect.height === 0) return false;\n      const text = el.textContent ?? \"\";\n      return /episode/i.test(text);\n    }\n    return false;\n  });\n};\n\nconst isHeroSized = (el: Element | null) => {\n  if (!el) return false;\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return false;\n  return (\n    rect.width > window.innerWidth * HERO_WIDTH_THRESHOLD ||\n    rect.height > window.innerHeight * HERO_HEIGHT_THRESHOLD\n  );\n};\n\nconst serializeCandidate = (\n  candidate: ReturnType<typeof detectActiveTitleContext>[\"candidate\"]\n): string => {\n  if (!candidate) return \"\";\n  return [\n    candidate.netflixTitleId ?? \"\",\n    candidate.titleText ?? \"\",\n    candidate.year ?? \"\",\n    candidate.href ?? \"\"\n  ].join(\"|\");\n};\n\nconst emitActiveTitleChange = () => {\n  if (!overlayEnabled) return;\n\n  if (isWatchPage()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"watch-page\" });\n    updateOverlay(null, null);\n    return;\n  }\n\n  if (hasMainPlayerVideo()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"main-player-video\" });\n    updateOverlay(null, null);\n    return;\n  }\n\n  if (hasEpisodeHeaderVisible()) {\n    if (DEBUG) log(\"Overlay skipped\", { reason: \"episode-header-visible\" });\n    updateOverlay(null, null);\n    return;\n  }\n\n  const { candidate, container } = detectActiveTitleContext();\n  const previewEl = findPreviewElement(container);\n  const overlayContainer = findOverlayContainer(container, previewEl);\n  const anchor = findOverlayAnchor(overlayContainer ?? container);\n  const metadataLine = extractMetadataLine(overlayContainer ?? container);\n  const genresLine = extractGenresLine(overlayContainer ?? container);\n  if (!overlayContainer || !previewEl) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"no-overlay-container\",\n        anchor: describeElement(anchor),\n        container: describeElement(overlayContainer)\n      });\n    }\n    updateOverlay(null, null);\n    return;\n  }\n  if (isHeroSized(anchor) || isHeroSized(overlayContainer)) {\n    if (DEBUG) {\n      log(\"Overlay skipped\", {\n        reason: \"hero-sized-anchor\",\n        anchor: describeElement(anchor),\n        container: describeElement(overlayContainer)\n      });\n    }\n    updateOverlay(null, null);\n    return;\n  }\n  const previewRegion = (() => {\n    const containerRect = overlayContainer.getBoundingClientRect();\n    const previewRect = previewEl.getBoundingClientRect();\n    if (containerRect.height === 0) return undefined;\n    const top = Math.max(0, previewRect.top - containerRect.top);\n    const bottom = Math.max(0, previewRect.bottom - containerRect.top);\n    const controlsHeight = Math.max(0, containerRect.bottom - previewRect.bottom);\n    return {\n      top,\n      bottom,\n      containerHeight: containerRect.height,\n      previewHeight: Math.max(0, previewRect.height),\n      controlsHeight\n    };\n  })();\n  const key = serializeCandidate(candidate);\n  if (!candidate) {\n    try {\n      updateOverlay(null, null);\n    } catch (error) {\n      log(\"Overlay cleanup failed\", { error });\n    }\n    lastActiveKey = \"\";\n    lastContainer = null;\n    return;\n  }\n\n  if (key === lastActiveKey && overlayContainer === lastContainer) return;\n  lastActiveKey = key;\n  lastContainer = overlayContainer;\n  if (DEBUG) {\n    const rawTitle = getRawTitleText(overlayContainer ?? container);\n    const normalizedTitle = normalizeNetflixTitle(rawTitle ?? candidate.titleText);\n    log(\"Active title changed\", {\n      ...candidate,\n      anchor: describeElement(anchor),\n      container: describeElement(overlayContainer),\n      rawTitle,\n      normalizedTitle,\n      at: new Date().toISOString()\n    });\n  }\n\n  const requestId = `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n  lastRequestId = requestId;\n  const message: ResolveTitleMessage = {\n    type: \"RESOLVE_TITLE\",\n    requestId,\n    payload: {\n      netflixTitleId: candidate.netflixTitleId,\n      titleText: candidate.titleText,\n      year: candidate.year,\n      href: candidate.href\n    }\n  };\n\n  chrome.runtime\n    .sendMessage(message)\n    .then((response: TitleResolvedMessage) => {\n      if (response?.type !== \"TITLE_RESOLVED\") return;\n      if (response.requestId !== lastRequestId) return;\n      log(\"Title resolved\", { requestId, response });\n\n      try {\n        updateOverlay(\n          overlayContainer,\n          {\n            titleLine,\n            metadataLine,\n            genresLine,\n            communityRating: response.payload.tmdbVoteAverage,\n            ratingCount: response.payload.tmdbVoteCount,\n            inWatchlist: response.payload.inWatchlist,\n            userRating: response.payload.userRating,\n            matchScore: response.payload.matchScore,\n            matchExplanation: response.payload.matchExplanation,\n            debug: DEBUG\n              ? {\n                ...candidate,\n                ...response.payload\n              }\n              : undefined\n          },\n          anchor,\n          false,\n          previewRegion\n        );\n      } catch (error) {\n        log(\"Overlay update failed\", { error });\n      }\n    })\n    .catch((err) => {\n      log(\"Title resolve failed\", { requestId, err });\n    });\n\n  const titleLine = candidate.titleText\n    ? candidate.year\n      ? `${candidate.titleText} (${candidate.year})`\n      : candidate.titleText\n    : \"Unknown title\";\n\n  try {\n    updateOverlay(\n      overlayContainer,\n      {\n        titleLine,\n        metadataLine,\n        genresLine,\n        debug: DEBUG ? { ...candidate } : undefined\n      },\n      anchor,\n      false,\n      previewRegion\n    );\n  } catch (error) {\n    log(\"Overlay update failed\", { error });\n  }\n};\n\nconst scheduleActiveTitleCheck = () => {\n  if (debounceTimer) window.clearTimeout(debounceTimer);\n  debounceTimer = window.setTimeout(() => {\n    emitActiveTitleChange();\n  }, OBSERVER_DEBOUNCE_MS);\n};\n\nconst observeTitleChanges = () => {\n  const observer = new MutationObserver(() => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Mutation observer failed\", { error });\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter: [\"class\", \"style\", \"aria-expanded\", \"aria-hidden\"]\n  });\n\n  document.addEventListener(\"pointerover\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Pointer observer failed\", { error });\n    }\n  }, true);\n  document.addEventListener(\"focusin\", () => {\n    try {\n      scheduleActiveTitleCheck();\n    } catch (error) {\n      log(\"Focus observer failed\", { error });\n    }\n  }, true);\n  scheduleActiveTitleCheck();\n};\n\nconst toggleOverlay = async () => {\n  const state = await getStorage();\n  const next = !(state.overlayEnabled ?? true);\n  await setStorage({ overlayEnabled: next });\n  await applyOverlayState(next);\n  if (next) scheduleActiveTitleCheck();\n  log(\"Overlay toggled\", { enabled: next });\n};\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  if (\n    event.ctrlKey === TOGGLE_COMBO.ctrlKey &&\n    event.shiftKey === TOGGLE_COMBO.shiftKey &&\n    event.key.toLowerCase() === TOGGLE_COMBO.key\n  ) {\n    event.preventDefault();\n    toggleOverlay().catch((err) => log(\"Toggle failed\", err));\n  }\n};\n\nconst init = async () => {\n  const state = await getStorage();\n  const enabled = state.overlayEnabled ?? true;\n  await applyOverlayState(enabled);\n  observeTitleChanges();\n  window.addEventListener(\"keydown\", handleKeydown);\n};\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    init().catch((err) => log(\"Init failed\", err));\n  }, { once: true });\n} else {\n  init().catch((err) => log(\"Init failed\", err));\n}\n"],"names":["log","args","getStorage","setStorage","state","TITLE_ANCHOR_SELECTOR","CONTAINER_SELECTORS","TITLE_TEXT_SELECTORS","PREVIEW_SELECTORS","EPISODE_TITLE_PATTERN","EPISODE_TIME_PATTERN","METADATA_SELECTORS","GENRE_SELECTORS","isVisible","el","rect","style","normalizeText","value","text","collectVisibleText","container","selectors","values","selector","isMetadataCandidate","lower","parseTitleIdFromHref","href","match","parseYearFromText","year","normalizeNetflixTitle","raw","inner","extractFromAnchor","anchor","source","netflixTitleId","titleText","extractTitleTextNear","findPrimaryTitle","nodes","node","normalized","findOverlayAnchor","findBestAnchorIn","pageAnchor","findPreviewElement","candidates","best","current","bestRect","currentRect","bestArea","extractMetadataLine","unique","extractGenresLine","resolveTitleText","fallback","primary","normalizedFallback","findOverlayContainer","preview","collect","start","depth","maxWidth","maxHeight","area","isValid","anchors","visible","findExpandedContainers","filtered","a","b","ra","rb","detectActiveTitleContext","containers","candidate","resolvedTitle","fallbackAnchor","OVERLAY_ID","positionOverrides","ensureContainerPosition","restoreContainerPosition","previous","buildOverlay","data","host","shadow","panel","shadeTop","shadeBottom","content","top","titleSection","title","metaLine","genresLine","branding","divider","metadata","communityRating","because","controls","debug","currentContainer","currentHost","currentAnchor","formatRatingCount","applyOverlayData","titleEl","_a","communityEl","_b","count","matchEl","_c","becauseEl","_d","metaEl","_e","genresEl","_f","debugEl","_g","updateOverlay","safeMode","previewRegion","topPx","bottomPx","BADGE_ID","TOGGLE_COMBO","OBSERVER_DEBOUNCE_MS","HERO_WIDTH_THRESHOLD","HERO_HEIGHT_THRESHOLD","ensureBadge","enabled","existing","badge","overlayEnabled","applyOverlayState","lastActiveKey","lastContainer","debounceTimer","lastRequestId","isWatchPage","hasMainPlayerVideo","video","widthRatio","heightRatio","hasEpisodeHeaderVisible","isHeroSized","serializeCandidate","emitActiveTitleChange","previewEl","overlayContainer","metadataLine","containerRect","previewRect","bottom","controlsHeight","key","requestId","message","response","titleLine","err","scheduleActiveTitleCheck","observeTitleChanges","toggleOverlay","next","handleKeydown","event","init"],"mappings":"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"}